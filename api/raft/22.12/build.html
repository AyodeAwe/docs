<!DOCTYPE html>
<html class="writer-html5" lang="en"><head>
  <meta charset="utf-8"><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator">

  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Install Guide &mdash; raft 22.12.00 documentation</title>
      <link href="_static/pygments.css" rel="stylesheet" type="text/css">
      <link href="_static/css/theme.css" rel="stylesheet" type="text/css">
      <link href="_static/copybutton.css" rel="stylesheet" type="text/css">
      <link href="_static/infoboxes.css" rel="stylesheet" type="text/css">
      <link href="_static/references.css" rel="stylesheet" type="text/css">
      <link href="https://docs.rapids.ai/assets/css/custom.css" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script defer="defer" src="https://docs.rapids.ai/assets/js/custom.js"></script>
        <script src="_static/example_mod.js"></script>
    <script src="_static/js/theme.js"></script>
    <link href="genindex.html" rel="index" title="Index">
    <link href="search.html" rel="search" title="Search">
    <link href="cpp_api.html" rel="next" title="C++ API Reference">
    <link href="quick_start.html" rel="prev" title="Quick Start"> 
<script id="rapids-selector-pixel-src" src="https://assets.adobedtm.com/5d4962a43b79/814eb6e9b4e1/launch-4bc07f1e0b0b.min.js"></script><link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav class="wy-nav-side" data-toggle="wy-nav-shift">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"><div id="rapids-jtd-container"><div class="rapids-home-container"><a class="rapids-home-container__home-btn" href="/api">Home</a></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">raft</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">clx</a><a class="rapids-selector__menu-item" href="/api/cucim/stable/api.html">cucim</a><a class="rapids-selector__menu-item" href="/api/cudf/stable/index.html">cudf</a><a class="rapids-selector__menu-item" href="/api/cudf-java/stable">cudf-java</a><a class="rapids-selector__menu-item" href="/api/cugraph/stable">cugraph</a><a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">cuml</a><a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">cusignal</a><a class="rapids-selector__menu-item" href="/api/cuspatial/stable">cuspatial</a><a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">cuxfilter</a><a class="rapids-selector__menu-item" href="/api/dask-cuda/stable/api.html">dask-cuda</a><a class="rapids-selector__menu-item" href="/api/kvikio/stable/api.html">kvikio</a><a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">libcudf</a><a class="rapids-selector__menu-item" href="/api/libcugraph/stable">libcugraph</a><a class="rapids-selector__menu-item" href="/api/libcuml/stable">libcuml</a><a class="rapids-selector__menu-item" href="/api/libcuspatial/stable">libcuspatial</a><a class="rapids-selector__menu-item" href="/api/libkvikio/stable">libkvikio</a><a class="rapids-selector__menu-item" href="/api/librmm/stable/annotated.html">librmm</a><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/raft/stable">raft</a><a class="rapids-selector__menu-item" href="/api/rapids-cmake/stable/api.html">rapids-cmake</a><a class="rapids-selector__menu-item" href="/api/rmm/stable/api.html">rmm</a></div></div><div class="rapids-selector__container rapids-selector--hidden"><div class="rapids-selector__selected">nightly (22.12)</div><div class="rapids-selector__menu"><a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/raft/nightly">nightly (22.12)</a><a class="rapids-selector__menu-item" href="/api/raft/stable">stable (22.10)</a><a class="rapids-selector__menu-item" href="/api/raft/legacy">legacy (22.08)</a></div></div></div>
            
              
<div role="search">
  <form action="search.html" class="wy-form" id="rtd-search-form" method="get">
    <input name="q" placeholder="Search docs" type="text">
    <input name="check_keywords" type="hidden" value="yes">
    <input name="area" type="hidden" value="default">
  </form>
</div>
        </div><div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Install Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#building-and-installing-raft">Building and installing RAFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cuda-gpu-requirements">CUDA/GPU Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-dependencies">Build Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#required">Required</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional">Optional</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#header-only-c">Header-only C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-shared-libraries-optional">C++ Shared Libraries (optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ccache-and-sccache">ccache and sccache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tests">Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#benchmarks">Benchmarks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-using-cmake">C++ Using Cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-raft-in-downstream-projects">Using RAFT in downstream projects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#c-header-only-integration-using-cmake">C++ header-only integration using cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-pre-compiled-shared-libraries">Using pre-compiled shared libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-raft-c-from-source-in-cmake">Building RAFT C++ from source in cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-cython-integration">Python/Cython Integration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cpp_api.html">C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="pylibraft_api.html">PyLibRAFT API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="raft_dask_api.html">RAFT Dask API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"><nav aria-label="Mobile navigation menu" class="wy-nav-top">
          <i class="fa fa-bars" data-toggle="wy-nav-top"></i>
          <a href="index.html">raft</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div aria-label="Page navigation" role="navigation">
  <ul class="wy-breadcrumbs">
      <li><a class="icon icon-home" href="index.html"></a> &raquo;</li>
      <li>Install Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/build.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr>
</div>
          <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
           <div itemprop="articleBody">
             
  <section id="install-guide">
<h1>Install Guide<a class="headerlink" href="#install-guide" title="Permalink to this heading">&para;</a></h1>
<section id="building-and-installing-raft">
<h2>Building and installing RAFT<a class="headerlink" href="#building-and-installing-raft" title="Permalink to this heading">&para;</a></h2>
<section id="cuda-gpu-requirements">
<h3>CUDA/GPU Requirements<a class="headerlink" href="#cuda-gpu-requirements" title="Permalink to this heading">&para;</a></h3>
<ul class="simple">
<li><p>CUDA Toolkit 11.0+</p></li>
<li><p>NVIDIA driver 450.80.02+</p></li>
<li><p>Pascal architecture of better (compute capability &gt;= 6.0)</p></li>
</ul>
</section>
<section id="build-dependencies">
<h3>Build Dependencies<a class="headerlink" href="#build-dependencies" title="Permalink to this heading">&para;</a></h3>
<p>In addition to the libraries included with cudatoolkit 11.0+, there are some other dependencies below for building RAFT from source. Many of the dependencies are optional and depend only on the primitives being used. All of these can be installed with cmake or <a class="reference external" href="https://github.com/rapidsai/rapids-cmake#cpm">rapids-cpm</a> and many of them can be installed with <a class="reference external" href="https://anaconda.org">conda</a>.</p>
<section id="required">
<h4>Required<a class="headerlink" href="#required" title="Permalink to this heading">&para;</a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/rapidsai/rmm">RMM</a> corresponding to RAFT version.</p></li>
<li><p><a class="reference external" href="https://github.com/NVIDIA/thrust">Thrust</a> v1.17 / <a class="reference external" href="https://github.com/NVIDIA/cub">CUB</a></p></li>
</ul>
</section>
<section id="optional">
<h4>Optional<a class="headerlink" href="#optional" title="Permalink to this heading">&para;</a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/NVIDIA/cuCollections">cuCollections</a> - Used in <code class="docutils literal notranslate"><span class="pre">raft::sparse::distance</span></code> API.</p></li>
<li><p><a class="reference external" href="https://github.com/NVIDIA/libcudacxx">Libcu++</a> v1.7.0</p></li>
<li><p><a class="reference external" href="https://github.com/facebookresearch/faiss">FAISS</a> v1.7.0 - Used in <code class="docutils literal notranslate"><span class="pre">raft::spatial::knn</span></code> API and needed to build tests.</p></li>
<li><p><a class="reference external" href="https://github.com/NVIDIA/nccl">NCCL</a> - Used in <code class="docutils literal notranslate"><span class="pre">raft::comms</span></code> API and needed to build <code class="docutils literal notranslate"><span class="pre">raft-dask</span></code></p></li>
<li><p><a class="reference external" href="https://github.com/openucx/ucx">UCX</a> - Used in <code class="docutils literal notranslate"><span class="pre">raft::comms</span></code> API and needed to build <code class="docutils literal notranslate"><span class="pre">raft-dask</span></code></p></li>
<li><p><a class="reference external" href="https://github.com/google/googletest">Googletest</a> - Needed to build tests</p></li>
<li><p><a class="reference external" href="https://github.com/google/benchmark">Googlebench</a> - Needed to build benchmarks</p></li>
<li><p><a class="reference external" href="https://github.com/doxygen/doxygen">Doxygen</a> - Needed to build docs</p></li>
</ul>
<p>C++ RAFT is a header-only library but provides the option of building shared libraries with template instantiations for common types to speed up compile times for larger projects.</p>
<p>The recommended way to build and install RAFT is to use the <code class="docutils literal notranslate"><span class="pre">build.sh</span></code> script in the root of the repository. This script can build both the C++ and Python artifacts and provides options for building and installing the headers, tests, benchmarks, and individual shared libraries.</p>
</section>
</section>
<section id="header-only-c">
<h3>Header-only C++<a class="headerlink" href="#header-only-c" title="Permalink to this heading">&para;</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">build.sh</span></code> uses <a class="reference external" href="https://github.com/rapidsai/rapids-cmake">rapids-cmake</a>, which will automatically download any dependencies which are not already installed. It&rsquo;s important to note that while all the headers will be installed and available, some parts of the RAFT API depend on libraries like <code class="docutils literal notranslate"><span class="pre">FAISS</span></code>, which will need to be explicitly enabled in <code class="docutils literal notranslate"><span class="pre">build.sh</span></code>.</p>
<p>The following example will download the needed dependencies and install the RAFT headers into <code class="docutils literal notranslate"><span class="pre">$INSTALL_PREFIX/include/raft</span></code>. The <code class="docutils literal notranslate"><span class="pre">--install</span></code> flag can be omitted to just have the build download the needed dependencies. Since RAFT is primarily used at build-time, the dependencies will never be installed by the RAFT build, with the exception of building FAISS statically into the shared libraries.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft --install
</pre></div>
</div>
</section>
<section id="c-shared-libraries-optional">
<h3>C++ Shared Libraries (optional)<a class="headerlink" href="#c-shared-libraries-optional" title="Permalink to this heading">&para;</a></h3>
<p>For larger projects which make heavy use of the pairwise distances or nearest neighbors APIs, shared libraries can be built to speed up compile times. These shared libraries can also significantly improve re-compile times both while developing RAFT and developing against the APIs. Build all of the available shared libraries by passing <code class="docutils literal notranslate"><span class="pre">--compile-libs</span></code> flag to <code class="docutils literal notranslate"><span class="pre">build.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft --compile-libs
</pre></div>
</div>
<p>Individual shared libraries have their own flags and multiple can be used (though currently only the <code class="docutils literal notranslate"><span class="pre">nn</span></code> and <code class="docutils literal notranslate"><span class="pre">distance</span></code> packages contain shared libraries):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft --compile-nn --compile-dist
</pre></div>
</div>
<p>Add the <code class="docutils literal notranslate"><span class="pre">--install</span></code> flag to the above example to also install the shared libraries into <code class="docutils literal notranslate"><span class="pre">$INSTALL_PREFIX/lib</span></code>.</p>
</section>
<section id="ccache-and-sccache">
<h3>ccache and sccache<a class="headerlink" href="#ccache-and-sccache" title="Permalink to this heading">&para;</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ccache</span></code> and <code class="docutils literal notranslate"><span class="pre">sccache</span></code> can be used to better cache parts of the build when rebuilding frequently, such as when working on a new feature. You can also use <code class="docutils literal notranslate"><span class="pre">ccache</span></code> or <code class="docutils literal notranslate"><span class="pre">sccache</span></code> with <code class="docutils literal notranslate"><span class="pre">build.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft --cache-tool<span class="o">=</span>ccache
</pre></div>
</div>
</section>
<section id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Permalink to this heading">&para;</a></h3>
<p>Compile the tests using the <code class="docutils literal notranslate"><span class="pre">tests</span></code> target in <code class="docutils literal notranslate"><span class="pre">build.sh</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft tests
</pre></div>
</div>
<p>Test compile times can be improved significantly by using the optional shared libraries. If installed, they will be used automatically when building the tests but <code class="docutils literal notranslate"><span class="pre">--compile-libs</span></code> can be used to add additional compilation units and compile them with the tests.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft tests --compile-libs
</pre></div>
</div>
<p>The tests are broken apart by algorithm category, so you will find several binaries in <code class="docutils literal notranslate"><span class="pre">cpp/build/</span></code> named <code class="docutils literal notranslate"><span class="pre">*_TEST</span></code>.</p>
<p>For example, to run the distance tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./cpp/build/DISTANCE_TEST
</pre></div>
</div>
<p>It can take sometime to compile all of the tests. You can build individual tests by providing a semicolon-separated list to the <code class="docutils literal notranslate"><span class="pre">--limit-tests</span></code> option in <code class="docutils literal notranslate"><span class="pre">build.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft tests --limit-tests<span class="o">=</span>NEIGHBORS_TEST<span class="p">;</span>DISTANCE_TEST<span class="p">;</span>MATRIX_TEST
</pre></div>
</div>
</section>
<section id="benchmarks">
<h3>Benchmarks<a class="headerlink" href="#benchmarks" title="Permalink to this heading">&para;</a></h3>
<p>The benchmarks are broken apart by algorithm category, so you will find several binaries in <code class="docutils literal notranslate"><span class="pre">cpp/build/</span></code> named <code class="docutils literal notranslate"><span class="pre">*_BENCH</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft bench
</pre></div>
</div>
<p>It can take sometime to compile all of the benchmarks. You can build individual benchmarks by providing a semicolon-separated list to the <code class="docutils literal notranslate"><span class="pre">--limit-bench</span></code> option in <code class="docutils literal notranslate"><span class="pre">build.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh libraft bench --limit-bench<span class="o">=</span>NEIGHBORS_BENCH<span class="p">;</span>DISTANCE_BENCH<span class="p">;</span>LINALG_BENCH
</pre></div>
</div>
</section>
<section id="c-using-cmake">
<h3>C++ Using Cmake<a class="headerlink" href="#c-using-cmake" title="Permalink to this heading">&para;</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> to install RAFT into a specific location. The snippet below will install it into the current conda environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> cpp
mkdir build
<span class="nb">cd</span> build
cmake -D <span class="nv">BUILD_TESTS</span><span class="o">=</span>ON -DRAFT_COMPILE_LIBRARIES<span class="o">=</span>ON -DRAFT_ENABLE_NN_DEPENDENCIES<span class="o">=</span>ON  -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$CONDA_PREFIX</span> ../
make -j&lt;parallel_level&gt; install
</pre></div>
</div>
<p>RAFT&rsquo;s cmake has the following configurable flags available:.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Flag</th>
<th>Possible Values</th>
<th>Default Value</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td>BUILD_TESTS</td>
<td>ON, OFF</td>
<td>ON</td>
<td>Compile Googletests</td>
</tr>
<tr>
<td>BUILD_BENCH</td>
<td>ON, OFF</td>
<td>ON</td>
<td>Compile benchmarks</td>
</tr>
<tr>
<td>raft_FIND_COMPONENTS</td>
<td>nn distance</td>
<td></td>
<td>Configures the optional components as a space-separated list</td>
</tr>
<tr>
<td>RAFT_COMPILE_LIBRARIES</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Compiles all <code>libraft</code> shared libraries (these are required for Googletests)</td>
</tr>
<tr>
<td>RAFT_COMPILE_NN_LIBRARY</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Compiles the <code>libraft-nn</code> shared library</td>
</tr>
<tr>
<td>RAFT_COMPILE_DIST_LIBRARY</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Compiles the <code>libraft-distance</code> shared library</td>
</tr>
<tr>
<td>RAFT_ENABLE_NN_DEPENDENCIES</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Searches for dependencies of nearest neighbors API, such as FAISS, and compiles them if not found. Needed for <code>raft::spatial::knn</code></td>
</tr>
<tr>
<td>RAFT_USE_FAISS_STATIC</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Statically link FAISS into <code>libraft-nn</code></td>
</tr>
<tr>
<td>RAFT_STATIC_LINK_LIBRARIES</td>
<td>ON, OFF</td>
<td>ON</td>
<td>Build static link libraries instead of shared libraries</td>
</tr>
<tr>
<td>DETECT_CONDA_ENV</td>
<td>ON, OFF</td>
<td>ON</td>
<td>Enable detection of conda environment for dependencies</td>
</tr>
<tr>
<td>NVTX</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Enable NVTX Markers</td>
</tr>
<tr>
<td>CUDA_ENABLE_KERNELINFO</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Enables <code>kernelinfo</code> in nvcc. This is useful for <code>compute-sanitizer</code></td>
</tr>
<tr>
<td>CUDA_ENABLE_LINEINFO</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Enable the -lineinfo option for nvcc</td>
</tr>
<tr>
<td>CUDA_STATIC_RUNTIME</td>
<td>ON, OFF</td>
<td>OFF</td>
<td>Statically link the CUDA runtime</td>
</tr>
</tbody>
</table><p>Currently, shared libraries are provided for the <code class="docutils literal notranslate"><span class="pre">libraft-nn</span></code> and <code class="docutils literal notranslate"><span class="pre">libraft-distance</span></code> components. The <code class="docutils literal notranslate"><span class="pre">libraft-nn</span></code> component depends upon <a class="reference external" href="https://github.com/facebookresearch/faiss">FAISS</a> and the <code class="docutils literal notranslate"><span class="pre">RAFT_ENABLE_NN_DEPENDENCIES</span></code> option will build it from source if it is not already installed.</p>
</section>
<section id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this heading">&para;</a></h3>
<p>Conda environment scripts are provided for installing the necessary dependencies for building and using the Python APIs. It is preferred to use <code class="docutils literal notranslate"><span class="pre">mamba</span></code>, as it provides significant speedup over <code class="docutils literal notranslate"><span class="pre">conda</span></code>. In addition you will have to manually install <code class="docutils literal notranslate"><span class="pre">nvcc</span></code> as it will not be installed as part of the conda environment. The following example will install create and install dependencies for a CUDA 11.5 conda environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mamba env create --name raft_env_name -f conda/environments/raft_dev_cuda11.5.yml
mamba activate raft_env_name
</pre></div>
</div>
<p>The Python APIs can be built and installed using the <code class="docutils literal notranslate"><span class="pre">build.sh</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># to build pylibraft</span>
./build.sh libraft pylibraft --install --compile-libs
<span class="c1"># to build raft-dask</span>
./build.sh libraft raft-dask --install --compile-libs
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">setup.py</span></code> can also be used to build the Python APIs manually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">python</span><span class="o">/</span><span class="n">raft</span><span class="o">-</span><span class="n">dask</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build_ext</span> <span class="o">--</span><span class="n">inplace</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>

<span class="n">cd</span> <span class="n">python</span><span class="o">/</span><span class="n">pylibraft</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build_ext</span> <span class="o">--</span><span class="n">inplace</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>To run the Python tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> python/raft-dask
py.test -s -v

<span class="nb">cd</span> python/pylibraft
py.test -s -v
</pre></div>
</div>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">&para;</a></h3>
<p>The documentation requires that the C++ headers and python packages have been built and installed.</p>
<p>The following will build the docs along with the C++ and Python packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">build</span><span class="o">.</span><span class="n">sh</span> <span class="n">libraft</span> <span class="n">pylibraft</span> <span class="n">raft</span><span class="o">-</span><span class="n">dask</span> <span class="n">docs</span> <span class="o">--</span><span class="nb">compile</span><span class="o">-</span><span class="n">libs</span> <span class="o">--</span><span class="n">install</span>
</pre></div>
</div>
</section>
</section>
<section id="using-raft-in-downstream-projects">
<h2>Using RAFT in downstream projects<a class="headerlink" href="#using-raft-in-downstream-projects" title="Permalink to this heading">&para;</a></h2>
<p>There are two different strategies for including RAFT in downstream projects, depending on whether or not the required dependencies are already installed and available on the <code class="docutils literal notranslate"><span class="pre">lib</span></code> and <code class="docutils literal notranslate"><span class="pre">include</span></code> paths.</p>
<section id="c-header-only-integration-using-cmake">
<h3>C++ header-only integration using cmake<a class="headerlink" href="#c-header-only-integration-using-cmake" title="Permalink to this heading">&para;</a></h3>
<p>When the needed <a class="reference external" href="#required_depenencies">build dependencies</a> are already satisfied, RAFT can be trivially integrated into downstream projects by cloning the repository and adding <code class="docutils literal notranslate"><span class="pre">cpp/include</span></code> from RAFT to the include path:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">RAFT_GIT_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span><span class="s">/raft</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">STRING</span><span class="w"> </span><span class="s2">"Path to RAFT repo"</span><span class="p">)</span>
<span class="nb">ExternalProject_Add</span><span class="p">(</span><span class="s">raft</span>
<span class="w">  </span><span class="s">GIT_REPOSITORY</span><span class="w">    </span><span class="s">git@github.com:rapidsai/raft.git</span>
<span class="w">  </span><span class="s">GIT_TAG</span><span class="w">           </span><span class="s">branch-22.10</span>
<span class="w">  </span><span class="s">PREFIX</span><span class="w">            </span><span class="o">${</span><span class="nv">RAFT_GIT_DIR</span><span class="o">}</span>
<span class="w">  </span><span class="s">CONFIGURE_COMMAND</span><span class="w"> </span><span class="s2">""</span>
<span class="w">  </span><span class="s">BUILD_COMMAND</span><span class="w">     </span><span class="s2">""</span>
<span class="w">  </span><span class="s">INSTALL_COMMAND</span><span class="w">   </span><span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">RAFT_INCLUDE_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">RAFT_GIT_DIR</span><span class="o">}</span><span class="s">/raft/cpp/include</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">STRING</span><span class="w"> </span><span class="s2">"RAFT include variable"</span><span class="p">)</span>
</pre></div>
</div>
<p>If RAFT has already been installed, such as by using the <code class="docutils literal notranslate"><span class="pre">build.sh</span></code> script, use <code class="docutils literal notranslate"><span class="pre">find_package(raft)</span></code> and the <code class="docutils literal notranslate"><span class="pre">raft::raft</span></code> target if using RAFT to interact only with the public APIs of consuming projects.</p>
</section>
<section id="using-pre-compiled-shared-libraries">
<h3>Using pre-compiled shared libraries<a class="headerlink" href="#using-pre-compiled-shared-libraries" title="Permalink to this heading">&para;</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">find_package(raft</span> <span class="pre">COMPONENTS</span> <span class="pre">nn</span> <span class="pre">distance)</span></code> to enable the shared libraries and transitively pass dependencies through separate targets for each component. In this example, the <code class="docutils literal notranslate"><span class="pre">raft::distance</span></code> and <code class="docutils literal notranslate"><span class="pre">raft::nn</span></code> targets will be available for configuring linking paths in addition to <code class="docutils literal notranslate"><span class="pre">raft::raft</span></code>. These targets will also pass through any transitive dependencies (such as FAISS for the <code class="docutils literal notranslate"><span class="pre">nn</span></code> package).</p>
<p>The pre-compiled libraries contain template specializations for commonly used types, such as single- and double-precision floating-point. In order to use the symbols in the pre-compiled libraries, the compiler needs to be told not to instantiate templates that are already contained in the shared libraries. By convention, these header files are named <code class="docutils literal notranslate"><span class="pre">specializations.hpp</span></code> and located in the base directory for the packages that contain specializations.</p>
<p>The following example tells the compiler to ignore the pre-compiled templates for the <code class="docutils literal notranslate"><span class="pre">libraft-distance</span></code> API so any symbols already compiled into pre-compiled shared library will be used instead:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;raft/distance/distance.cuh&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;raft/distance/specializations.cuh&gt;</span><span class="cp"></span>
</pre></div>
</div>
</section>
<section id="building-raft-c-from-source-in-cmake">
<h3>Building RAFT C++ from source in cmake<a class="headerlink" href="#building-raft-c-from-source-in-cmake" title="Permalink to this heading">&para;</a></h3>
<p>RAFT uses the <a class="reference external" href="https://github.com/rapidsai/rapids-cmake">RAPIDS-CMake</a> library so it can be more easily included into downstream projects. RAPIDS cmake provides a convenience layer around the <a class="reference external" href="https://github.com/cpm-cmake/CPM.cmake">CMake Package Manager (CPM)</a>.</p>
<p>The following example is similar to invoking <code class="docutils literal notranslate"><span class="pre">find_package(raft)</span></code> but uses <code class="docutils literal notranslate"><span class="pre">rapids_cpm_find</span></code>, which provides a richer and more flexible configuration landscape by using CPM to fetch any dependencies not already available to the build. The <code class="docutils literal notranslate"><span class="pre">raft::raft</span></code> link target will be made available and it&rsquo;s recommended that it be used as a <code class="docutils literal notranslate"><span class="pre">PRIVATE</span></code> link dependency in downstream projects. The <code class="docutils literal notranslate"><span class="pre">COMPILE_LIBRARIES</span></code> option enables the building the shared libraries.</p>
<p>The following <code class="docutils literal notranslate"><span class="pre">cmake</span></code> snippet enables a flexible configuration of RAFT:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span>
set(RAFT_VERSION "22.10")
set(RAFT_FORK "rapidsai")
set(RAFT_PINNED_TAG "branch-${RAFT_VERSION}")

function(find_and_configure_raft)
  set(oneValueArgs VERSION FORK PINNED_TAG USE_FAISS_STATIC
          COMPILE_LIBRARIES ENABLE_NN_DEPENDENCIES CLONE_ON_PIN
          USE_NN_LIBRARY USE_DISTANCE_LIBRARY
          ENABLE_thrust_DEPENDENCY)
  cmake_parse_arguments(PKG "${options}" "${oneValueArgs}"
                            "${multiValueArgs}" ${ARGN} )

  #-----------------------------------------------------
  # Clone RAFT locally if PINNED_TAG has been changed
  #-----------------------------------------------------
  if(PKG_CLONE_ON_PIN AND NOT PKG_PINNED_TAG STREQUAL "branch-${RAFT_VERSION}")
    message("Pinned tag found: ${PKG_PINNED_TAG}. Cloning raft locally.")
    set(CPM_DOWNLOAD_raft ON)
    set(CMAKE_IGNORE_PATH "${CMAKE_INSTALL_PREFIX}/include/raft;${CMAKE_IGNORE_PATH})
  endif()

  #-----------------------------------------------------
  # Add components
  #-----------------------------------------------------

  if(PKG_USE_NN_LIBRARY)
    string(APPEND RAFT_COMPONENTS " nn")
  endif()

  if(PKG_USE_DISTANCE_LIBRARY)
    string(APPEND RAFT_COMPONENTS " distance")
  endif()

  #-----------------------------------------------------
  # Invoke CPM find_package()
  #-----------------------------------------------------

  rapids_cpm_find(raft ${PKG_VERSION}
          GLOBAL_TARGETS      raft::raft
          BUILD_EXPORT_SET    projname-exports
          INSTALL_EXPORT_SET  projname-exports
          CPM_ARGS
          GIT_REPOSITORY https://github.com/${PKG_FORK}/raft.git
          GIT_TAG        ${PKG_PINNED_TAG}
          SOURCE_SUBDIR  cpp
          FIND_PACKAGE_ARGUMENTS "COMPONENTS ${RAFT_COMPONENTS}"
          OPTIONS
          "BUILD_TESTS OFF"
          "BUILD_BENCH OFF"
          "RAFT_ENABLE_NN_DEPENDENCIES ${PKG_ENABLE_NN_DEPENDENCIES}"
          "RAFT_USE_FAISS_STATIC ${PKG_USE_FAISS_STATIC}"
          "RAFT_COMPILE_LIBRARIES ${PKG_COMPILE_LIBRARIES}"
          "RAFT_ENABLE_thrust_DEPENDENCY ${PKG_ENABLE_thrust_DEPENDENCY}"
  )

endfunction()

# Change pinned tag here to test a commit in CI
# To use a different RAFT locally, set the CMake variable
# CPM_raft_SOURCE=/path/to/local/raft
find_and_configure_raft(VERSION    ${RAFT_VERSION}.00
        FORK             ${RAFT_FORK}
        PINNED_TAG       ${RAFT_PINNED_TAG}

        # When PINNED_TAG above doesn't match cuml,
        # force local raft clone in build directory
        # even if it's already installed.
        CLONE_ON_PIN     ON

        COMPILE_LIBRARIES        NO
        USE_NN_LIBRARY           NO
        USE_DISTANCE_LIBRARY     NO
        ENABLE_NN_DEPENDENCIES   NO  # This builds FAISS if not installed
        USE_FAISS_STATIC         NO
        ENABLE_thrust_DEPENDENCY YES
)
</pre></div>
</div>
<p>If using the nearest neighbors APIs without the shared libraries, set <code class="docutils literal notranslate"><span class="pre">ENABLE_NN_DEPENDENCIES=ON</span></code> and keep <code class="docutils literal notranslate"><span class="pre">USE_NN_LIBRARY=OFF</span></code></p>
</section>
<section id="python-cython-integration">
<h3>Python/Cython Integration<a class="headerlink" href="#python-cython-integration" title="Permalink to this heading">&para;</a></h3>
<p>Once installed, RAFT&rsquo;s Python library can be added to downstream conda recipes, imported and used directly.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div aria-label="Footer" class="rst-footer-buttons" role="navigation">
        <a accesskey="p" class="btn btn-neutral float-left" href="quick_start.html" rel="prev" title="Quick Start"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
        <a accesskey="n" class="btn btn-neutral float-right" href="cpp_api.html" rel="next" title="C++ API Reference">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
    <p>&copy; Copyright 2022, nvidia.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 


<script defer id="rapids-selector-js" src="/assets/js/custom.js"></script><script id="rapids-selector-pixel-invocation" type="text/javascript">_satellite.pageBottom();</script></body></html>