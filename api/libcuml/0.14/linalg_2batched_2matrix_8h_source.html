<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/xhtml;charset=utf-8" http-equiv="Content-Type"/>
  <meta content="IE=9" http-equiv="X-UA-Compatible"/>
  <meta content="Doxygen 1.8.18" name="generator"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   cuML C++ API: /rapids/cuml/cpp/src_prims/linalg/batched/matrix.h Source File
  </title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script src="jquery.js" type="text/javascript">
  </script>
  <script src="dynsections.js" type="text/javascript">
  </script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
  <script src="search/searchdata.js" type="text/javascript">
  </script>
  <script src="search/search.js" type="text/javascript">
  </script>
  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
  </script>
  <script async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js" type="text/javascript">
  </script>
  <link href="doxygen.css" rel="stylesheet" type="text/css"/>
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" id="rapids-fa-tag" rel="stylesheet"/>
  <link href="/assets/css/custom.css" id="rapids-selector-css" rel="stylesheet"/>
 </head>
 <body>
  <div id="top">
   <!-- do not remove this div, it is closed by doxygen! -->
   <div id="titlearea">
    <div id="rapids-doxygen-container">
     <div class="rapids-home-container">
      <a class="rapids-home-container__home-btn" href="/api">
       Home
      </a>
     </div>
     <div class="rapids-selector__container rapids-selector--hidden">
      <div class="rapids-selector__selected">
       libcuml
      </div>
      <div class="rapids-selector__menu">
       <a class="rapids-selector__menu-item" href="/api/clx/stable/api.html">
        clx
       </a>
       <a class="rapids-selector__menu-item" href="/api/cudf/stable/api.html">
        cudf
       </a>
       <a class="rapids-selector__menu-item" href="/api/cugraph/stable/api.html">
        cugraph
       </a>
       <a class="rapids-selector__menu-item" href="/api/cuml/stable/api.html">
        cuml
       </a>
       <a class="rapids-selector__menu-item" href="/api/cusignal/stable/api.html">
        cusignal
       </a>
       <a class="rapids-selector__menu-item" href="/api/cuspatial/stable/api.html">
        cuspatial
       </a>
       <a class="rapids-selector__menu-item" href="/api/cuxfilter/stable">
        cuxfilter
       </a>
       <a class="rapids-selector__menu-item" href="/api/libcudf/stable/namespacecudf.html">
        libcudf
       </a>
       <a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/libcuml/nightly">
        libcuml
       </a>
       <a class="rapids-selector__menu-item" href="/api/libnvstrings/stable/annotated.html">
        libnvstrings
       </a>
       <a class="rapids-selector__menu-item" href="/api/nvstrings/stable/api.html">
        nvstrings
       </a>
       <a class="rapids-selector__menu-item" href="/api/rmm/stable/annotated.html">
        rmm
       </a>
      </div>
     </div>
     <div class="rapids-selector__container rapids-selector--hidden">
      <div class="rapids-selector__selected">
       nightly (0.14)
      </div>
      <div class="rapids-selector__menu">
       <a class="rapids-selector__menu-item rapids-selector__menu-item--selected" href="/api/libcuml/nightly">
        nightly (0.14)
       </a>
      </div>
     </div>
    </div>
   </div>
   <!-- end header part -->
   <!-- Generated by Doxygen 1.8.18 -->
   <script type="text/javascript">
    /* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
   </script>
   <script src="menudata.js" type="text/javascript">
   </script>
   <script src="menu.js" type="text/javascript">
   </script>
   <script type="text/javascript">
    /* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
   </script>
   <div id="main-nav">
   </div>
   <!-- window showing the filter options -->
   <div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()">
   </div>
   <!-- iframe showing the search results (closed by default) -->
   <div id="MSearchResultsWindow">
    <iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)">
    </iframe>
   </div>
   <div class="navpath" id="nav-path">
    <ul>
     <li class="navelem">
      <a class="el" href="dir_315b94e79867468f41545f9cefee499a.html">
       src_prims
      </a>
     </li>
     <li class="navelem">
      <a class="el" href="dir_d03ad1aa6845390234e016eecc006914.html">
       linalg
      </a>
     </li>
     <li class="navelem">
      <a class="el" href="dir_95858edebcc6d4e8b4941970a9d504a9.html">
       batched
      </a>
     </li>
    </ul>
   </div>
  </div>
  <!-- top -->
  <div class="header">
   <div class="headertitle">
    <div class="title">
     matrix.h
    </div>
   </div>
  </div>
  <!--header-->
  <div class="contents">
   <a href="linalg_2batched_2matrix_8h.html">
    Go to the documentation of this file.
   </a>
   <div class="fragment">
    <div class="line">
     <a name="l00001">
     </a>
     <span class="lineno">
      1
     </span>
     <span class="comment">
      /*
     </span>
    </div>
    <div class="line">
     <a name="l00002">
     </a>
     <span class="lineno">
      2
     </span>
     <span class="comment">
      * Copyright (c) 2019-2020, NVIDIA CORPORATION.
     </span>
    </div>
    <div class="line">
     <a name="l00003">
     </a>
     <span class="lineno">
      3
     </span>
     <span class="comment">
      *
     </span>
    </div>
    <div class="line">
     <a name="l00004">
     </a>
     <span class="lineno">
      4
     </span>
     <span class="comment">
      * Licensed under the Apache License, Version 2.0 (the "License");
     </span>
    </div>
    <div class="line">
     <a name="l00005">
     </a>
     <span class="lineno">
      5
     </span>
     <span class="comment">
      * you may not use this file except in compliance with the License.
     </span>
    </div>
    <div class="line">
     <a name="l00006">
     </a>
     <span class="lineno">
      6
     </span>
     <span class="comment">
      * You may obtain a copy of the License at
     </span>
    </div>
    <div class="line">
     <a name="l00007">
     </a>
     <span class="lineno">
      7
     </span>
     <span class="comment">
      *
     </span>
    </div>
    <div class="line">
     <a name="l00008">
     </a>
     <span class="lineno">
      8
     </span>
     <span class="comment">
      *     http://www.apache.org/licenses/LICENSE-2.0
     </span>
    </div>
    <div class="line">
     <a name="l00009">
     </a>
     <span class="lineno">
      9
     </span>
     <span class="comment">
      *
     </span>
    </div>
    <div class="line">
     <a name="l00010">
     </a>
     <span class="lineno">
      10
     </span>
     <span class="comment">
      * Unless required by applicable law or agreed to in writing, software
     </span>
    </div>
    <div class="line">
     <a name="l00011">
     </a>
     <span class="lineno">
      11
     </span>
     <span class="comment">
      * distributed under the License is distributed on an "AS IS" BASIS,
     </span>
    </div>
    <div class="line">
     <a name="l00012">
     </a>
     <span class="lineno">
      12
     </span>
     <span class="comment">
      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     </span>
    </div>
    <div class="line">
     <a name="l00013">
     </a>
     <span class="lineno">
      13
     </span>
     <span class="comment">
      * See the License for the specific language governing permissions and
     </span>
    </div>
    <div class="line">
     <a name="l00014">
     </a>
     <span class="lineno">
      14
     </span>
     <span class="comment">
      * limitations under the License.
     </span>
    </div>
    <div class="line">
     <a name="l00015">
     </a>
     <span class="lineno">
      15
     </span>
     <span class="comment">
      */
     </span>
    </div>
    <div class="line">
     <a name="l00016">
     </a>
     <span class="lineno">
      16
     </span>
    </div>
    <div class="line">
     <a name="l00017">
     </a>
     <span class="lineno">
      17
     </span>
     <span class="preprocessor">
      #pragma once
     </span>
    </div>
    <div class="line">
     <a name="l00018">
     </a>
     <span class="lineno">
      18
     </span>
    </div>
    <div class="line">
     <a name="l00019">
     </a>
     <span class="lineno">
      19
     </span>
     <span class="preprocessor">
      #include &lt;functional&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00020">
     </a>
     <span class="lineno">
      20
     </span>
     <span class="preprocessor">
      #include &lt;memory&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00021">
     </a>
     <span class="lineno">
      21
     </span>
     <span class="preprocessor">
      #include &lt;stdexcept&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00022">
     </a>
     <span class="lineno">
      22
     </span>
     <span class="preprocessor">
      #include &lt;tuple&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00023">
     </a>
     <span class="lineno">
      23
     </span>
     <span class="preprocessor">
      #include &lt;type_traits&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00024">
     </a>
     <span class="lineno">
      24
     </span>
     <span class="preprocessor">
      #include &lt;unordered_map&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00025">
     </a>
     <span class="lineno">
      25
     </span>
     <span class="preprocessor">
      #include &lt;vector&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00026">
     </a>
     <span class="lineno">
      26
     </span>
    </div>
    <div class="line">
     <a name="l00027">
     </a>
     <span class="lineno">
      27
     </span>
     <span class="preprocessor">
      #include &lt;thrust/execution_policy.h&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00028">
     </a>
     <span class="lineno">
      28
     </span>
     <span class="preprocessor">
      #include &lt;thrust/for_each.h&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00029">
     </a>
     <span class="lineno">
      29
     </span>
     <span class="preprocessor">
      #include &lt;thrust/iterator/counting_iterator.h&gt;
     </span>
    </div>
    <div class="line">
     <a name="l00030">
     </a>
     <span class="lineno">
      30
     </span>
    </div>
    <div class="line">
     <a name="l00031">
     </a>
     <span class="lineno">
      31
     </span>
     <span class="preprocessor">
      #include &lt;
      <a class="code" href="utils_8hpp.html">
       cuml/common/utils.hpp
      </a>
      &gt;
     </span>
    </div>
    <div class="line">
     <a name="l00032">
     </a>
     <span class="lineno">
      32
     </span>
     <span class="preprocessor">
      #include &lt;
      <a class="code" href="cuml_8hpp.html">
       cuml/cuml.hpp
      </a>
      &gt;
     </span>
    </div>
    <div class="line">
     <a name="l00033">
     </a>
     <span class="lineno">
      33
     </span>
    </div>
    <div class="line">
     <a name="l00034">
     </a>
     <span class="lineno">
      34
     </span>
     <span class="preprocessor">
      #include &lt;
      <a class="code" href="binary__op_8h.html">
       linalg/binary_op.h
      </a>
      &gt;
     </span>
    </div>
    <div class="line">
     <a name="l00035">
     </a>
     <span class="lineno">
      35
     </span>
     <span class="preprocessor">
      #include &lt;
      <a class="code" href="cublas__wrappers_8h.html">
       linalg/cublas_wrappers.h
      </a>
      &gt;
     </span>
    </div>
    <div class="line">
     <a name="l00036">
     </a>
     <span class="lineno">
      36
     </span>
     <span class="preprocessor">
      #include &lt;
      <a class="code" href="unary__op_8h.html">
       linalg/unary_op.h
      </a>
      &gt;
     </span>
    </div>
    <div class="line">
     <a name="l00037">
     </a>
     <span class="lineno">
      37
     </span>
     <span class="preprocessor">
      #include &lt;
      <a class="code" href="device__buffer_8hpp.html">
       common/device_buffer.hpp
      </a>
      &gt;
     </span>
    </div>
    <div class="line">
     <a name="l00038">
     </a>
     <span class="lineno">
      38
     </span>
    </div>
    <div class="line">
     <a name="l00039">
     </a>
     <span class="lineno">
      39
     </span>
     <span class="preprocessor">
      #include &lt;
      <a class="code" href="cudart__utils_8h.html">
       common/cudart_utils.h
      </a>
      &gt;
     </span>
    </div>
    <div class="line">
     <a name="l00040">
     </a>
     <span class="lineno">
      40
     </span>
     <span class="preprocessor">
      #include "
      <a class="code" href="cuda__utils_8h.html">
       cuda_utils.h
      </a>
      "
     </span>
    </div>
    <div class="line">
     <a name="l00041">
     </a>
     <span class="lineno">
      41
     </span>
    </div>
    <div class="line">
     <a name="l00042">
     </a>
     <span class="lineno">
      42
     </span>
     <span class="keyword">
      namespace
     </span>
     <a class="code" href="namespaceMLCommon.html">
      MLCommon
     </a>
     {
    </div>
    <div class="line">
     <a name="l00043">
     </a>
     <span class="lineno">
      43
     </span>
     <span class="keyword">
      namespace
     </span>
     LinAlg {
    </div>
    <div class="line">
     <a name="l00044">
     </a>
     <span class="lineno">
      44
     </span>
     <span class="keyword">
      namespace
     </span>
     Batched {
    </div>
    <div class="line">
     <a name="l00045">
     </a>
     <span class="lineno">
      45
     </span>
    </div>
    <div class="line">
     <a name="l00055">
     </a>
     <span class="lineno">
      55
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00056">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a64c202bf9c116c020e4ee6752a359bbb">
       56
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a64c202bf9c116c020e4ee6752a359bbb">
      identity_matrix_kernel
     </a>
     (T* I,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00057">
     </a>
     <span class="lineno">
      57
     </span>
     T* I_b = I + blockIdx.x *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00058">
     </a>
     <span class="lineno">
      58
     </span>
     <span class="keywordtype">
      int
     </span>
     stride = (
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     + 1);
    </div>
    <div class="line">
     <a name="l00059">
     </a>
     <span class="lineno">
      59
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     idx = threadIdx.x; idx &lt;
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ; idx += blockDim.x) {
    </div>
    <div class="line">
     <a name="l00060">
     </a>
     <span class="lineno">
      60
     </span>
     I_b[idx * stride] = 1;
    </div>
    <div class="line">
     <a name="l00061">
     </a>
     <span class="lineno">
      61
     </span>
     }
    </div>
    <div class="line">
     <a name="l00062">
     </a>
     <span class="lineno">
      62
     </span>
     }
    </div>
    <div class="line">
     <a name="l00063">
     </a>
     <span class="lineno">
      63
     </span>
    </div>
    <div class="line">
     <a name="l00076">
     </a>
     <span class="lineno">
      76
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00077">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ad86c937c8a176a6d6a1447b54cd02225">
       77
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ad86c937c8a176a6d6a1447b54cd02225">
      batched_diff_kernel
     </a>
     (
     <span class="keyword">
      const
     </span>
     T* in, T* out,
     <span class="keywordtype">
      int
     </span>
     n_elem,
    </div>
    <div class="line">
     <a name="l00078">
     </a>
     <span class="lineno">
      78
     </span>
     <span class="keywordtype">
      int
     </span>
     period = 1) {
    </div>
    <div class="line">
     <a name="l00079">
     </a>
     <span class="lineno">
      79
     </span>
     <span class="keyword">
      const
     </span>
     T* batch_in = in + n_elem * blockIdx.x;
    </div>
    <div class="line">
     <a name="l00080">
     </a>
     <span class="lineno">
      80
     </span>
     T* batch_out = out + (n_elem - period) * blockIdx.x;
    </div>
    <div class="line">
     <a name="l00081">
     </a>
     <span class="lineno">
      81
     </span>
    </div>
    <div class="line">
     <a name="l00082">
     </a>
     <span class="lineno">
      82
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg.html#a1816f8bceb2b52d79599d2a30c9f8f11">
      for
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt; n_elem - period;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     += blockDim.x) {
    </div>
    <div class="line">
     <a name="l00083">
     </a>
     <span class="lineno">
      83
     </span>
     batch_out[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = batch_in[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + period] - batch_in[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l00084">
     </a>
     <span class="lineno">
      84
     </span>
     }
    </div>
    <div class="line">
     <a name="l00085">
     </a>
     <span class="lineno">
      85
     </span>
     }
    </div>
    <div class="line">
     <a name="l00086">
     </a>
     <span class="lineno">
      86
     </span>
    </div>
    <div class="line">
     <a name="l00100">
     </a>
     <span class="lineno">
      100
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00101">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a604f4154324d336395e4890ee52cf939">
       101
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a604f4154324d336395e4890ee52cf939">
      batched_second_diff_kernel
     </a>
     (
     <span class="keyword">
      const
     </span>
     T* in, T* out,
     <span class="keywordtype">
      int
     </span>
     n_elem,
    </div>
    <div class="line">
     <a name="l00102">
     </a>
     <span class="lineno">
      102
     </span>
     <span class="keywordtype">
      int
     </span>
     period1 = 1,
     <span class="keywordtype">
      int
     </span>
     period2 = 1) {
    </div>
    <div class="line">
     <a name="l00103">
     </a>
     <span class="lineno">
      103
     </span>
     <span class="keyword">
      const
     </span>
     T* batch_in = in + n_elem * blockIdx.x;
    </div>
    <div class="line">
     <a name="l00104">
     </a>
     <span class="lineno">
      104
     </span>
     T* batch_out = out + (n_elem - period1 - period2) * blockIdx.x;
    </div>
    <div class="line">
     <a name="l00105">
     </a>
     <span class="lineno">
      105
     </span>
    </div>
    <div class="line">
     <a name="l00106">
     </a>
     <span class="lineno">
      106
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg.html#a1816f8bceb2b52d79599d2a30c9f8f11">
      for
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt; n_elem - period1 - period2;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     += blockDim.x) {
    </div>
    <div class="line">
     <a name="l00107">
     </a>
     <span class="lineno">
      107
     </span>
     batch_out[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = batch_in[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + period1 + period2] - batch_in[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + period1] -
    </div>
    <div class="line">
     <a name="l00108">
     </a>
     <span class="lineno">
      108
     </span>
     batch_in[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + period2] + batch_in[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l00109">
     </a>
     <span class="lineno">
      109
     </span>
     }
    </div>
    <div class="line">
     <a name="l00110">
     </a>
     <span class="lineno">
      110
     </span>
     }
    </div>
    <div class="line">
     <a name="l00111">
     </a>
     <span class="lineno">
      111
     </span>
    </div>
    <div class="line">
     <a name="l00122">
     </a>
     <span class="lineno">
      122
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00123">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a3be0f92cde027422394bd7370a4fe09b">
       123
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a3be0f92cde027422394bd7370a4fe09b">
      fill_strided_pointers_kernel
     </a>
     (T* A_dense, T** A_array,
    </div>
    <div class="line">
     <a name="l00124">
     </a>
     <span class="lineno">
      124
     </span>
     <span class="keywordtype">
      int
     </span>
     batch_size,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00125">
     </a>
     <span class="lineno">
      125
     </span>
     <span class="keywordtype">
      int
     </span>
     bid = blockIdx.x * blockDim.x + threadIdx.x;
    </div>
    <div class="line">
     <a name="l00126">
     </a>
     <span class="lineno">
      126
     </span>
     <span class="keywordflow">
      if
     </span>
     (bid &lt; batch_size) {
    </div>
    <div class="line">
     <a name="l00127">
     </a>
     <span class="lineno">
      127
     </span>
     A_array[bid] = A_dense + bid *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00128">
     </a>
     <span class="lineno">
      128
     </span>
     }
    </div>
    <div class="line">
     <a name="l00129">
     </a>
     <span class="lineno">
      129
     </span>
     }
    </div>
    <div class="line">
     <a name="l00130">
     </a>
     <span class="lineno">
      130
     </span>
    </div>
    <div class="line">
     <a name="l00135">
     </a>
     <span class="lineno">
      135
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00136">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
       136
      </a>
     </span>
     <span class="keyword">
      class
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix
     </a>
     {
    </div>
    <div class="line">
     <a name="l00137">
     </a>
     <span class="lineno">
      137
     </span>
     <span class="keyword">
      protected
     </span>
     :
    </div>
    <div class="line">
     <a name="l00143">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a3ade2fb038790850c9a19ae7c4a25f2e">
       143
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a3ade2fb038790850c9a19ae7c4a25f2e">
      initialize
     </a>
     (
     <span class="keywordtype">
      bool
     </span>
     setZero =
     <span class="keyword">
      false
     </span>
     ) {
    </div>
    <div class="line">
     <a name="l00144">
     </a>
     <span class="lineno">
      144
     </span>
     <span class="comment">
      // Fill with zeros if requested
     </span>
    </div>
    <div class="line">
     <a name="l00145">
     </a>
     <span class="lineno">
      145
     </span>
     <span class="keywordflow">
      if
     </span>
     (setZero)
    </div>
    <div class="line">
     <a name="l00146">
     </a>
     <span class="lineno">
      146
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaMemsetAsync(
    </div>
    <div class="line">
     <a name="l00147">
     </a>
     <span class="lineno">
      147
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(), 0,
    </div>
    <div class="line">
     <a name="l00148">
     </a>
     <span class="lineno">
      148
     </span>
     <span class="keyword">
      sizeof
     </span>
     (T) *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ));
    </div>
    <div class="line">
     <a name="l00149">
     </a>
     <span class="lineno">
      149
     </span>
    </div>
    <div class="line">
     <a name="l00150">
     </a>
     <span class="lineno">
      150
     </span>
     <span class="comment">
      // Fill array of pointers to each batch matrix.
     </span>
    </div>
    <div class="line">
     <a name="l00151">
     </a>
     <span class="lineno">
      151
     </span>
     constexpr
     <span class="keywordtype">
      int
     </span>
     TPB = 256;
    </div>
    <div class="line">
     <a name="l00152">
     </a>
     <span class="lineno">
      152
     </span>
     fill_strided_pointers_kernel&lt;&lt;&lt;ceildiv&lt;int&gt;(
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     , TPB), TPB, 0,
    </div>
    <div class="line">
     <a name="l00153">
     </a>
     <span class="lineno">
      153
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     &gt;&gt;&gt;(
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(),
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
      m_batches
     </a>
     .data(),
    </div>
    <div class="line">
     <a name="l00154">
     </a>
     <span class="lineno">
      154
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first,
    </div>
    <div class="line">
     <a name="l00155">
     </a>
     <span class="lineno">
      155
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second);
    </div>
    <div class="line">
     <a name="l00156">
     </a>
     <span class="lineno">
      156
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l00157">
     </a>
     <span class="lineno">
      157
     </span>
     }
    </div>
    <div class="line">
     <a name="l00158">
     </a>
     <span class="lineno">
      158
     </span>
    </div>
    <div class="line">
     <a name="l00159">
     </a>
     <span class="lineno">
      159
     </span>
     <span class="keyword">
      public
     </span>
     :
    </div>
    <div class="line">
     <a name="l00171">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab012618bd50366e13783399b3dc008f7">
       171
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab012618bd50366e13783399b3dc008f7">
      Matrix
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     batch_size, cublasHandle_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00172">
     </a>
     <span class="lineno">
      172
     </span>
     std::shared_ptr&lt;ML::deviceAllocator&gt;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     , cudaStream_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00173">
     </a>
     <span class="lineno">
      173
     </span>
     <span class="keywordtype">
      bool
     </span>
     setZero =
     <span class="keyword">
      true
     </span>
     )
    </div>
    <div class="line">
     <a name="l00174">
     </a>
     <span class="lineno">
      174
     </span>
     :
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     (batch_size),
    </div>
    <div class="line">
     <a name="l00175">
     </a>
     <span class="lineno">
      175
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00176">
     </a>
     <span class="lineno">
      176
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00177">
     </a>
     <span class="lineno">
      177
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00178">
     </a>
     <span class="lineno">
      178
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     (
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00179">
     </a>
     <span class="lineno">
      179
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
      m_batches
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     , batch_size),
    </div>
    <div class="line">
     <a name="l00180">
     </a>
     <span class="lineno">
      180
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ,
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * batch_size) {
    </div>
    <div class="line">
     <a name="l00181">
     </a>
     <span class="lineno">
      181
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a3ade2fb038790850c9a19ae7c4a25f2e">
      initialize
     </a>
     (setZero);
    </div>
    <div class="line">
     <a name="l00182">
     </a>
     <span class="lineno">
      182
     </span>
     }
    </div>
    <div class="line">
     <a name="l00183">
     </a>
     <span class="lineno">
      183
     </span>
    </div>
    <div class="line">
     <a name="l00185">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a647f742a2ac2a1701f38f80bdf06a59c">
       185
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a647f742a2ac2a1701f38f80bdf06a59c">
      ~Matrix
     </a>
     () {}
    </div>
    <div class="line">
     <a name="l00186">
     </a>
     <span class="lineno">
      186
     </span>
    </div>
    <div class="line">
     <a name="l00188">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abb84d37f0a8b444c1e611f4bc14f8870">
       188
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abb84d37f0a8b444c1e611f4bc14f8870">
      Matrix
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; other)
    </div>
    <div class="line">
     <a name="l00189">
     </a>
     <span class="lineno">
      189
     </span>
     :
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     (other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00190">
     </a>
     <span class="lineno">
      190
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     (other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00191">
     </a>
     <span class="lineno">
      191
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     (other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00192">
     </a>
     <span class="lineno">
      192
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     (other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00193">
     </a>
     <span class="lineno">
      193
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     (other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00194">
     </a>
     <span class="lineno">
      194
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
      m_batches
     </a>
     (other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     , other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     , other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ),
    </div>
    <div class="line">
     <a name="l00195">
     </a>
     <span class="lineno">
      195
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     (other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     , other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00196">
     </a>
     <span class="lineno">
      196
     </span>
     other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first * other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second * other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00197">
     </a>
     <span class="lineno">
      197
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a3ade2fb038790850c9a19ae7c4a25f2e">
      initialize
     </a>
     (
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00198">
     </a>
     <span class="lineno">
      198
     </span>
    </div>
    <div class="line">
     <a name="l00199">
     </a>
     <span class="lineno">
      199
     </span>
     <span class="comment">
      // Copy the raw data
     </span>
    </div>
    <div class="line">
     <a name="l00200">
     </a>
     <span class="lineno">
      200
     </span>
     <a class="code" href="namespaceMLCommon.html#afd611e92a01811c35ec733fd18112064">
      copy
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(), other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(),
    </div>
    <div class="line">
     <a name="l00201">
     </a>
     <span class="lineno">
      201
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00202">
     </a>
     <span class="lineno">
      202
     </span>
     }
    </div>
    <div class="line">
     <a name="l00203">
     </a>
     <span class="lineno">
      203
     </span>
    </div>
    <div class="line">
     <a name="l00205">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#afb1f4c85b2968212a2aa5014ce87bae8">
       205
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#afb1f4c85b2968212a2aa5014ce87bae8">
      operator=
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; other) {
    </div>
    <div class="line">
     <a name="l00206">
     </a>
     <span class="lineno">
      206
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     = other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00207">
     </a>
     <span class="lineno">
      207
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     = other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00208">
     </a>
     <span class="lineno">
      208
     </span>
    </div>
    <div class="line">
     <a name="l00209">
     </a>
     <span class="lineno">
      209
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
      m_batches
     </a>
     .resize(
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00210">
     </a>
     <span class="lineno">
      210
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .resize(
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00211">
     </a>
     <span class="lineno">
      211
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a3ade2fb038790850c9a19ae7c4a25f2e">
      initialize
     </a>
     (
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00212">
     </a>
     <span class="lineno">
      212
     </span>
    </div>
    <div class="line">
     <a name="l00213">
     </a>
     <span class="lineno">
      213
     </span>
     <span class="comment">
      // Copy the raw data
     </span>
    </div>
    <div class="line">
     <a name="l00214">
     </a>
     <span class="lineno">
      214
     </span>
     <a class="code" href="namespaceMLCommon.html#afd611e92a01811c35ec733fd18112064">
      copy
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(), other.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(),
    </div>
    <div class="line">
     <a name="l00215">
     </a>
     <span class="lineno">
      215
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00216">
     </a>
     <span class="lineno">
      216
     </span>
    </div>
    <div class="line">
     <a name="l00217">
     </a>
     <span class="lineno">
      217
     </span>
     <span class="keywordflow">
      return
     </span>
     *
     <span class="keyword">
      this
     </span>
     ;
    </div>
    <div class="line">
     <a name="l00218">
     </a>
     <span class="lineno">
      218
     </span>
     }
    </div>
    <div class="line">
     <a name="l00219">
     </a>
     <span class="lineno">
      219
     </span>
    </div>
    <div class="line">
     <a name="l00221">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
       221
      </a>
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ; }
    </div>
    <div class="line">
     <a name="l00222">
     </a>
     <span class="lineno">
      222
     </span>
    </div>
    <div class="line">
     <a name="l00224">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
       224
      </a>
     </span>
     cublasHandle_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ; }
    </div>
    <div class="line">
     <a name="l00225">
     </a>
     <span class="lineno">
      225
     </span>
    </div>
    <div class="line">
     <a name="l00227">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
       227
      </a>
     </span>
     std::shared_ptr&lt;deviceAllocator&gt;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ; }
    </div>
    <div class="line">
     <a name="l00228">
     </a>
     <span class="lineno">
      228
     </span>
    </div>
    <div class="line">
     <a name="l00230">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
       230
      </a>
     </span>
     cudaStream_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ; }
    </div>
    <div class="line">
     <a name="l00231">
     </a>
     <span class="lineno">
      231
     </span>
    </div>
    <div class="line">
     <a name="l00233">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
       233
      </a>
     </span>
     <span class="keyword">
      const
     </span>
     std::pair&lt;int, int&gt;&amp;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     ; }
    </div>
    <div class="line">
     <a name="l00234">
     </a>
     <span class="lineno">
      234
     </span>
    </div>
    <div class="line">
     <a name="l00236">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
       236
      </a>
     </span>
     T**
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
      data
     </a>
     () {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
      m_batches
     </a>
     .data(); }
    </div>
    <div class="line">
     <a name="l00237">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a52caf848e1ea942d0907e7e3b37e8747">
       237
      </a>
     </span>
     <span class="keyword">
      const
     </span>
     T**
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a52caf848e1ea942d0907e7e3b37e8747">
      data
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
      m_batches
     </a>
     .data(); }
    </div>
    <div class="line">
     <a name="l00238">
     </a>
     <span class="lineno">
      238
     </span>
    </div>
    <div class="line">
     <a name="l00240">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
       240
      </a>
     </span>
     T*
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     () {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(); }
    </div>
    <div class="line">
     <a name="l00241">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a408553a4512ccfb143f36888409daeb2">
       241
      </a>
     </span>
     <span class="keyword">
      const
     </span>
     T*
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a408553a4512ccfb143f36888409daeb2">
      raw_data
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(); }
    </div>
    <div class="line">
     <a name="l00242">
     </a>
     <span class="lineno">
      242
     </span>
    </div>
    <div class="line">
     <a name="l00249">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acfac0b521f255bd17e735ec004a0b8fd">
       249
      </a>
     </span>
     T*
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acfac0b521f255bd17e735ec004a0b8fd">
      operator[]
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     <span class="keywordtype">
      id
     </span>
     )
     <span class="keyword">
      const
     </span>
     {
    </div>
    <div class="line">
     <a name="l00250">
     </a>
     <span class="lineno">
      250
     </span>
     <span class="keywordflow">
      return
     </span>
     &amp;(
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data()[
     <span class="keywordtype">
      id
     </span>
     *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second]);
    </div>
    <div class="line">
     <a name="l00251">
     </a>
     <span class="lineno">
      251
     </span>
     }
    </div>
    <div class="line">
     <a name="l00252">
     </a>
     <span class="lineno">
      252
     </span>
    </div>
    <div class="line">
     <a name="l00260">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a09958e0aa47e3c004bea0cebda6a7544">
       260
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a09958e0aa47e3c004bea0cebda6a7544">
      reshape
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00261">
     </a>
     <span class="lineno">
      261
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second;
    </div>
    <div class="line">
     <a name="l00262">
     </a>
     <span class="lineno">
      262
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     ==
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00263">
     </a>
     <span class="lineno">
      263
     </span>
     <span class="stringliteral">
      "ERROR: Size mismatch - Cannot reshape matrix into desired shape"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00264">
     </a>
     <span class="lineno">
      264
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     = std::pair&lt;int, int&gt;(
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     );
    </div>
    <div class="line">
     <a name="l00265">
     </a>
     <span class="lineno">
      265
     </span>
     }
    </div>
    <div class="line">
     <a name="l00266">
     </a>
     <span class="lineno">
      266
     </span>
    </div>
    <div class="line">
     <a name="l00268">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a474c2ae418b15d139a5941986c0a74ac">
       268
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a474c2ae418b15d139a5941986c0a74ac">
      vec
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
    </div>
    <div class="line">
     <a name="l00269">
     </a>
     <span class="lineno">
      269
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first;
    </div>
    <div class="line">
     <a name="l00270">
     </a>
     <span class="lineno">
      270
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second;
    </div>
    <div class="line">
     <a name="l00271">
     </a>
     <span class="lineno">
      271
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     =
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00272">
     </a>
     <span class="lineno">
      272
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     toVec(
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     , 1,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00273">
     </a>
     <span class="lineno">
      273
     </span>
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00274">
     </a>
     <span class="lineno">
      274
     </span>
     <a class="code" href="namespaceMLCommon.html#afd611e92a01811c35ec733fd18112064">
      copy
     </a>
     (toVec[0],
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(),
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00275">
     </a>
     <span class="lineno">
      275
     </span>
     <span class="keywordflow">
      return
     </span>
     toVec;
    </div>
    <div class="line">
     <a name="l00276">
     </a>
     <span class="lineno">
      276
     </span>
     }
    </div>
    <div class="line">
     <a name="l00277">
     </a>
     <span class="lineno">
      277
     </span>
    </div>
    <div class="line">
     <a name="l00285">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#aa4808ddcca00a5b526ba40675ba48205">
       285
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#aa4808ddcca00a5b526ba40675ba48205">
      mat
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     )
     <span class="keyword">
      const
     </span>
     {
    </div>
    <div class="line">
     <a name="l00286">
     </a>
     <span class="lineno">
      286
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second;
    </div>
    <div class="line">
     <a name="l00287">
     </a>
     <span class="lineno">
      287
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     ==
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00288">
     </a>
     <span class="lineno">
      288
     </span>
     <span class="stringliteral">
      "ERROR: Size mismatch - Cannot reshape array into desired size"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00289">
     </a>
     <span class="lineno">
      289
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     toMat(
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00290">
     </a>
     <span class="lineno">
      290
     </span>
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00291">
     </a>
     <span class="lineno">
      291
     </span>
     <a class="code" href="namespaceMLCommon.html#afd611e92a01811c35ec733fd18112064">
      copy
     </a>
     (toMat[0],
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(),
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
      r
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00292">
     </a>
     <span class="lineno">
      292
     </span>
    </div>
    <div class="line">
     <a name="l00293">
     </a>
     <span class="lineno">
      293
     </span>
     <span class="keywordflow">
      return
     </span>
     toMat;
    </div>
    <div class="line">
     <a name="l00294">
     </a>
     <span class="lineno">
      294
     </span>
     }
    </div>
    <div class="line">
     <a name="l00295">
     </a>
     <span class="lineno">
      295
     </span>
    </div>
    <div class="line">
     <a name="l00297">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a54e1a7ffa2aa36372e5f687e9dce706f">
       297
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a54e1a7ffa2aa36372e5f687e9dce706f">
      print
     </a>
     (std::string name)
     <span class="keyword">
      const
     </span>
     {
    </div>
    <div class="line">
     <a name="l00298">
     </a>
     <span class="lineno">
      298
     </span>
     <span class="keywordtype">
      size_t
     </span>
     len =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00299">
     </a>
     <span class="lineno">
      299
     </span>
     std::vector&lt;T&gt; A(len);
    </div>
    <div class="line">
     <a name="l00300">
     </a>
     <span class="lineno">
      300
     </span>
     <a class="code" href="group__Copy.html#ga9c1498ebc5825f9e63a9de94ced042d5">
      updateHost
     </a>
     (A.data(),
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data(), len,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00301">
     </a>
     <span class="lineno">
      301
     </span>
     std::cout &lt;&lt; name &lt;&lt;
     <span class="stringliteral">
      "=\n"
     </span>
     ;
    </div>
    <div class="line">
     <a name="l00302">
     </a>
     <span class="lineno">
      302
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l00303">
     </a>
     <span class="lineno">
      303
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l00304">
     </a>
     <span class="lineno">
      304
     </span>
     <span class="comment">
      // column major
     </span>
    </div>
    <div class="line">
     <a name="l00305">
     </a>
     <span class="lineno">
      305
     </span>
     std::cout &lt;&lt; std::setprecision(10) &lt;&lt; A[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] &lt;&lt;
     <span class="stringliteral">
      ","
     </span>
     ;
    </div>
    <div class="line">
     <a name="l00306">
     </a>
     <span class="lineno">
      306
     </span>
     }
    </div>
    <div class="line">
     <a name="l00307">
     </a>
     <span class="lineno">
      307
     </span>
     std::cout &lt;&lt;
     <span class="stringliteral">
      "\n"
     </span>
     ;
    </div>
    <div class="line">
     <a name="l00308">
     </a>
     <span class="lineno">
      308
     </span>
     }
    </div>
    <div class="line">
     <a name="l00309">
     </a>
     <span class="lineno">
      309
     </span>
     }
    </div>
    <div class="line">
     <a name="l00310">
     </a>
     <span class="lineno">
      310
     </span>
    </div>
    <div class="line">
     <a name="l00320">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a974feffd7829497b86979e50f8468ede">
       320
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a974feffd7829497b86979e50f8468ede">
      difference
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     period = 1)
     <span class="keyword">
      const
     </span>
     {
    </div>
    <div class="line">
     <a name="l00321">
     </a>
     <span class="lineno">
      321
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first == 1 ||
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second == 1,
    </div>
    <div class="line">
     <a name="l00322">
     </a>
     <span class="lineno">
      322
     </span>
     <span class="stringliteral">
      "Invalid operation: must be a vector"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00323">
     </a>
     <span class="lineno">
      323
     </span>
     <span class="keywordtype">
      int
     </span>
     len =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first;
    </div>
    <div class="line">
     <a name="l00324">
     </a>
     <span class="lineno">
      324
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (len &gt; period,
     <span class="stringliteral">
      "Length of the vector must be &gt; period"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00325">
     </a>
     <span class="lineno">
      325
     </span>
    </div>
    <div class="line">
     <a name="l00326">
     </a>
     <span class="lineno">
      326
     </span>
     <span class="comment">
      // Create output batched vector
     </span>
    </div>
    <div class="line">
     <a name="l00327">
     </a>
     <span class="lineno">
      327
     </span>
     <span class="keywordtype">
      bool
     </span>
     row_vector = (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first == 1);
    </div>
    <div class="line">
     <a name="l00328">
     </a>
     <span class="lineno">
      328
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     out(row_vector ? 1 : len - period, row_vector ? len - period : 1,
    </div>
    <div class="line">
     <a name="l00329">
     </a>
     <span class="lineno">
      329
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ,
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00330">
     </a>
     <span class="lineno">
      330
     </span>
    </div>
    <div class="line">
     <a name="l00331">
     </a>
     <span class="lineno">
      331
     </span>
     <span class="comment">
      // Execute kernel
     </span>
    </div>
    <div class="line">
     <a name="l00332">
     </a>
     <span class="lineno">
      332
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     TPB = (len - period) &gt; 512 ? 256 : 128;
     <span class="comment">
      // quick heuristics
     </span>
    </div>
    <div class="line">
     <a name="l00333">
     </a>
     <span class="lineno">
      333
     </span>
     batched_diff_kernel&lt;&lt;&lt;m_batch_size, TPB, 0, m_stream&gt;&gt;&gt;(
    </div>
    <div class="line">
     <a name="l00334">
     </a>
     <span class="lineno">
      334
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), out.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), len, period);
    </div>
    <div class="line">
     <a name="l00335">
     </a>
     <span class="lineno">
      335
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l00336">
     </a>
     <span class="lineno">
      336
     </span>
    </div>
    <div class="line">
     <a name="l00337">
     </a>
     <span class="lineno">
      337
     </span>
     <span class="keywordflow">
      return
     </span>
     out;
    </div>
    <div class="line">
     <a name="l00338">
     </a>
     <span class="lineno">
      338
     </span>
     }
    </div>
    <div class="line">
     <a name="l00339">
     </a>
     <span class="lineno">
      339
     </span>
    </div>
    <div class="line">
     <a name="l00345">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abf26a21f1f2741436187952902044ea7">
       345
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abf26a21f1f2741436187952902044ea7">
      inv
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
    </div>
    <div class="line">
     <a name="l00346">
     </a>
     <span class="lineno">
      346
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first;
    </div>
    <div class="line">
     <a name="l00347">
     </a>
     <span class="lineno">
      347
     </span>
    </div>
    <div class="line">
     <a name="l00348">
     </a>
     <span class="lineno">
      348
     </span>
     <span class="keywordtype">
      int
     </span>
     * P =
    </div>
    <div class="line">
     <a name="l00349">
     </a>
     <span class="lineno">
      349
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     *)
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     -&gt;allocate(
     <span class="keyword">
      sizeof
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     ) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00350">
     </a>
     <span class="lineno">
      350
     </span>
     <span class="keywordtype">
      int
     </span>
     * info =
    </div>
    <div class="line">
     <a name="l00351">
     </a>
     <span class="lineno">
      351
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     *)
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     -&gt;allocate(
     <span class="keyword">
      sizeof
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     ) *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00352">
     </a>
     <span class="lineno">
      352
     </span>
    </div>
    <div class="line">
     <a name="l00353">
     </a>
     <span class="lineno">
      353
     </span>
     <span class="comment">
      // A copy of A is necessary as the cublas operations write in A
     </span>
    </div>
    <div class="line">
     <a name="l00354">
     </a>
     <span class="lineno">
      354
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     Acopy(*
     <span class="keyword">
      this
     </span>
     );
    </div>
    <div class="line">
     <a name="l00355">
     </a>
     <span class="lineno">
      355
     </span>
    </div>
    <div class="line">
     <a name="l00356">
     </a>
     <span class="lineno">
      356
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     Ainv(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00357">
     </a>
     <span class="lineno">
      357
     </span>
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00358">
     </a>
     <span class="lineno">
      358
     </span>
    </div>
    <div class="line">
     <a name="l00359">
     </a>
     <span class="lineno">
      359
     </span>
     <a class="code" href="cublas__wrappers_8h.html#aa2a304d9732f1f382fac9abaf77526a7">
      CUBLAS_CHECK
     </a>
     (
     <a class="code" href="group__solverbatched.html#ga44ce99d17460e10db4e8d6e8ba8562c8">
      LinAlg::cublasgetrfBatched
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , Acopy.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
      data
     </a>
     (),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00360">
     </a>
     <span class="lineno">
      360
     </span>
     P, info,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ));
    </div>
    <div class="line">
     <a name="l00361">
     </a>
     <span class="lineno">
      361
     </span>
     <a class="code" href="cublas__wrappers_8h.html#aa2a304d9732f1f382fac9abaf77526a7">
      CUBLAS_CHECK
     </a>
     (
     <a class="code" href="group__solverbatched.html#gafd3e0592287bd860ba90f1a8d88ef1b3">
      LinAlg::cublasgetriBatched
     </a>
     (
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , Acopy.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
      data
     </a>
     (),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00362">
     </a>
     <span class="lineno">
      362
     </span>
     P, Ainv.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
      data
     </a>
     (),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , info,
    </div>
    <div class="line">
     <a name="l00363">
     </a>
     <span class="lineno">
      363
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ));
    </div>
    <div class="line">
     <a name="l00364">
     </a>
     <span class="lineno">
      364
     </span>
    </div>
    <div class="line">
     <a name="l00365">
     </a>
     <span class="lineno">
      365
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     -&gt;deallocate(P,
     <span class="keyword">
      sizeof
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     ) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00366">
     </a>
     <span class="lineno">
      366
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     -&gt;deallocate(info,
     <span class="keyword">
      sizeof
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     ) *
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00367">
     </a>
     <span class="lineno">
      367
     </span>
    </div>
    <div class="line">
     <a name="l00368">
     </a>
     <span class="lineno">
      368
     </span>
     <span class="keywordflow">
      return
     </span>
     Ainv;
    </div>
    <div class="line">
     <a name="l00369">
     </a>
     <span class="lineno">
      369
     </span>
     }
    </div>
    <div class="line">
     <a name="l00370">
     </a>
     <span class="lineno">
      370
     </span>
    </div>
    <div class="line">
     <a name="l00376">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a491988110d24c48b953d899dd0509c37">
       376
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a491988110d24c48b953d899dd0509c37">
      transpose
     </a>
     ()
     <span class="keyword">
      const
     </span>
     {
    </div>
    <div class="line">
     <a name="l00377">
     </a>
     <span class="lineno">
      377
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .first;
    </div>
    <div class="line">
     <a name="l00378">
     </a>
     <span class="lineno">
      378
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     .second;
    </div>
    <div class="line">
     <a name="l00379">
     </a>
     <span class="lineno">
      379
     </span>
    </div>
    <div class="line">
     <a name="l00380">
     </a>
     <span class="lineno">
      380
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     At(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     );
    </div>
    <div class="line">
     <a name="l00381">
     </a>
     <span class="lineno">
      381
     </span>
    </div>
    <div class="line">
     <a name="l00382">
     </a>
     <span class="lineno">
      382
     </span>
     <span class="keyword">
      const
     </span>
     T* d_A =
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data();
    </div>
    <div class="line">
     <a name="l00383">
     </a>
     <span class="lineno">
      383
     </span>
     T* d_At = At.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     .data();
    </div>
    <div class="line">
     <a name="l00384">
     </a>
     <span class="lineno">
      384
     </span>
    </div>
    <div class="line">
     <a name="l00385">
     </a>
     <span class="lineno">
      385
     </span>
     <span class="comment">
      // Naive batched transpose ; TODO: improve
     </span>
    </div>
    <div class="line">
     <a name="l00386">
     </a>
     <span class="lineno">
      386
     </span>
     <span class="keyword">
      auto
     </span>
     counting = thrust::make_counting_iterator&lt;int&gt;(0);
    </div>
    <div class="line">
     <a name="l00387">
     </a>
     <span class="lineno">
      387
     </span>
     thrust::for_each(thrust::cuda::par.on(
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ), counting,
    </div>
    <div class="line">
     <a name="l00388">
     </a>
     <span class="lineno">
      388
     </span>
     counting +
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     , [=] __device__(
     <span class="keywordtype">
      int
     </span>
     tid) {
    </div>
    <div class="line">
     <a name="l00389">
     </a>
     <span class="lineno">
      389
     </span>
     <span class="keywordtype">
      int
     </span>
     bid = tid /
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00390">
     </a>
     <span class="lineno">
      390
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = tid %
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00391">
     </a>
     <span class="lineno">
      391
     </span>
     <span class="keyword">
      const
     </span>
     T* b_A = d_A + bid *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00392">
     </a>
     <span class="lineno">
      392
     </span>
     T* b_At = d_At + bid *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00393">
     </a>
     <span class="lineno">
      393
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l00394">
     </a>
     <span class="lineno">
      394
     </span>
     b_At[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ] = b_A[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l00395">
     </a>
     <span class="lineno">
      395
     </span>
     }
    </div>
    <div class="line">
     <a name="l00396">
     </a>
     <span class="lineno">
      396
     </span>
     });
    </div>
    <div class="line">
     <a name="l00397">
     </a>
     <span class="lineno">
      397
     </span>
     <span class="keywordflow">
      return
     </span>
     At;
    </div>
    <div class="line">
     <a name="l00398">
     </a>
     <span class="lineno">
      398
     </span>
     }
    </div>
    <div class="line">
     <a name="l00399">
     </a>
     <span class="lineno">
      399
     </span>
    </div>
    <div class="line">
     <a name="l00411">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab3b4267c5f02efd0d6cdbc4c7c3ec2c1">
       411
      </a>
     </span>
     <span class="keyword">
      static
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab3b4267c5f02efd0d6cdbc4c7c3ec2c1">
      Identity
     </a>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     batch_size, cublasHandle_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00412">
     </a>
     <span class="lineno">
      412
     </span>
     std::shared_ptr&lt;ML::deviceAllocator&gt;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00413">
     </a>
     <span class="lineno">
      413
     </span>
     cudaStream_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00414">
     </a>
     <span class="lineno">
      414
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     I(
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     , batch_size,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ,
     <span class="keyword">
      true
     </span>
     );
    </div>
    <div class="line">
     <a name="l00415">
     </a>
     <span class="lineno">
      415
     </span>
    </div>
    <div class="line">
     <a name="l00416">
     </a>
     <span class="lineno">
      416
     </span>
     identity_matrix_kernel&lt;T&gt;
    </div>
    <div class="line">
     <a name="l00417">
     </a>
     <span class="lineno">
      417
     </span>
     &lt;&lt;&lt;batch_size, std::min(256,
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ), 0,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     &gt;&gt;&gt;(I.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     );
    </div>
    <div class="line">
     <a name="l00418">
     </a>
     <span class="lineno">
      418
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l00419">
     </a>
     <span class="lineno">
      419
     </span>
     <span class="keywordflow">
      return
     </span>
     I;
    </div>
    <div class="line">
     <a name="l00420">
     </a>
     <span class="lineno">
      420
     </span>
     }
    </div>
    <div class="line">
     <a name="l00421">
     </a>
     <span class="lineno">
      421
     </span>
    </div>
    <div class="line">
     <a name="l00422">
     </a>
     <span class="lineno">
      422
     </span>
     <span class="keyword">
      protected
     </span>
     :
    </div>
    <div class="line">
     <a name="l00424">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
       424
      </a>
     </span>
     std::pair&lt;int, int&gt;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
      m_shape
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00425">
     </a>
     <span class="lineno">
      425
     </span>
    </div>
    <div class="line">
     <a name="l00427">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
       427
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1buffer__base.html">
      device_buffer&lt;T*&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
      m_batches
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00428">
     </a>
     <span class="lineno">
      428
     </span>
    </div>
    <div class="line">
     <a name="l00430">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
       430
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1buffer__base.html">
      device_buffer&lt;T&gt;
     </a>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
      m_dense
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00431">
     </a>
     <span class="lineno">
      431
     </span>
    </div>
    <div class="line">
     <a name="l00433">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
       433
      </a>
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
      m_batch_size
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00434">
     </a>
     <span class="lineno">
      434
     </span>
    </div>
    <div class="line">
     <a name="l00435">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
       435
      </a>
     </span>
     std::shared_ptr&lt;deviceAllocator&gt;
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
      m_allocator
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00436">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
       436
      </a>
     </span>
     cublasHandle_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
      m_cublasHandle
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00437">
     </a>
     <span class="lineno">
      <a class="line" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
       437
      </a>
     </span>
     cudaStream_t
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
      m_stream
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00438">
     </a>
     <span class="lineno">
      438
     </span>
     };
    </div>
    <div class="line">
     <a name="l00439">
     </a>
     <span class="lineno">
      439
     </span>
    </div>
    <div class="line">
     <a name="l00456">
     </a>
     <span class="lineno">
      456
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00457">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a888a53f82abc92c59ebb6f0109c27ae2">
       457
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a888a53f82abc92c59ebb6f0109c27ae2">
      kronecker_product_kernel
     </a>
     (
     <span class="keyword">
      const
     </span>
     T* A,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <span class="keyword">
      const
     </span>
     T* B,
    </div>
    <div class="line">
     <a name="l00458">
     </a>
     <span class="lineno">
      458
     </span>
     <span class="keywordtype">
      int
     </span>
     p,
     <span class="keywordtype">
      int
     </span>
     q, T* AkB,
     <span class="keywordtype">
      int
     </span>
     k_m,
    </div>
    <div class="line">
     <a name="l00459">
     </a>
     <span class="lineno">
      459
     </span>
     <span class="keywordtype">
      int
     </span>
     k_n) {
    </div>
    <div class="line">
     <a name="l00460">
     </a>
     <span class="lineno">
      460
     </span>
     <span class="keyword">
      const
     </span>
     T* A_b = A + blockIdx.x *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00461">
     </a>
     <span class="lineno">
      461
     </span>
     <span class="keyword">
      const
     </span>
     T* B_b = B + blockIdx.x * p * q;
    </div>
    <div class="line">
     <a name="l00462">
     </a>
     <span class="lineno">
      462
     </span>
     T* AkB_b = AkB + blockIdx.x * k_m * k_n;
    </div>
    <div class="line">
     <a name="l00463">
     </a>
     <span class="lineno">
      463
     </span>
    </div>
    <div class="line">
     <a name="l00464">
     </a>
     <span class="lineno">
      464
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     ia = 0; ia &lt;
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ; ia++) {
    </div>
    <div class="line">
     <a name="l00465">
     </a>
     <span class="lineno">
      465
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     ja = 0; ja &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ; ja++) {
    </div>
    <div class="line">
     <a name="l00466">
     </a>
     <span class="lineno">
      466
     </span>
     T A_ia_ja = A_b[ia + ja *
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ];
    </div>
    <div class="line">
     <a name="l00467">
     </a>
     <span class="lineno">
      467
     </span>
    </div>
    <div class="line">
     <a name="l00468">
     </a>
     <span class="lineno">
      468
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     ib = threadIdx.x; ib &lt; p; ib += blockDim.x) {
    </div>
    <div class="line">
     <a name="l00469">
     </a>
     <span class="lineno">
      469
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     jb = threadIdx.y; jb &lt; q; jb += blockDim.y) {
    </div>
    <div class="line">
     <a name="l00470">
     </a>
     <span class="lineno">
      470
     </span>
     <span class="keywordtype">
      int
     </span>
     i_ab = ia * p + ib;
    </div>
    <div class="line">
     <a name="l00471">
     </a>
     <span class="lineno">
      471
     </span>
     <span class="keywordtype">
      int
     </span>
     j_ab = ja * q + jb;
    </div>
    <div class="line">
     <a name="l00472">
     </a>
     <span class="lineno">
      472
     </span>
     AkB_b[i_ab + j_ab * k_m] = A_ia_ja * B_b[ib + jb * p];
    </div>
    <div class="line">
     <a name="l00473">
     </a>
     <span class="lineno">
      473
     </span>
     }
    </div>
    <div class="line">
     <a name="l00474">
     </a>
     <span class="lineno">
      474
     </span>
     }
    </div>
    <div class="line">
     <a name="l00475">
     </a>
     <span class="lineno">
      475
     </span>
     }
    </div>
    <div class="line">
     <a name="l00476">
     </a>
     <span class="lineno">
      476
     </span>
     }
    </div>
    <div class="line">
     <a name="l00477">
     </a>
     <span class="lineno">
      477
     </span>
     }
    </div>
    <div class="line">
     <a name="l00478">
     </a>
     <span class="lineno">
      478
     </span>
    </div>
    <div class="line">
     <a name="l00494">
     </a>
     <span class="lineno">
      494
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00495">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
       495
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (
     <span class="keywordtype">
      bool
     </span>
     aT,
     <span class="keywordtype">
      bool
     </span>
     bT,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     , T alpha,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
    </div>
    <div class="line">
     <a name="l00496">
     </a>
     <span class="lineno">
      496
     </span>
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; B, T beta,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; C) {
    </div>
    <div class="line">
     <a name="l00497">
     </a>
     <span class="lineno">
      497
     </span>
     <span class="comment">
      // Check the parameters
     </span>
    </div>
    <div class="line">
     <a name="l00498">
     </a>
     <span class="lineno">
      498
     </span>
     {
    </div>
    <div class="line">
     <a name="l00499">
     </a>
     <span class="lineno">
      499
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     () == B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (),
    </div>
    <div class="line">
     <a name="l00500">
     </a>
     <span class="lineno">
      500
     </span>
     <span class="stringliteral">
      "A and B must have the same number of batches"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00501">
     </a>
     <span class="lineno">
      501
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     () == C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (),
    </div>
    <div class="line">
     <a name="l00502">
     </a>
     <span class="lineno">
      502
     </span>
     <span class="stringliteral">
      "A and C must have the same number of batches"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00503">
     </a>
     <span class="lineno">
      503
     </span>
     <span class="keywordtype">
      int
     </span>
     Arows = !aT ? A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first : A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00504">
     </a>
     <span class="lineno">
      504
     </span>
     <span class="keywordtype">
      int
     </span>
     Acols = !aT ? A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second : A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00505">
     </a>
     <span class="lineno">
      505
     </span>
     <span class="keywordtype">
      int
     </span>
     Brows = !bT ? B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first : B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00506">
     </a>
     <span class="lineno">
      506
     </span>
     <span class="keywordtype">
      int
     </span>
     Bcols = !bT ? B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second : B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00507">
     </a>
     <span class="lineno">
      507
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     &lt;= Arows,
     <span class="stringliteral">
      "m should be &lt;= number of rows of A"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00508">
     </a>
     <span class="lineno">
      508
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &lt;= Acols,
     <span class="stringliteral">
      "k should be &lt;= number of columns of A"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00509">
     </a>
     <span class="lineno">
      509
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &lt;= Brows,
     <span class="stringliteral">
      "k should be &lt;= number of rows of B"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00510">
     </a>
     <span class="lineno">
      510
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     &lt;= Bcols,
     <span class="stringliteral">
      "n should be &lt;= number of columns of B"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00511">
     </a>
     <span class="lineno">
      511
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     &lt;= C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first,
     <span class="stringliteral">
      "m should be &lt;= number of rows of C"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00512">
     </a>
     <span class="lineno">
      512
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     &lt;= C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second,
     <span class="stringliteral">
      "n should be &lt;= number of columns of C"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00513">
     </a>
     <span class="lineno">
      513
     </span>
     }
    </div>
    <div class="line">
     <a name="l00514">
     </a>
     <span class="lineno">
      514
     </span>
    </div>
    <div class="line">
     <a name="l00515">
     </a>
     <span class="lineno">
      515
     </span>
     <span class="comment">
      // Set transpose modes
     </span>
    </div>
    <div class="line">
     <a name="l00516">
     </a>
     <span class="lineno">
      516
     </span>
     cublasOperation_t opA = aT ? CUBLAS_OP_T : CUBLAS_OP_N;
    </div>
    <div class="line">
     <a name="l00517">
     </a>
     <span class="lineno">
      517
     </span>
     cublasOperation_t opB = bT ? CUBLAS_OP_T : CUBLAS_OP_N;
    </div>
    <div class="line">
     <a name="l00518">
     </a>
     <span class="lineno">
      518
     </span>
    </div>
    <div class="line">
     <a name="l00519">
     </a>
     <span class="lineno">
      519
     </span>
     <span class="comment">
      // Call cuBLAS
     </span>
    </div>
    <div class="line">
     <a name="l00520">
     </a>
     <span class="lineno">
      520
     </span>
     <a class="code" href="cublas__wrappers_8h.html#aa2a304d9732f1f382fac9abaf77526a7">
      CUBLAS_CHECK
     </a>
     (
     <a class="code" href="group__gemmbatched.html#ga684f3c7d4ac973358203734b1cbf4dfa">
      LinAlg::cublasgemmStridedBatched
     </a>
     (
    </div>
    <div class="line">
     <a name="l00521">
     </a>
     <span class="lineno">
      521
     </span>
     A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), opA, opB,
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     , &amp;alpha, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first,
    </div>
    <div class="line">
     <a name="l00522">
     </a>
     <span class="lineno">
      522
     </span>
     A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first * A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second, B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first,
    </div>
    <div class="line">
     <a name="l00523">
     </a>
     <span class="lineno">
      523
     </span>
     B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first * B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second, &amp;beta, C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first,
    </div>
    <div class="line">
     <a name="l00524">
     </a>
     <span class="lineno">
      524
     </span>
     C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first * C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ()));
    </div>
    <div class="line">
     <a name="l00525">
     </a>
     <span class="lineno">
      525
     </span>
     }
    </div>
    <div class="line">
     <a name="l00526">
     </a>
     <span class="lineno">
      526
     </span>
    </div>
    <div class="line">
     <a name="l00538">
     </a>
     <span class="lineno">
      538
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00539">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ad109ecb1a3119da0fcf6cebc1df55fe2">
       539
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; B,
     <span class="keywordtype">
      bool
     </span>
     aT =
     <span class="keyword">
      false
     </span>
     ,
    </div>
    <div class="line">
     <a name="l00540">
     </a>
     <span class="lineno">
      540
     </span>
     <span class="keywordtype">
      bool
     </span>
     bT =
     <span class="keyword">
      false
     </span>
     ) {
    </div>
    <div class="line">
     <a name="l00541">
     </a>
     <span class="lineno">
      541
     </span>
     <span class="comment">
      // m = number of rows of matrix op(A) and C.
     </span>
    </div>
    <div class="line">
     <a name="l00542">
     </a>
     <span class="lineno">
      542
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     = !aT ? A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first : A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00543">
     </a>
     <span class="lineno">
      543
     </span>
     <span class="comment">
      // n = number of columns of matrix op(B) and C.
     </span>
    </div>
    <div class="line">
     <a name="l00544">
     </a>
     <span class="lineno">
      544
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = !bT ? B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second : B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00545">
     </a>
     <span class="lineno">
      545
     </span>
    </div>
    <div class="line">
     <a name="l00546">
     </a>
     <span class="lineno">
      546
     </span>
     <span class="comment">
      // k = number of columns of op(A) and rows of op(B).
     </span>
    </div>
    <div class="line">
     <a name="l00547">
     </a>
     <span class="lineno">
      547
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     = !aT ? A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second : A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00548">
     </a>
     <span class="lineno">
      548
     </span>
     <span class="keywordtype">
      int
     </span>
     kB = !bT ? B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first : B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00549">
     </a>
     <span class="lineno">
      549
     </span>
    </div>
    <div class="line">
     <a name="l00550">
     </a>
     <span class="lineno">
      550
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     == kB,
     <span class="stringliteral">
      "Matrix-Multiplication dimensions don't match!"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00551">
     </a>
     <span class="lineno">
      551
     </span>
    </div>
    <div class="line">
     <a name="l00552">
     </a>
     <span class="lineno">
      552
     </span>
     <span class="comment">
      // Create C(m,n)
     </span>
    </div>
    <div class="line">
     <a name="l00553">
     </a>
     <span class="lineno">
      553
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     C(
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ());
    </div>
    <div class="line">
     <a name="l00554">
     </a>
     <span class="lineno">
      554
     </span>
    </div>
    <div class="line">
     <a name="l00555">
     </a>
     <span class="lineno">
      555
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (aT, bT,
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     , (T)1, A, B, (T)0, C);
    </div>
    <div class="line">
     <a name="l00556">
     </a>
     <span class="lineno">
      556
     </span>
     <span class="keywordflow">
      return
     </span>
     C;
    </div>
    <div class="line">
     <a name="l00557">
     </a>
     <span class="lineno">
      557
     </span>
     }
    </div>
    <div class="line">
     <a name="l00558">
     </a>
     <span class="lineno">
      558
     </span>
    </div>
    <div class="line">
     <a name="l00570">
     </a>
     <span class="lineno">
      570
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00571">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a9d97b9c77ae8d505c70560331e859870">
       571
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a9d97b9c77ae8d505c70560331e859870">
      b_gels
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; C) {
    </div>
    <div class="line">
     <a name="l00572">
     </a>
     <span class="lineno">
      572
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     () == C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (),
    </div>
    <div class="line">
     <a name="l00573">
     </a>
     <span class="lineno">
      573
     </span>
     <span class="stringliteral">
      "A and C must have the same number of batches"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00574">
     </a>
     <span class="lineno">
      574
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00575">
     </a>
     <span class="lineno">
      575
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first ==
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <span class="stringliteral">
      "Dimension mismatch: A rows, C rows"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00576">
     </a>
     <span class="lineno">
      576
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00577">
     </a>
     <span class="lineno">
      577
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     &gt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <span class="stringliteral">
      "Only overdetermined systems (m &gt; n) are supported"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00578">
     </a>
     <span class="lineno">
      578
     </span>
     <span class="keywordtype">
      int
     </span>
     nrhs = C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00579">
     </a>
     <span class="lineno">
      579
     </span>
    </div>
    <div class="line">
     <a name="l00580">
     </a>
     <span class="lineno">
      580
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     Acopy(A);
    </div>
    <div class="line">
     <a name="l00581">
     </a>
     <span class="lineno">
      581
     </span>
    </div>
    <div class="line">
     <a name="l00582">
     </a>
     <span class="lineno">
      582
     </span>
     <span class="keywordtype">
      int
     </span>
     info;
    </div>
    <div class="line">
     <a name="l00583">
     </a>
     <span class="lineno">
      583
     </span>
     <a class="code" href="cublas__wrappers_8h.html#aa2a304d9732f1f382fac9abaf77526a7">
      CUBLAS_CHECK
     </a>
     (
     <a class="code" href="group__gelsbatched.html#ga44aa2633112d8fb44994b4a863cad582">
      LinAlg::cublasgelsBatched
     </a>
     (
    </div>
    <div class="line">
     <a name="l00584">
     </a>
     <span class="lineno">
      584
     </span>
     A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), CUBLAS_OP_N,
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , nrhs, Acopy.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
      data
     </a>
     (),
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     , C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
      data
     </a>
     (),
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
    </div>
    <div class="line">
     <a name="l00585">
     </a>
     <span class="lineno">
      585
     </span>
     &amp;info,
     <span class="keyword">
      nullptr
     </span>
     , A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ()));
    </div>
    <div class="line">
     <a name="l00586">
     </a>
     <span class="lineno">
      586
     </span>
     }
    </div>
    <div class="line">
     <a name="l00587">
     </a>
     <span class="lineno">
      587
     </span>
    </div>
    <div class="line">
     <a name="l00595">
     </a>
     <span class="lineno">
      595
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T,
     <span class="keyword">
      typename
     </span>
     F&gt;
    </div>
    <div class="line">
     <a name="l00596">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4415384bb08980d7b4e495795c3bc159">
       596
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4415384bb08980d7b4e495795c3bc159">
      b_op_A
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A, F unary_op) {
    </div>
    <div class="line">
     <a name="l00597">
     </a>
     <span class="lineno">
      597
     </span>
     <span class="keyword">
      auto
     </span>
     batch_size = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     ();
    </div>
    <div class="line">
     <a name="l00598">
     </a>
     <span class="lineno">
      598
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00599">
     </a>
     <span class="lineno">
      599
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00600">
     </a>
     <span class="lineno">
      600
     </span>
    </div>
    <div class="line">
     <a name="l00601">
     </a>
     <span class="lineno">
      601
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     C(
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ());
    </div>
    <div class="line">
     <a name="l00602">
     </a>
     <span class="lineno">
      602
     </span>
    </div>
    <div class="line">
     <a name="l00603">
     </a>
     <span class="lineno">
      603
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg.html#a582f862f0f386a0f5bee65bcac37382a">
      LinAlg::unaryOp
     </a>
     (C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * batch_size, unary_op,
    </div>
    <div class="line">
     <a name="l00604">
     </a>
     <span class="lineno">
      604
     </span>
     A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ());
    </div>
    <div class="line">
     <a name="l00605">
     </a>
     <span class="lineno">
      605
     </span>
    </div>
    <div class="line">
     <a name="l00606">
     </a>
     <span class="lineno">
      606
     </span>
     <span class="keywordflow">
      return
     </span>
     C;
    </div>
    <div class="line">
     <a name="l00607">
     </a>
     <span class="lineno">
      607
     </span>
     }
    </div>
    <div class="line">
     <a name="l00608">
     </a>
     <span class="lineno">
      608
     </span>
    </div>
    <div class="line">
     <a name="l00618">
     </a>
     <span class="lineno">
      618
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T,
     <span class="keyword">
      typename
     </span>
     F&gt;
    </div>
    <div class="line">
     <a name="l00619">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ab44edd8ee38ab93ab2959192d1f2df34">
       619
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ab44edd8ee38ab93ab2959192d1f2df34">
      b_aA_op_B
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; B, F binary_op) {
    </div>
    <div class="line">
     <a name="l00620">
     </a>
     <span class="lineno">
      620
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (
    </div>
    <div class="line">
     <a name="l00621">
     </a>
     <span class="lineno">
      621
     </span>
     A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first == B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first &amp;&amp; A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second == B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second,
    </div>
    <div class="line">
     <a name="l00622">
     </a>
     <span class="lineno">
      622
     </span>
     <span class="stringliteral">
      "ERROR: Matrices must be same size"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00623">
     </a>
     <span class="lineno">
      623
     </span>
    </div>
    <div class="line">
     <a name="l00624">
     </a>
     <span class="lineno">
      624
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     () == B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (),
     <span class="stringliteral">
      "A &amp; B must have same number of batches"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00625">
     </a>
     <span class="lineno">
      625
     </span>
    </div>
    <div class="line">
     <a name="l00626">
     </a>
     <span class="lineno">
      626
     </span>
     <span class="keyword">
      auto
     </span>
     batch_size = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     ();
    </div>
    <div class="line">
     <a name="l00627">
     </a>
     <span class="lineno">
      627
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00628">
     </a>
     <span class="lineno">
      628
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00629">
     </a>
     <span class="lineno">
      629
     </span>
    </div>
    <div class="line">
     <a name="l00630">
     </a>
     <span class="lineno">
      630
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     C(
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ());
    </div>
    <div class="line">
     <a name="l00631">
     </a>
     <span class="lineno">
      631
     </span>
    </div>
    <div class="line">
     <a name="l00632">
     </a>
     <span class="lineno">
      632
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg.html#a5fc5df15f7e1441d7fa32031fd0a95d4">
      LinAlg::binaryOp
     </a>
     (C.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * batch_size,
    </div>
    <div class="line">
     <a name="l00633">
     </a>
     <span class="lineno">
      633
     </span>
     binary_op, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ());
    </div>
    <div class="line">
     <a name="l00634">
     </a>
     <span class="lineno">
      634
     </span>
    </div>
    <div class="line">
     <a name="l00635">
     </a>
     <span class="lineno">
      635
     </span>
     <span class="keywordflow">
      return
     </span>
     C;
    </div>
    <div class="line">
     <a name="l00636">
     </a>
     <span class="lineno">
      636
     </span>
     }
    </div>
    <div class="line">
     <a name="l00637">
     </a>
     <span class="lineno">
      637
     </span>
    </div>
    <div class="line">
     <a name="l00646">
     </a>
     <span class="lineno">
      646
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00647">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a0752666954befc04fbe6a9d3fedaf14d">
       647
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a0752666954befc04fbe6a9d3fedaf14d">
      operator*
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; B) {
    </div>
    <div class="line">
     <a name="l00648">
     </a>
     <span class="lineno">
      648
     </span>
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (A, B);
    </div>
    <div class="line">
     <a name="l00649">
     </a>
     <span class="lineno">
      649
     </span>
     }
    </div>
    <div class="line">
     <a name="l00650">
     </a>
     <span class="lineno">
      650
     </span>
    </div>
    <div class="line">
     <a name="l00658">
     </a>
     <span class="lineno">
      658
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00659">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a788136379b795ac7ee712e35b34a2107">
       659
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a788136379b795ac7ee712e35b34a2107">
      operator+
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; B) {
    </div>
    <div class="line">
     <a name="l00660">
     </a>
     <span class="lineno">
      660
     </span>
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ab44edd8ee38ab93ab2959192d1f2df34">
      b_aA_op_B
     </a>
     (A, B, [] __device__(T a, T b) {
     <span class="keywordflow">
      return
     </span>
     a + b; });
    </div>
    <div class="line">
     <a name="l00661">
     </a>
     <span class="lineno">
      661
     </span>
     }
    </div>
    <div class="line">
     <a name="l00662">
     </a>
     <span class="lineno">
      662
     </span>
    </div>
    <div class="line">
     <a name="l00670">
     </a>
     <span class="lineno">
      670
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00671">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#abeaf703e7f97387df59b277c5483c0c0">
       671
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#abeaf703e7f97387df59b277c5483c0c0">
      operator-
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; B) {
    </div>
    <div class="line">
     <a name="l00672">
     </a>
     <span class="lineno">
      672
     </span>
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ab44edd8ee38ab93ab2959192d1f2df34">
      b_aA_op_B
     </a>
     (A, B, [] __device__(T a, T b) {
     <span class="keywordflow">
      return
     </span>
     a - b; });
    </div>
    <div class="line">
     <a name="l00673">
     </a>
     <span class="lineno">
      673
     </span>
     }
    </div>
    <div class="line">
     <a name="l00674">
     </a>
     <span class="lineno">
      674
     </span>
    </div>
    <div class="line">
     <a name="l00681">
     </a>
     <span class="lineno">
      681
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00682">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ae484d911cd4f62d08f47c93db09d02f7">
       682
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#abeaf703e7f97387df59b277c5483c0c0">
      operator-
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A) {
    </div>
    <div class="line">
     <a name="l00683">
     </a>
     <span class="lineno">
      683
     </span>
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4415384bb08980d7b4e495795c3bc159">
      b_op_A
     </a>
     (A, [] __device__(T a) {
     <span class="keywordflow">
      return
     </span>
     -a; });
    </div>
    <div class="line">
     <a name="l00684">
     </a>
     <span class="lineno">
      684
     </span>
     }
    </div>
    <div class="line">
     <a name="l00685">
     </a>
     <span class="lineno">
      685
     </span>
    </div>
    <div class="line">
     <a name="l00693">
     </a>
     <span class="lineno">
      693
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00694">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aac0d49c5aa65007e6a1bf25016a652f7">
       694
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aac0d49c5aa65007e6a1bf25016a652f7">
      b_solve
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; b) {
    </div>
    <div class="line">
     <a name="l00695">
     </a>
     <span class="lineno">
      695
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceML_1_1TSNE.html#a5c7478abb28859ec13dec63fa777a04e">
      x
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abf26a21f1f2741436187952902044ea7">
      inv
     </a>
     () * b;
    </div>
    <div class="line">
     <a name="l00696">
     </a>
     <span class="lineno">
      696
     </span>
     <span class="keywordflow">
      return
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a5c7478abb28859ec13dec63fa777a04e">
      x
     </a>
     ;
    </div>
    <div class="line">
     <a name="l00697">
     </a>
     <span class="lineno">
      697
     </span>
     }
    </div>
    <div class="line">
     <a name="l00698">
     </a>
     <span class="lineno">
      698
     </span>
    </div>
    <div class="line">
     <a name="l00707">
     </a>
     <span class="lineno">
      707
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00708">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aee40b648abdfa60ed92266a566072089">
       708
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aee40b648abdfa60ed92266a566072089">
      b_kron
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; B) {
    </div>
    <div class="line">
     <a name="l00709">
     </a>
     <span class="lineno">
      709
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00710">
     </a>
     <span class="lineno">
      710
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00711">
     </a>
     <span class="lineno">
      711
     </span>
    </div>
    <div class="line">
     <a name="l00712">
     </a>
     <span class="lineno">
      712
     </span>
     <span class="keywordtype">
      int
     </span>
     p = B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00713">
     </a>
     <span class="lineno">
      713
     </span>
     <span class="keywordtype">
      int
     </span>
     q = B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00714">
     </a>
     <span class="lineno">
      714
     </span>
    </div>
    <div class="line">
     <a name="l00715">
     </a>
     <span class="lineno">
      715
     </span>
     <span class="comment">
      // Resulting shape
     </span>
    </div>
    <div class="line">
     <a name="l00716">
     </a>
     <span class="lineno">
      716
     </span>
     <span class="keywordtype">
      int
     </span>
     k_m =
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     * p;
    </div>
    <div class="line">
     <a name="l00717">
     </a>
     <span class="lineno">
      717
     </span>
     <span class="keywordtype">
      int
     </span>
     k_n =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * q;
    </div>
    <div class="line">
     <a name="l00718">
     </a>
     <span class="lineno">
      718
     </span>
    </div>
    <div class="line">
     <a name="l00719">
     </a>
     <span class="lineno">
      719
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     AkB(k_m, k_n, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     (),
    </div>
    <div class="line">
     <a name="l00720">
     </a>
     <span class="lineno">
      720
     </span>
     A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ());
    </div>
    <div class="line">
     <a name="l00721">
     </a>
     <span class="lineno">
      721
     </span>
    </div>
    <div class="line">
     <a name="l00722">
     </a>
     <span class="lineno">
      722
     </span>
     <span class="comment">
      // Run kronecker
     </span>
    </div>
    <div class="line">
     <a name="l00723">
     </a>
     <span class="lineno">
      723
     </span>
     dim3 threads(std::min(p, 32), std::min(q, 32));
    </div>
    <div class="line">
     <a name="l00724">
     </a>
     <span class="lineno">
      724
     </span>
     kronecker_product_kernel&lt;T&gt;&lt;&lt;&lt;A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), threads, 0, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ()&gt;&gt;&gt;(
    </div>
    <div class="line">
     <a name="l00725">
     </a>
     <span class="lineno">
      725
     </span>
     A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , B.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), p, q, AkB.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), k_m, k_n);
    </div>
    <div class="line">
     <a name="l00726">
     </a>
     <span class="lineno">
      726
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l00727">
     </a>
     <span class="lineno">
      727
     </span>
     <span class="keywordflow">
      return
     </span>
     AkB;
    </div>
    <div class="line">
     <a name="l00728">
     </a>
     <span class="lineno">
      728
     </span>
     }
    </div>
    <div class="line">
     <a name="l00729">
     </a>
     <span class="lineno">
      729
     </span>
    </div>
    <div class="line">
     <a name="l00745">
     </a>
     <span class="lineno">
      745
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00746">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aed4cf783f47734ac6722ac1f49cc6f94">
       746
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aed4cf783f47734ac6722ac1f49cc6f94">
      lagged_mat_kernel
     </a>
     (
     <span class="keyword">
      const
     </span>
     T* vec, T* mat,
     <span class="keywordtype">
      int
     </span>
     lags,
    </div>
    <div class="line">
     <a name="l00747">
     </a>
     <span class="lineno">
      747
     </span>
     <span class="keywordtype">
      int
     </span>
     lagged_height,
     <span class="keywordtype">
      int
     </span>
     vec_offset,
     <span class="keywordtype">
      int
     </span>
     ld,
    </div>
    <div class="line">
     <a name="l00748">
     </a>
     <span class="lineno">
      748
     </span>
     <span class="keywordtype">
      int
     </span>
     mat_offset,
     <span class="keywordtype">
      int
     </span>
     ls_batch_stride,
    </div>
    <div class="line">
     <a name="l00749">
     </a>
     <span class="lineno">
      749
     </span>
     <span class="keywordtype">
      int
     </span>
     s = 1) {
    </div>
    <div class="line">
     <a name="l00750">
     </a>
     <span class="lineno">
      750
     </span>
     <span class="keyword">
      const
     </span>
     T* batch_in = vec + blockIdx.x * ld + vec_offset;
    </div>
    <div class="line">
     <a name="l00751">
     </a>
     <span class="lineno">
      751
     </span>
     T* batch_out = mat + blockIdx.x * ls_batch_stride + mat_offset;
    </div>
    <div class="line">
     <a name="l00752">
     </a>
     <span class="lineno">
      752
     </span>
    </div>
    <div class="line">
     <a name="l00753">
     </a>
     <span class="lineno">
      753
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     lag = 0; lag &lt; lags; lag++) {
    </div>
    <div class="line">
     <a name="l00754">
     </a>
     <span class="lineno">
      754
     </span>
     <span class="keyword">
      const
     </span>
     T* b_in = batch_in + s * (lags - lag - 1);
    </div>
    <div class="line">
     <a name="l00755">
     </a>
     <span class="lineno">
      755
     </span>
     T* b_out = batch_out + lag * lagged_height;
    </div>
    <div class="line">
     <a name="l00756">
     </a>
     <span class="lineno">
      756
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt; lagged_height;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     += blockDim.x) {
    </div>
    <div class="line">
     <a name="l00757">
     </a>
     <span class="lineno">
      757
     </span>
     b_out[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = b_in[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l00758">
     </a>
     <span class="lineno">
      758
     </span>
     }
    </div>
    <div class="line">
     <a name="l00759">
     </a>
     <span class="lineno">
      759
     </span>
     }
    </div>
    <div class="line">
     <a name="l00760">
     </a>
     <span class="lineno">
      760
     </span>
     }
    </div>
    <div class="line">
     <a name="l00761">
     </a>
     <span class="lineno">
      761
     </span>
    </div>
    <div class="line">
     <a name="l00775">
     </a>
     <span class="lineno">
      775
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00776">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a47338481df6c27580786b2b9e5e98090">
       776
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a47338481df6c27580786b2b9e5e98090">
      b_lagged_mat
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; vec,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; lagged_mat,
     <span class="keywordtype">
      int
     </span>
     lags,
    </div>
    <div class="line">
     <a name="l00777">
     </a>
     <span class="lineno">
      777
     </span>
     <span class="keywordtype">
      int
     </span>
     lagged_height,
     <span class="keywordtype">
      int
     </span>
     vec_offset,
     <span class="keywordtype">
      int
     </span>
     mat_offset,
    </div>
    <div class="line">
     <a name="l00778">
     </a>
     <span class="lineno">
      778
     </span>
     <span class="keywordtype">
      int
     </span>
     s = 1) {
    </div>
    <div class="line">
     <a name="l00779">
     </a>
     <span class="lineno">
      779
     </span>
     <span class="comment">
      // Verify all the dimensions ; it's better to fail loudly than hide errors
     </span>
    </div>
    <div class="line">
     <a name="l00780">
     </a>
     <span class="lineno">
      780
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     () == lagged_mat.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (),
    </div>
    <div class="line">
     <a name="l00781">
     </a>
     <span class="lineno">
      781
     </span>
     <span class="stringliteral">
      "The numbers of batches of the matrix and the vector must match"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00782">
     </a>
     <span class="lineno">
      782
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first == 1 || vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second == 1,
    </div>
    <div class="line">
     <a name="l00783">
     </a>
     <span class="lineno">
      783
     </span>
     <span class="stringliteral">
      "The first argument must be a vector (either row or column)"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00784">
     </a>
     <span class="lineno">
      784
     </span>
     <span class="keywordtype">
      int
     </span>
     len = vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first == 1 ? vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second : vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l00785">
     </a>
     <span class="lineno">
      785
     </span>
     <span class="keywordtype">
      int
     </span>
     mat_batch_stride = lagged_mat.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first * lagged_mat.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00786">
     </a>
     <span class="lineno">
      786
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (lagged_height &lt;= len - s * lags - vec_offset,
    </div>
    <div class="line">
     <a name="l00787">
     </a>
     <span class="lineno">
      787
     </span>
     <span class="stringliteral">
      "Lagged height can't exceed vector length - s * lags - vector offset"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00788">
     </a>
     <span class="lineno">
      788
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (mat_offset &lt;= mat_batch_stride - lagged_height * lags,
    </div>
    <div class="line">
     <a name="l00789">
     </a>
     <span class="lineno">
      789
     </span>
     <span class="stringliteral">
      "Matrix offset can't exceed real matrix size - lagged matrix size"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00790">
     </a>
     <span class="lineno">
      790
     </span>
    </div>
    <div class="line">
     <a name="l00791">
     </a>
     <span class="lineno">
      791
     </span>
     <span class="comment">
      // Execute the kernel
     </span>
    </div>
    <div class="line">
     <a name="l00792">
     </a>
     <span class="lineno">
      792
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     TPB = lagged_height &gt; 512 ? 256 : 128;
     <span class="comment">
      // quick heuristics
     </span>
    </div>
    <div class="line">
     <a name="l00793">
     </a>
     <span class="lineno">
      793
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aed4cf783f47734ac6722ac1f49cc6f94">
      lagged_mat_kernel
     </a>
     &lt;&lt;&lt;vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), TPB, 0, vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ()&gt;&gt;&gt;(
    </div>
    <div class="line">
     <a name="l00794">
     </a>
     <span class="lineno">
      794
     </span>
     vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), lagged_mat.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), lags, lagged_height, vec_offset, len,
    </div>
    <div class="line">
     <a name="l00795">
     </a>
     <span class="lineno">
      795
     </span>
     mat_offset, mat_batch_stride, s);
    </div>
    <div class="line">
     <a name="l00796">
     </a>
     <span class="lineno">
      796
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l00797">
     </a>
     <span class="lineno">
      797
     </span>
     }
    </div>
    <div class="line">
     <a name="l00798">
     </a>
     <span class="lineno">
      798
     </span>
    </div>
    <div class="line">
     <a name="l00810">
     </a>
     <span class="lineno">
      810
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00811">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#af04010762737a061fd13e542e8cbc4fc">
       811
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a47338481df6c27580786b2b9e5e98090">
      b_lagged_mat
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; vec,
     <span class="keywordtype">
      int
     </span>
     lags) {
    </div>
    <div class="line">
     <a name="l00812">
     </a>
     <span class="lineno">
      812
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first == 1 || vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second == 1,
    </div>
    <div class="line">
     <a name="l00813">
     </a>
     <span class="lineno">
      813
     </span>
     <span class="stringliteral">
      "The first argument must be a vector (either row or column)"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00814">
     </a>
     <span class="lineno">
      814
     </span>
     <span class="keywordtype">
      int
     </span>
     len = vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first * vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second;
    </div>
    <div class="line">
     <a name="l00815">
     </a>
     <span class="lineno">
      815
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (lags &lt; len,
     <span class="stringliteral">
      "The number of lags can't exceed the vector length"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00816">
     </a>
     <span class="lineno">
      816
     </span>
     <span class="keywordtype">
      int
     </span>
     lagged_height = len - lags;
    </div>
    <div class="line">
     <a name="l00817">
     </a>
     <span class="lineno">
      817
     </span>
    </div>
    <div class="line">
     <a name="l00818">
     </a>
     <span class="lineno">
      818
     </span>
     <span class="comment">
      // Create output matrix
     </span>
    </div>
    <div class="line">
     <a name="l00819">
     </a>
     <span class="lineno">
      819
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     lagged_mat(lagged_height, lags, vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (),
    </div>
    <div class="line">
     <a name="l00820">
     </a>
     <span class="lineno">
      820
     </span>
     vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     (), vec.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     (),
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00821">
     </a>
     <span class="lineno">
      821
     </span>
     <span class="comment">
      // Call exhaustive version of the function
     </span>
    </div>
    <div class="line">
     <a name="l00822">
     </a>
     <span class="lineno">
      822
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a47338481df6c27580786b2b9e5e98090">
      b_lagged_mat
     </a>
     (vec, lagged_mat, lags, lagged_height, 0, 0);
    </div>
    <div class="line">
     <a name="l00823">
     </a>
     <span class="lineno">
      823
     </span>
    </div>
    <div class="line">
     <a name="l00824">
     </a>
     <span class="lineno">
      824
     </span>
     <span class="keywordflow">
      return
     </span>
     lagged_mat;
    </div>
    <div class="line">
     <a name="l00825">
     </a>
     <span class="lineno">
      825
     </span>
     }
    </div>
    <div class="line">
     <a name="l00826">
     </a>
     <span class="lineno">
      826
     </span>
    </div>
    <div class="line">
     <a name="l00842">
     </a>
     <span class="lineno">
      842
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00843">
     </a>
     <span class="lineno">
      843
     </span>
     <span class="keyword">
      static
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     batched_2dcopy_kernel(
     <span class="keyword">
      const
     </span>
     T* in, T* out,
    </div>
    <div class="line">
     <a name="l00844">
     </a>
     <span class="lineno">
      844
     </span>
     <span class="keywordtype">
      int
     </span>
     starting_row,
     <span class="keywordtype">
      int
     </span>
     starting_col,
    </div>
    <div class="line">
     <a name="l00845">
     </a>
     <span class="lineno">
      845
     </span>
     <span class="keywordtype">
      int
     </span>
     in_rows,
     <span class="keywordtype">
      int
     </span>
     in_cols,
    </div>
    <div class="line">
     <a name="l00846">
     </a>
     <span class="lineno">
      846
     </span>
     <span class="keywordtype">
      int
     </span>
     out_rows,
     <span class="keywordtype">
      int
     </span>
     out_cols) {
    </div>
    <div class="line">
     <a name="l00847">
     </a>
     <span class="lineno">
      847
     </span>
     <span class="keyword">
      const
     </span>
     T* in_ =
    </div>
    <div class="line">
     <a name="l00848">
     </a>
     <span class="lineno">
      848
     </span>
     in + blockIdx.x * in_rows * in_cols + starting_col * in_rows + starting_row;
    </div>
    <div class="line">
     <a name="l00849">
     </a>
     <span class="lineno">
      849
     </span>
     T* out_ = out + blockIdx.x * out_rows * out_cols;
    </div>
    <div class="line">
     <a name="l00850">
     </a>
     <span class="lineno">
      850
     </span>
    </div>
    <div class="line">
     <a name="l00851">
     </a>
     <span class="lineno">
      851
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt; out_rows * out_cols;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     += blockDim.x) {
    </div>
    <div class="line">
     <a name="l00852">
     </a>
     <span class="lineno">
      852
     </span>
     <span class="keywordtype">
      int
     </span>
     i_col =
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     / out_rows;
    </div>
    <div class="line">
     <a name="l00853">
     </a>
     <span class="lineno">
      853
     </span>
     <span class="keywordtype">
      int
     </span>
     i_row =
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     % out_rows;
    </div>
    <div class="line">
     <a name="l00854">
     </a>
     <span class="lineno">
      854
     </span>
     out_[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = in_[i_row + in_rows * i_col];
    </div>
    <div class="line">
     <a name="l00855">
     </a>
     <span class="lineno">
      855
     </span>
     }
    </div>
    <div class="line">
     <a name="l00856">
     </a>
     <span class="lineno">
      856
     </span>
     }
    </div>
    <div class="line">
     <a name="l00857">
     </a>
     <span class="lineno">
      857
     </span>
    </div>
    <div class="line">
     <a name="l00870">
     </a>
     <span class="lineno">
      870
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00871">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ac946d5044edfad2bc6255adf7acdab7b">
       871
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ac946d5044edfad2bc6255adf7acdab7b">
      b_2dcopy
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; in,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; out,
     <span class="keywordtype">
      int
     </span>
     starting_row,
    </div>
    <div class="line">
     <a name="l00872">
     </a>
     <span class="lineno">
      872
     </span>
     <span class="keywordtype">
      int
     </span>
     starting_col,
     <span class="keywordtype">
      int
     </span>
     rows,
     <span class="keywordtype">
      int
     </span>
     cols) {
    </div>
    <div class="line">
     <a name="l00873">
     </a>
     <span class="lineno">
      873
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (out.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first == rows,
     <span class="stringliteral">
      "Dimension mismatch: rows"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00874">
     </a>
     <span class="lineno">
      874
     </span>
     <a class="code" href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
      ASSERT
     </a>
     (out.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second == cols,
     <span class="stringliteral">
      "Dimension mismatch: columns"
     </span>
     );
    </div>
    <div class="line">
     <a name="l00875">
     </a>
     <span class="lineno">
      875
     </span>
    </div>
    <div class="line">
     <a name="l00876">
     </a>
     <span class="lineno">
      876
     </span>
     <span class="comment">
      // Execute the kernel
     </span>
    </div>
    <div class="line">
     <a name="l00877">
     </a>
     <span class="lineno">
      877
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     TPB = rows * cols &gt; 512 ? 256 : 128;
     <span class="comment">
      // quick heuristics
     </span>
    </div>
    <div class="line">
     <a name="l00878">
     </a>
     <span class="lineno">
      878
     </span>
     batched_2dcopy_kernel&lt;&lt;&lt;in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), TPB, 0, in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ()&gt;&gt;&gt;(
    </div>
    <div class="line">
     <a name="l00879">
     </a>
     <span class="lineno">
      879
     </span>
     in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), out.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), starting_row, starting_col, in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first,
    </div>
    <div class="line">
     <a name="l00880">
     </a>
     <span class="lineno">
      880
     </span>
     in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().second, rows, cols);
    </div>
    <div class="line">
     <a name="l00881">
     </a>
     <span class="lineno">
      881
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l00882">
     </a>
     <span class="lineno">
      882
     </span>
     }
    </div>
    <div class="line">
     <a name="l00883">
     </a>
     <span class="lineno">
      883
     </span>
    </div>
    <div class="line">
     <a name="l00900">
     </a>
     <span class="lineno">
      900
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00901">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a938a0c99f2096236f90c9e7a543952c3">
       901
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ac946d5044edfad2bc6255adf7acdab7b">
      b_2dcopy
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; in,
     <span class="keywordtype">
      int
     </span>
     starting_row,
     <span class="keywordtype">
      int
     </span>
     starting_col,
    </div>
    <div class="line">
     <a name="l00902">
     </a>
     <span class="lineno">
      902
     </span>
     <span class="keywordtype">
      int
     </span>
     rows,
     <span class="keywordtype">
      int
     </span>
     cols) {
    </div>
    <div class="line">
     <a name="l00903">
     </a>
     <span class="lineno">
      903
     </span>
     <span class="comment">
      // Create output matrix
     </span>
    </div>
    <div class="line">
     <a name="l00904">
     </a>
     <span class="lineno">
      904
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     out(rows, cols, in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     (), in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     (),
    </div>
    <div class="line">
     <a name="l00905">
     </a>
     <span class="lineno">
      905
     </span>
     in.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     (),
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l00906">
     </a>
     <span class="lineno">
      906
     </span>
    </div>
    <div class="line">
     <a name="l00907">
     </a>
     <span class="lineno">
      907
     </span>
     <span class="comment">
      // Call the other overload of the function
     </span>
    </div>
    <div class="line">
     <a name="l00908">
     </a>
     <span class="lineno">
      908
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ac946d5044edfad2bc6255adf7acdab7b">
      b_2dcopy
     </a>
     (in, out, starting_row, starting_col, rows, cols);
    </div>
    <div class="line">
     <a name="l00909">
     </a>
     <span class="lineno">
      909
     </span>
    </div>
    <div class="line">
     <a name="l00910">
     </a>
     <span class="lineno">
      910
     </span>
     <span class="keywordflow">
      return
     </span>
     out;
    </div>
    <div class="line">
     <a name="l00911">
     </a>
     <span class="lineno">
      911
     </span>
     }
    </div>
    <div class="line">
     <a name="l00912">
     </a>
     <span class="lineno">
      912
     </span>
    </div>
    <div class="line">
     <a name="l00921">
     </a>
     <span class="lineno">
      921
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00922">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#afb30eaabc37e040cd6d45d3bf39cddbf">
       922
      </a>
     </span>
     <a class="code" href="cuda__utils_8h.html#acabe1ee3d11be6214c678bf4dabda3c9">
      DI
     </a>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#afb30eaabc37e040cd6d45d3bf39cddbf">
      generate_householder_vector
     </a>
     (T* d_uk,
     <span class="keyword">
      const
     </span>
     T* d_xk,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00923">
     </a>
     <span class="lineno">
      923
     </span>
     <span class="comment">
      // Compute norm of the vectors x and u
     </span>
    </div>
    <div class="line">
     <a name="l00924">
     </a>
     <span class="lineno">
      924
     </span>
     T x_norm = (T)0, u_norm = (T)0;
    </div>
    <div class="line">
     <a name="l00925">
     </a>
     <span class="lineno">
      925
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = 1;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l00926">
     </a>
     <span class="lineno">
      926
     </span>
     u_norm += d_xk[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] * d_xk[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l00927">
     </a>
     <span class="lineno">
      927
     </span>
     }
    </div>
    <div class="line">
     <a name="l00928">
     </a>
     <span class="lineno">
      928
     </span>
     T x0 = d_xk[0];
    </div>
    <div class="line">
     <a name="l00929">
     </a>
     <span class="lineno">
      929
     </span>
     x_norm =
     <a class="code" href="group__ScalarOps.html#gaa2f75a68cd7b273b2d761b99250a894d">
      sqrt
     </a>
     (u_norm + x0 * x0);
    </div>
    <div class="line">
     <a name="l00930">
     </a>
     <span class="lineno">
      930
     </span>
     T u0 = x0 +
     <a class="code" href="group__Sign.html#gab8883fa9c349ad60903ceeb420ca8149">
      signPrim
     </a>
     (x0) * x_norm;
    </div>
    <div class="line">
     <a name="l00931">
     </a>
     <span class="lineno">
      931
     </span>
     u_norm =
     <a class="code" href="group__ScalarOps.html#gaa2f75a68cd7b273b2d761b99250a894d">
      sqrt
     </a>
     (u_norm + u0 * u0);
    </div>
    <div class="line">
     <a name="l00932">
     </a>
     <span class="lineno">
      932
     </span>
    </div>
    <div class="line">
     <a name="l00933">
     </a>
     <span class="lineno">
      933
     </span>
     <span class="comment">
      // Compute u
     </span>
    </div>
    <div class="line">
     <a name="l00934">
     </a>
     <span class="lineno">
      934
     </span>
     d_uk[0] = u_norm != (T)0 ? (u0 / u_norm) : (T)1;
    </div>
    <div class="line">
     <a name="l00935">
     </a>
     <span class="lineno">
      935
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = 1;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l00936">
     </a>
     <span class="lineno">
      936
     </span>
     d_uk[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = u_norm != (T)0 ? (d_xk[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] / u_norm) : (T)0;
    </div>
    <div class="line">
     <a name="l00937">
     </a>
     <span class="lineno">
      937
     </span>
     }
    </div>
    <div class="line">
     <a name="l00938">
     </a>
     <span class="lineno">
      938
     </span>
     }
    </div>
    <div class="line">
     <a name="l00939">
     </a>
     <span class="lineno">
      939
     </span>
    </div>
    <div class="line">
     <a name="l00948">
     </a>
     <span class="lineno">
      948
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00949">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a141e64b529e6ea08df84c9d4ae546287">
       949
      </a>
     </span>
     <a class="code" href="cuda__utils_8h.html#acabe1ee3d11be6214c678bf4dabda3c9">
      DI
     </a>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#afb30eaabc37e040cd6d45d3bf39cddbf">
      generate_householder_vector
     </a>
     (T* d_uk,
     <span class="keyword">
      const
     </span>
     T* d_xk, T* shared_mem,
    </div>
    <div class="line">
     <a name="l00950">
     </a>
     <span class="lineno">
      950
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00951">
     </a>
     <span class="lineno">
      951
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x + 1;
    </div>
    <div class="line">
     <a name="l00952">
     </a>
     <span class="lineno">
      952
     </span>
    </div>
    <div class="line">
     <a name="l00953">
     </a>
     <span class="lineno">
      953
     </span>
     <span class="comment">
      // Compute norm of the vectors x and u
     </span>
    </div>
    <div class="line">
     <a name="l00954">
     </a>
     <span class="lineno">
      954
     </span>
     T x_norm, u_norm, u0;
    </div>
    <div class="line">
     <a name="l00955">
     </a>
     <span class="lineno">
      955
     </span>
     {
    </div>
    <div class="line">
     <a name="l00956">
     </a>
     <span class="lineno">
      956
     </span>
     <span class="comment">
      // First compute the squares and write in shared mem
     </span>
    </div>
    <div class="line">
     <a name="l00957">
     </a>
     <span class="lineno">
      957
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00958">
     </a>
     <span class="lineno">
      958
     </span>
     shared_mem[threadIdx.x] = d_xk[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] * d_xk[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l00959">
     </a>
     <span class="lineno">
      959
     </span>
     }
    </div>
    <div class="line">
     <a name="l00960">
     </a>
     <span class="lineno">
      960
     </span>
     <span class="comment">
      // Tree reduction
     </span>
    </div>
    <div class="line">
     <a name="l00961">
     </a>
     <span class="lineno">
      961
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     red_size =
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     - 1; red_size &gt; 1; red_size = (red_size + 1) / 2) {
    </div>
    <div class="line">
     <a name="l00962">
     </a>
     <span class="lineno">
      962
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l00963">
     </a>
     <span class="lineno">
      963
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt; red_size / 2) {
    </div>
    <div class="line">
     <a name="l00964">
     </a>
     <span class="lineno">
      964
     </span>
     shared_mem[threadIdx.x] += shared_mem[threadIdx.x + (red_size + 1) / 2];
    </div>
    <div class="line">
     <a name="l00965">
     </a>
     <span class="lineno">
      965
     </span>
     }
    </div>
    <div class="line">
     <a name="l00966">
     </a>
     <span class="lineno">
      966
     </span>
     }
    </div>
    <div class="line">
     <a name="l00967">
     </a>
     <span class="lineno">
      967
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l00968">
     </a>
     <span class="lineno">
      968
     </span>
     <span class="comment">
      // Finalize computation of the norms
     </span>
    </div>
    <div class="line">
     <a name="l00969">
     </a>
     <span class="lineno">
      969
     </span>
     T x0 = d_xk[0];
    </div>
    <div class="line">
     <a name="l00970">
     </a>
     <span class="lineno">
      970
     </span>
     x_norm =
     <a class="code" href="group__ScalarOps.html#gaa2f75a68cd7b273b2d761b99250a894d">
      sqrt
     </a>
     (shared_mem[0] + x0 * x0);
    </div>
    <div class="line">
     <a name="l00971">
     </a>
     <span class="lineno">
      971
     </span>
     u0 = x0 +
     <a class="code" href="group__Sign.html#gab8883fa9c349ad60903ceeb420ca8149">
      signPrim
     </a>
     (x0) * x_norm;
    </div>
    <div class="line">
     <a name="l00972">
     </a>
     <span class="lineno">
      972
     </span>
     u_norm =
     <a class="code" href="group__ScalarOps.html#gaa2f75a68cd7b273b2d761b99250a894d">
      sqrt
     </a>
     (shared_mem[0] + u0 * u0);
    </div>
    <div class="line">
     <a name="l00973">
     </a>
     <span class="lineno">
      973
     </span>
     }
    </div>
    <div class="line">
     <a name="l00974">
     </a>
     <span class="lineno">
      974
     </span>
    </div>
    <div class="line">
     <a name="l00975">
     </a>
     <span class="lineno">
      975
     </span>
     <span class="comment">
      // Compute vector u
     </span>
    </div>
    <div class="line">
     <a name="l00976">
     </a>
     <span class="lineno">
      976
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x == 0) {
    </div>
    <div class="line">
     <a name="l00977">
     </a>
     <span class="lineno">
      977
     </span>
     d_uk[0] = u_norm != (T)0 ? (u0 / u_norm) : (T)1;
    </div>
    <div class="line">
     <a name="l00978">
     </a>
     <span class="lineno">
      978
     </span>
     }
    </div>
    <div class="line">
     <a name="l00979">
     </a>
     <span class="lineno">
      979
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
      m
     </a>
     - 1) {
    </div>
    <div class="line">
     <a name="l00980">
     </a>
     <span class="lineno">
      980
     </span>
     d_uk[threadIdx.x + 1] =
    </div>
    <div class="line">
     <a name="l00981">
     </a>
     <span class="lineno">
      981
     </span>
     u_norm != (T)0 ? (d_xk[threadIdx.x + 1] / u_norm) : (T)0;
    </div>
    <div class="line">
     <a name="l00982">
     </a>
     <span class="lineno">
      982
     </span>
     }
    </div>
    <div class="line">
     <a name="l00983">
     </a>
     <span class="lineno">
      983
     </span>
     }
    </div>
    <div class="line">
     <a name="l00984">
     </a>
     <span class="lineno">
      984
     </span>
    </div>
    <div class="line">
     <a name="l00994">
     </a>
     <span class="lineno">
      994
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l00995">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a236656db7c4257dd43b1fc1ad0fbae6f">
       995
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a236656db7c4257dd43b1fc1ad0fbae6f">
      hessenberg_reduction_kernel
     </a>
     (T* d_U, T* d_H, T* d_hh,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l00996">
     </a>
     <span class="lineno">
      996
     </span>
     <span class="keywordtype">
      int
     </span>
     ib = blockIdx.x;
    </div>
    <div class="line">
     <a name="l00997">
     </a>
     <span class="lineno">
      997
     </span>
    </div>
    <div class="line">
     <a name="l00998">
     </a>
     <span class="lineno">
      998
     </span>
     <span class="keywordtype">
      int
     </span>
     hh_size = (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1)) / 2 - 1;
    </div>
    <div class="line">
     <a name="l00999">
     </a>
     <span class="lineno">
      999
     </span>
    </div>
    <div class="line">
     <a name="l01000">
     </a>
     <span class="lineno">
      1000
     </span>
     T* b_U = d_U +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * ib;
    </div>
    <div class="line">
     <a name="l01001">
     </a>
     <span class="lineno">
      1001
     </span>
     T* b_H = d_H +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * ib;
    </div>
    <div class="line">
     <a name="l01002">
     </a>
     <span class="lineno">
      1002
     </span>
     T* b_hh = d_hh + hh_size * ib;
    </div>
    <div class="line">
     <a name="l01003">
     </a>
     <span class="lineno">
      1003
     </span>
    </div>
    <div class="line">
     <a name="l01004">
     </a>
     <span class="lineno">
      1004
     </span>
     <span class="comment">
      // Shared memory used for the reduction needed to generate the reflector
     </span>
    </div>
    <div class="line">
     <a name="l01005">
     </a>
     <span class="lineno">
      1005
     </span>
     <span class="comment">
      // and for the reduction used in the matrix-vector and vector-matrix
     </span>
    </div>
    <div class="line">
     <a name="l01006">
     </a>
     <span class="lineno">
      1006
     </span>
     <span class="comment">
      // multiplications
     </span>
    </div>
    <div class="line">
     <a name="l01007">
     </a>
     <span class="lineno">
      1007
     </span>
     <span class="comment">
      // Neutral type to avoid conflict of definition ; size: n
     </span>
    </div>
    <div class="line">
     <a name="l01008">
     </a>
     <span class="lineno">
      1008
     </span>
     <span class="keyword">
      extern
     </span>
     __shared__ int8_t shared_mem_hessenberg[];
    </div>
    <div class="line">
     <a name="l01009">
     </a>
     <span class="lineno">
      1009
     </span>
     T* shared_mem = (T*)shared_mem_hessenberg;
    </div>
    <div class="line">
     <a name="l01010">
     </a>
     <span class="lineno">
      1010
     </span>
    </div>
    <div class="line">
     <a name="l01011">
     </a>
     <span class="lineno">
      1011
     </span>
     T* b_hh_k = b_hh;
    </div>
    <div class="line">
     <a name="l01012">
     </a>
     <span class="lineno">
      1012
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 2;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01013">
     </a>
     <span class="lineno">
      1013
     </span>
     <span class="comment">
      // Generate the reflector
     </span>
    </div>
    <div class="line">
     <a name="l01014">
     </a>
     <span class="lineno">
      1014
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#afb30eaabc37e040cd6d45d3bf39cddbf">
      generate_householder_vector
     </a>
     (b_hh_k, b_H + (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1, shared_mem,
    </div>
    <div class="line">
     <a name="l01015">
     </a>
     <span class="lineno">
      1015
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1);
    </div>
    <div class="line">
     <a name="l01016">
     </a>
     <span class="lineno">
      1016
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01017">
     </a>
     <span class="lineno">
      1017
     </span>
    </div>
    <div class="line">
     <a name="l01018">
     </a>
     <span class="lineno">
      1018
     </span>
     <span class="comment">
      // H[k+1:, k:] = H[k+1:, k:] - 2 * uk * (uk' * H[k+1:, k:])
     </span>
    </div>
    <div class="line">
     <a name="l01019">
     </a>
     <span class="lineno">
      1019
     </span>
     <span class="comment">
      // Note: we use a reduction in shared memory to have only coalesced
     </span>
    </div>
    <div class="line">
     <a name="l01020">
     </a>
     <span class="lineno">
      1020
     </span>
     <span class="comment">
      //       accesses to global memory
     </span>
    </div>
    <div class="line">
     <a name="l01021">
     </a>
     <span class="lineno">
      1021
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01022">
     </a>
     <span class="lineno">
      1022
     </span>
     <span class="comment">
      // Element-wise multiplication of uk and a column of H to shared mem
     </span>
    </div>
    <div class="line">
     <a name="l01023">
     </a>
     <span class="lineno">
      1023
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1 + threadIdx.x;
    </div>
    <div class="line">
     <a name="l01024">
     </a>
     <span class="lineno">
      1024
     </span>
     T hh_k_i;
    </div>
    <div class="line">
     <a name="l01025">
     </a>
     <span class="lineno">
      1025
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01026">
     </a>
     <span class="lineno">
      1026
     </span>
     hh_k_i = b_hh_k[threadIdx.x];
    </div>
    <div class="line">
     <a name="l01027">
     </a>
     <span class="lineno">
      1027
     </span>
     shared_mem[threadIdx.x] = hh_k_i * b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01028">
     </a>
     <span class="lineno">
      1028
     </span>
     }
    </div>
    <div class="line">
     <a name="l01029">
     </a>
     <span class="lineno">
      1029
     </span>
    </div>
    <div class="line">
     <a name="l01030">
     </a>
     <span class="lineno">
      1030
     </span>
     <span class="comment">
      // Tree reduction
     </span>
    </div>
    <div class="line">
     <a name="l01031">
     </a>
     <span class="lineno">
      1031
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     red_size =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1; red_size &gt; 1;
    </div>
    <div class="line">
     <a name="l01032">
     </a>
     <span class="lineno">
      1032
     </span>
     red_size = (red_size + 1) / 2) {
    </div>
    <div class="line">
     <a name="l01033">
     </a>
     <span class="lineno">
      1033
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01034">
     </a>
     <span class="lineno">
      1034
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt; red_size / 2) {
    </div>
    <div class="line">
     <a name="l01035">
     </a>
     <span class="lineno">
      1035
     </span>
     shared_mem[threadIdx.x] +=
    </div>
    <div class="line">
     <a name="l01036">
     </a>
     <span class="lineno">
      1036
     </span>
     shared_mem[threadIdx.x + (red_size + 1) / 2];
    </div>
    <div class="line">
     <a name="l01037">
     </a>
     <span class="lineno">
      1037
     </span>
     }
    </div>
    <div class="line">
     <a name="l01038">
     </a>
     <span class="lineno">
      1038
     </span>
     }
    </div>
    <div class="line">
     <a name="l01039">
     </a>
     <span class="lineno">
      1039
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01040">
     </a>
     <span class="lineno">
      1040
     </span>
    </div>
    <div class="line">
     <a name="l01041">
     </a>
     <span class="lineno">
      1041
     </span>
     <span class="comment">
      // Overwrite H
     </span>
    </div>
    <div class="line">
     <a name="l01042">
     </a>
     <span class="lineno">
      1042
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01043">
     </a>
     <span class="lineno">
      1043
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] -= (T)2 * hh_k_i * shared_mem[0];
    </div>
    <div class="line">
     <a name="l01044">
     </a>
     <span class="lineno">
      1044
     </span>
     }
    </div>
    <div class="line">
     <a name="l01045">
     </a>
     <span class="lineno">
      1045
     </span>
     }
    </div>
    <div class="line">
     <a name="l01046">
     </a>
     <span class="lineno">
      1046
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01047">
     </a>
     <span class="lineno">
      1047
     </span>
    </div>
    <div class="line">
     <a name="l01048">
     </a>
     <span class="lineno">
      1048
     </span>
     <span class="comment">
      // H[:, k+1:] = H[:, k+1:] - 2 * (H[:, k+1:] * uk) * uk'
     </span>
    </div>
    <div class="line">
     <a name="l01049">
     </a>
     <span class="lineno">
      1049
     </span>
     <span class="comment">
      // Note: we do a coalesced load of hh_k in shared memory
     </span>
    </div>
    <div class="line">
     <a name="l01050">
     </a>
     <span class="lineno">
      1050
     </span>
     {
    </div>
    <div class="line">
     <a name="l01051">
     </a>
     <span class="lineno">
      1051
     </span>
     <span class="comment">
      // Load hh_k in shared memory
     </span>
    </div>
    <div class="line">
     <a name="l01052">
     </a>
     <span class="lineno">
      1052
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) {
    </div>
    <div class="line">
     <a name="l01053">
     </a>
     <span class="lineno">
      1053
     </span>
     shared_mem[threadIdx.x] = b_hh_k[threadIdx.x];
    </div>
    <div class="line">
     <a name="l01054">
     </a>
     <span class="lineno">
      1054
     </span>
     }
    </div>
    <div class="line">
     <a name="l01055">
     </a>
     <span class="lineno">
      1055
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01056">
     </a>
     <span class="lineno">
      1056
     </span>
    </div>
    <div class="line">
     <a name="l01057">
     </a>
     <span class="lineno">
      1057
     </span>
     <span class="comment">
      // Compute multiplications
     </span>
    </div>
    <div class="line">
     <a name="l01058">
     </a>
     <span class="lineno">
      1058
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     &amp;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
    </div>
    <div class="line">
     <a name="l01059">
     </a>
     <span class="lineno">
      1059
     </span>
     T acc = 0;
    </div>
    <div class="line">
     <a name="l01060">
     </a>
     <span class="lineno">
      1060
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01061">
     </a>
     <span class="lineno">
      1061
     </span>
     acc += b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] * shared_mem[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1];
    </div>
    <div class="line">
     <a name="l01062">
     </a>
     <span class="lineno">
      1062
     </span>
     }
    </div>
    <div class="line">
     <a name="l01063">
     </a>
     <span class="lineno">
      1063
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01064">
     </a>
     <span class="lineno">
      1064
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] -= (T)2 * acc * shared_mem[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1];
    </div>
    <div class="line">
     <a name="l01065">
     </a>
     <span class="lineno">
      1065
     </span>
     }
    </div>
    <div class="line">
     <a name="l01066">
     </a>
     <span class="lineno">
      1066
     </span>
     }
    </div>
    <div class="line">
     <a name="l01067">
     </a>
     <span class="lineno">
      1067
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01068">
     </a>
     <span class="lineno">
      1068
     </span>
    </div>
    <div class="line">
     <a name="l01069">
     </a>
     <span class="lineno">
      1069
     </span>
     b_hh_k +=
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1;
    </div>
    <div class="line">
     <a name="l01070">
     </a>
     <span class="lineno">
      1070
     </span>
     }
    </div>
    <div class="line">
     <a name="l01071">
     </a>
     <span class="lineno">
      1071
     </span>
    </div>
    <div class="line">
     <a name="l01072">
     </a>
     <span class="lineno">
      1072
     </span>
     b_hh_k = b_hh + hh_size - 2;
    </div>
    <div class="line">
     <a name="l01073">
     </a>
     <span class="lineno">
      1073
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 3;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &gt;= 0;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     --) {
    </div>
    <div class="line">
     <a name="l01074">
     </a>
     <span class="lineno">
      1074
     </span>
     <span class="comment">
      // U[k+1:, k+1:] = U[k+1:, k+1:] - 2 * uk * (uk' * U[k+1:, k+1:])
     </span>
    </div>
    <div class="line">
     <a name="l01075">
     </a>
     <span class="lineno">
      1075
     </span>
     <span class="comment">
      // Note: we use a reduction in shared memory to have only coalesced
     </span>
    </div>
    <div class="line">
     <a name="l01076">
     </a>
     <span class="lineno">
      1076
     </span>
     <span class="comment">
      //       accesses to global memory
     </span>
    </div>
    <div class="line">
     <a name="l01077">
     </a>
     <span class="lineno">
      1077
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01078">
     </a>
     <span class="lineno">
      1078
     </span>
     <span class="comment">
      // Element-wise multiplication of uk and a column of U to shared mem
     </span>
    </div>
    <div class="line">
     <a name="l01079">
     </a>
     <span class="lineno">
      1079
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1 + threadIdx.x;
    </div>
    <div class="line">
     <a name="l01080">
     </a>
     <span class="lineno">
      1080
     </span>
     T hh_k_i;
    </div>
    <div class="line">
     <a name="l01081">
     </a>
     <span class="lineno">
      1081
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01082">
     </a>
     <span class="lineno">
      1082
     </span>
     hh_k_i = b_hh_k[threadIdx.x];
    </div>
    <div class="line">
     <a name="l01083">
     </a>
     <span class="lineno">
      1083
     </span>
     shared_mem[threadIdx.x] = hh_k_i * b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01084">
     </a>
     <span class="lineno">
      1084
     </span>
     }
    </div>
    <div class="line">
     <a name="l01085">
     </a>
     <span class="lineno">
      1085
     </span>
    </div>
    <div class="line">
     <a name="l01086">
     </a>
     <span class="lineno">
      1086
     </span>
     <span class="comment">
      // Tree reduction
     </span>
    </div>
    <div class="line">
     <a name="l01087">
     </a>
     <span class="lineno">
      1087
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     red_size =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1; red_size &gt; 1;
    </div>
    <div class="line">
     <a name="l01088">
     </a>
     <span class="lineno">
      1088
     </span>
     red_size = (red_size + 1) / 2) {
    </div>
    <div class="line">
     <a name="l01089">
     </a>
     <span class="lineno">
      1089
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01090">
     </a>
     <span class="lineno">
      1090
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt; red_size / 2) {
    </div>
    <div class="line">
     <a name="l01091">
     </a>
     <span class="lineno">
      1091
     </span>
     shared_mem[threadIdx.x] +=
    </div>
    <div class="line">
     <a name="l01092">
     </a>
     <span class="lineno">
      1092
     </span>
     shared_mem[threadIdx.x + (red_size + 1) / 2];
    </div>
    <div class="line">
     <a name="l01093">
     </a>
     <span class="lineno">
      1093
     </span>
     }
    </div>
    <div class="line">
     <a name="l01094">
     </a>
     <span class="lineno">
      1094
     </span>
     }
    </div>
    <div class="line">
     <a name="l01095">
     </a>
     <span class="lineno">
      1095
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01096">
     </a>
     <span class="lineno">
      1096
     </span>
    </div>
    <div class="line">
     <a name="l01097">
     </a>
     <span class="lineno">
      1097
     </span>
     <span class="comment">
      // Overwrite U
     </span>
    </div>
    <div class="line">
     <a name="l01098">
     </a>
     <span class="lineno">
      1098
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01099">
     </a>
     <span class="lineno">
      1099
     </span>
     b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] -= (T)2 * hh_k_i * shared_mem[0];
    </div>
    <div class="line">
     <a name="l01100">
     </a>
     <span class="lineno">
      1100
     </span>
     }
    </div>
    <div class="line">
     <a name="l01101">
     </a>
     <span class="lineno">
      1101
     </span>
     }
    </div>
    <div class="line">
     <a name="l01102">
     </a>
     <span class="lineno">
      1102
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01103">
     </a>
     <span class="lineno">
      1103
     </span>
    </div>
    <div class="line">
     <a name="l01104">
     </a>
     <span class="lineno">
      1104
     </span>
     b_hh_k -=
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01105">
     </a>
     <span class="lineno">
      1105
     </span>
     }
    </div>
    <div class="line">
     <a name="l01106">
     </a>
     <span class="lineno">
      1106
     </span>
     }
    </div>
    <div class="line">
     <a name="l01107">
     </a>
     <span class="lineno">
      1107
     </span>
    </div>
    <div class="line">
     <a name="l01118">
     </a>
     <span class="lineno">
      1118
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01119">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a9c7ba116918e57a952e2ff9069a975ac">
       1119
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a9c7ba116918e57a952e2ff9069a975ac">
      b_hessenberg
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; U,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; H) {
    </div>
    <div class="line">
     <a name="l01120">
     </a>
     <span class="lineno">
      1120
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l01121">
     </a>
     <span class="lineno">
      1121
     </span>
     <span class="keywordtype">
      int
     </span>
     n2 =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01122">
     </a>
     <span class="lineno">
      1122
     </span>
     <span class="keywordtype">
      int
     </span>
     batch_size = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01123">
     </a>
     <span class="lineno">
      1123
     </span>
     <span class="keyword">
      auto
     </span>
     stream = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01124">
     </a>
     <span class="lineno">
      1124
     </span>
     <span class="keyword">
      auto
     </span>
     allocator = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01125">
     </a>
     <span class="lineno">
      1125
     </span>
    </div>
    <div class="line">
     <a name="l01126">
     </a>
     <span class="lineno">
      1126
     </span>
     <span class="comment">
      // Copy A in H
     </span>
    </div>
    <div class="line">
     <a name="l01127">
     </a>
     <span class="lineno">
      1127
     </span>
     <a class="code" href="namespaceMLCommon.html#afd611e92a01811c35ec733fd18112064">
      copy
     </a>
     (H.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), n2 * batch_size, stream);
    </div>
    <div class="line">
     <a name="l01128">
     </a>
     <span class="lineno">
      1128
     </span>
    </div>
    <div class="line">
     <a name="l01129">
     </a>
     <span class="lineno">
      1129
     </span>
     <span class="comment">
      // Initialize U with the identity
     </span>
    </div>
    <div class="line">
     <a name="l01130">
     </a>
     <span class="lineno">
      1130
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (
    </div>
    <div class="line">
     <a name="l01131">
     </a>
     <span class="lineno">
      1131
     </span>
     cudaMemsetAsync(U.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), 0,
     <span class="keyword">
      sizeof
     </span>
     (T) * n2 * batch_size, stream));
    </div>
    <div class="line">
     <a name="l01132">
     </a>
     <span class="lineno">
      1132
     </span>
     identity_matrix_kernel&lt;T&gt;
    </div>
    <div class="line">
     <a name="l01133">
     </a>
     <span class="lineno">
      1133
     </span>
     &lt;&lt;&lt;batch_size, std::min(256,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ), 0, stream&gt;&gt;&gt;(U.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     );
    </div>
    <div class="line">
     <a name="l01134">
     </a>
     <span class="lineno">
      1134
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l01135">
     </a>
     <span class="lineno">
      1135
     </span>
    </div>
    <div class="line">
     <a name="l01136">
     </a>
     <span class="lineno">
      1136
     </span>
     <span class="comment">
      // Create a temporary buffer to store the Householder vectors
     </span>
    </div>
    <div class="line">
     <a name="l01137">
     </a>
     <span class="lineno">
      1137
     </span>
     <span class="keywordtype">
      int
     </span>
     hh_size = (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1)) / 2 - 1;
    </div>
    <div class="line">
     <a name="l01138">
     </a>
     <span class="lineno">
      1138
     </span>
     <a class="code" href="classMLCommon_1_1buffer__base.html">
      device_buffer&lt;T&gt;
     </a>
     hh_buffer(allocator, stream, hh_size * batch_size);
    </div>
    <div class="line">
     <a name="l01139">
     </a>
     <span class="lineno">
      1139
     </span>
    </div>
    <div class="line">
     <a name="l01140">
     </a>
     <span class="lineno">
      1140
     </span>
     <span class="comment">
      // Transform H to Hessenberg form in-place and update U
     </span>
    </div>
    <div class="line">
     <a name="l01141">
     </a>
     <span class="lineno">
      1141
     </span>
     <span class="keywordtype">
      int
     </span>
     shared_mem_size =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <span class="keyword">
      sizeof
     </span>
     (T);
    </div>
    <div class="line">
     <a name="l01142">
     </a>
     <span class="lineno">
      1142
     </span>
     hessenberg_reduction_kernel&lt;&lt;&lt;batch_size, n, shared_mem_size, stream&gt;&gt;&gt;(
    </div>
    <div class="line">
     <a name="l01143">
     </a>
     <span class="lineno">
      1143
     </span>
     U.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), H.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), hh_buffer.
     <a class="code" href="classMLCommon_1_1buffer__base.html#a6cfb419e0cdf871abec33416711ae8ec">
      data
     </a>
     (),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     );
    </div>
    <div class="line">
     <a name="l01144">
     </a>
     <span class="lineno">
      1144
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l01145">
     </a>
     <span class="lineno">
      1145
     </span>
     }
    </div>
    <div class="line">
     <a name="l01146">
     </a>
     <span class="lineno">
      1146
     </span>
    </div>
    <div class="line">
     <a name="l01155">
     </a>
     <span class="lineno">
      1155
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01156">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a6e3278fec6e37f36229277c91db26c4a">
       1156
      </a>
     </span>
     <a class="code" href="cuda__utils_8h.html#acabe1ee3d11be6214c678bf4dabda3c9">
      DI
     </a>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a6e3278fec6e37f36229277c91db26c4a">
      generate_givens
     </a>
     (T a, T b, T&amp; c, T&amp; s) {
    </div>
    <div class="line">
     <a name="l01157">
     </a>
     <span class="lineno">
      1157
     </span>
     <span class="keywordflow">
      if
     </span>
     (b == 0) {
    </div>
    <div class="line">
     <a name="l01158">
     </a>
     <span class="lineno">
      1158
     </span>
     c =
     <a class="code" href="group__Sign.html#gab8883fa9c349ad60903ceeb420ca8149">
      signPrim
     </a>
     (a);
    </div>
    <div class="line">
     <a name="l01159">
     </a>
     <span class="lineno">
      1159
     </span>
     s = 0;
    </div>
    <div class="line">
     <a name="l01160">
     </a>
     <span class="lineno">
      1160
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     <span class="keywordflow">
      if
     </span>
     (a == 0) {
    </div>
    <div class="line">
     <a name="l01161">
     </a>
     <span class="lineno">
      1161
     </span>
     c = 0;
    </div>
    <div class="line">
     <a name="l01162">
     </a>
     <span class="lineno">
      1162
     </span>
     s =
     <a class="code" href="group__Sign.html#gab8883fa9c349ad60903ceeb420ca8149">
      signPrim
     </a>
     (b);
    </div>
    <div class="line">
     <a name="l01163">
     </a>
     <span class="lineno">
      1163
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     <span class="keywordflow">
      if
     </span>
     (abs(a) &gt; abs(b)) {
    </div>
    <div class="line">
     <a name="l01164">
     </a>
     <span class="lineno">
      1164
     </span>
     T t = -b / a;
    </div>
    <div class="line">
     <a name="l01165">
     </a>
     <span class="lineno">
      1165
     </span>
     c = (T)1 /
     <a class="code" href="group__ScalarOps.html#gaa2f75a68cd7b273b2d761b99250a894d">
      sqrt
     </a>
     (1 + t * t);
    </div>
    <div class="line">
     <a name="l01166">
     </a>
     <span class="lineno">
      1166
     </span>
     s = c * t;
    </div>
    <div class="line">
     <a name="l01167">
     </a>
     <span class="lineno">
      1167
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     {
    </div>
    <div class="line">
     <a name="l01168">
     </a>
     <span class="lineno">
      1168
     </span>
     T t = -a / b;
    </div>
    <div class="line">
     <a name="l01169">
     </a>
     <span class="lineno">
      1169
     </span>
     s = (T)1 /
     <a class="code" href="group__ScalarOps.html#gaa2f75a68cd7b273b2d761b99250a894d">
      sqrt
     </a>
     (1 + t * t);
    </div>
    <div class="line">
     <a name="l01170">
     </a>
     <span class="lineno">
      1170
     </span>
     c = s * t;
    </div>
    <div class="line">
     <a name="l01171">
     </a>
     <span class="lineno">
      1171
     </span>
     }
    </div>
    <div class="line">
     <a name="l01172">
     </a>
     <span class="lineno">
      1172
     </span>
     }
    </div>
    <div class="line">
     <a name="l01173">
     </a>
     <span class="lineno">
      1173
     </span>
    </div>
    <div class="line">
     <a name="l01185">
     </a>
     <span class="lineno">
      1185
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01186">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ae0c8f266eb680e0b26d8461e1f037099">
       1186
      </a>
     </span>
     <a class="code" href="cuda__utils_8h.html#acabe1ee3d11be6214c678bf4dabda3c9">
      DI
     </a>
     <span class="keywordtype">
      bool
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ae0c8f266eb680e0b26d8461e1f037099">
      ahues_tisseur
     </a>
     (
     <span class="keyword">
      const
     </span>
     T* d_M,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01187">
     </a>
     <span class="lineno">
      1187
     </span>
     constexpr T eps = std::is_same&lt;T, double&gt;::value ? 1e-10 : 1e-6
     <a class="code" href="namespaceUMAPAlgo_1_1Optimize.html#ad1d8470650aa6ea82693fdf61479e708">
      f
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01188">
     </a>
     <span class="lineno">
      1188
     </span>
     constexpr T near_zero = std::is_same&lt;T, double&gt;::value ? 1e-14 : 1e-8
     <a class="code" href="namespaceUMAPAlgo_1_1Optimize.html#ad1d8470650aa6ea82693fdf61479e708">
      f
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01189">
     </a>
     <span class="lineno">
      1189
     </span>
    </div>
    <div class="line">
     <a name="l01190">
     </a>
     <span class="lineno">
      1190
     </span>
     T h00 = d_M[(
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     - 1];
    </div>
    <div class="line">
     <a name="l01191">
     </a>
     <span class="lineno">
      1191
     </span>
     T h10 = d_M[(
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01192">
     </a>
     <span class="lineno">
      1192
     </span>
     T h01 = d_M[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     - 1];
    </div>
    <div class="line">
     <a name="l01193">
     </a>
     <span class="lineno">
      1193
     </span>
     T h11 = d_M[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01194">
     </a>
     <span class="lineno">
      1194
     </span>
    </div>
    <div class="line">
     <a name="l01195">
     </a>
     <span class="lineno">
      1195
     </span>
     <span class="keywordflow">
      return
     </span>
     (abs(h10) * abs(h01) &lt;
    </div>
    <div class="line">
     <a name="l01196">
     </a>
     <span class="lineno">
      1196
     </span>
     <a class="code" href="group__Max.html#ga965c72198e8e95ce122e1ecf6b5ebe98">
      maxPrim
     </a>
     (eps * abs(h11) * abs(h11 - h00), near_zero));
    </div>
    <div class="line">
     <a name="l01197">
     </a>
     <span class="lineno">
      1197
     </span>
     }
    </div>
    <div class="line">
     <a name="l01198">
     </a>
     <span class="lineno">
      1198
     </span>
    </div>
    <div class="line">
     <a name="l01210">
     </a>
     <span class="lineno">
      1210
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01211">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a061a8fe688e5980e4f3a1b9ad10bf3d0">
       1211
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a061a8fe688e5980e4f3a1b9ad10bf3d0">
      francis_qr_algorithm_kernel
     </a>
     (T* d_U, T* d_H,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01212">
     </a>
     <span class="lineno">
      1212
     </span>
     <span class="keywordtype">
      int
     </span>
     ib = blockIdx.x;
    </div>
    <div class="line">
     <a name="l01213">
     </a>
     <span class="lineno">
      1213
     </span>
    </div>
    <div class="line">
     <a name="l01214">
     </a>
     <span class="lineno">
      1214
     </span>
     <span class="comment">
      // The algorithm reduces the Hessenberg matrix H to real Schur form by
     </span>
    </div>
    <div class="line">
     <a name="l01215">
     </a>
     <span class="lineno">
      1215
     </span>
     <span class="comment">
      // iteratively decreasing the value p such that H has the following form:
     </span>
    </div>
    <div class="line">
     <a name="l01216">
     </a>
     <span class="lineno">
      1216
     </span>
     <span class="comment">
      //  _________________
     </span>
    </div>
    <div class="line">
     <a name="l01217">
     </a>
     <span class="lineno">
      1217
     </span>
     <span class="comment">
      // | H11 | H12 | H13 |  q
     </span>
    </div>
    <div class="line">
     <a name="l01218">
     </a>
     <span class="lineno">
      1218
     </span>
     <span class="comment">
      // |_____|_____|_____|
     </span>
    </div>
    <div class="line">
     <a name="l01219">
     </a>
     <span class="lineno">
      1219
     </span>
     <span class="comment">
      // |  0  | H22 | H23 | p-q
     </span>
    </div>
    <div class="line">
     <a name="l01220">
     </a>
     <span class="lineno">
      1220
     </span>
     <span class="comment">
      // |_____|_____|_____|
     </span>
    </div>
    <div class="line">
     <a name="l01221">
     </a>
     <span class="lineno">
      1221
     </span>
     <span class="comment">
      // |  0  |  0  | H33 | n-p
     </span>
    </div>
    <div class="line">
     <a name="l01222">
     </a>
     <span class="lineno">
      1222
     </span>
     <span class="comment">
      // |_____|_____|_____|
     </span>
    </div>
    <div class="line">
     <a name="l01223">
     </a>
     <span class="lineno">
      1223
     </span>
     <span class="comment">
      //    q    p-q   n-p
     </span>
    </div>
    <div class="line">
     <a name="l01224">
     </a>
     <span class="lineno">
      1224
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01225">
     </a>
     <span class="lineno">
      1225
     </span>
     <span class="comment">
      // Where H22 is unreduced, H33 is upper quasi-triangular, and q and p as
     </span>
    </div>
    <div class="line">
     <a name="l01226">
     </a>
     <span class="lineno">
      1226
     </span>
     <span class="comment">
      // small as possible.
     </span>
    </div>
    <div class="line">
     <a name="l01227">
     </a>
     <span class="lineno">
      1227
     </span>
    </div>
    <div class="line">
     <a name="l01228">
     </a>
     <span class="lineno">
      1228
     </span>
     T* b_U = d_U + ib *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01229">
     </a>
     <span class="lineno">
      1229
     </span>
     T* b_H = d_H + ib *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01230">
     </a>
     <span class="lineno">
      1230
     </span>
    </div>
    <div class="line">
     <a name="l01231">
     </a>
     <span class="lineno">
      1231
     </span>
     <span class="keywordtype">
      int
     </span>
     p =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01232">
     </a>
     <span class="lineno">
      1232
     </span>
     <span class="keywordtype">
      int
     </span>
     step_iter = 0;
    </div>
    <div class="line">
     <a name="l01233">
     </a>
     <span class="lineno">
      1233
     </span>
    </div>
    <div class="line">
     <a name="l01234">
     </a>
     <span class="lineno">
      1234
     </span>
     constexpr
     <span class="keywordtype">
      int
     </span>
     max_iter_per_step = 20;
    </div>
    <div class="line">
     <a name="l01235">
     </a>
     <span class="lineno">
      1235
     </span>
    </div>
    <div class="line">
     <a name="l01236">
     </a>
     <span class="lineno">
      1236
     </span>
     <span class="keywordflow">
      while
     </span>
     (p &gt; 2) {
    </div>
    <div class="line">
     <a name="l01237">
     </a>
     <span class="lineno">
      1237
     </span>
     <span class="comment">
      // Set to zero all the subdiagonals elements that satisfy Ahues and
     </span>
    </div>
    <div class="line">
     <a name="l01238">
     </a>
     <span class="lineno">
      1238
     </span>
     <span class="comment">
      // Tisseur's criterion
     </span>
    </div>
    <div class="line">
     <a name="l01239">
     </a>
     <span class="lineno">
      1239
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     = threadIdx.x + 1;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &lt; p;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01240">
     </a>
     <span class="lineno">
      1240
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ae0c8f266eb680e0b26d8461e1f037099">
      ahues_tisseur
     </a>
     (b_H,
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     )) b_H[(
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] = 0;
    </div>
    <div class="line">
     <a name="l01241">
     </a>
     <span class="lineno">
      1241
     </span>
     }
    </div>
    <div class="line">
     <a name="l01242">
     </a>
     <span class="lineno">
      1242
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01243">
     </a>
     <span class="lineno">
      1243
     </span>
    </div>
    <div class="line">
     <a name="l01244">
     </a>
     <span class="lineno">
      1244
     </span>
     <span class="comment">
      // Convergence test
     </span>
    </div>
    <div class="line">
     <a name="l01245">
     </a>
     <span class="lineno">
      1245
     </span>
     {
    </div>
    <div class="line">
     <a name="l01246">
     </a>
     <span class="lineno">
      1246
     </span>
     <span class="comment">
      // Fake convergence if necessary
     </span>
    </div>
    <div class="line">
     <a name="l01247">
     </a>
     <span class="lineno">
      1247
     </span>
     <span class="keywordtype">
      int
     </span>
     forced = 0;
    </div>
    <div class="line">
     <a name="l01248">
     </a>
     <span class="lineno">
      1248
     </span>
     <span class="keywordflow">
      if
     </span>
     (step_iter == max_iter_per_step) {
    </div>
    <div class="line">
     <a name="l01249">
     </a>
     <span class="lineno">
      1249
     </span>
     <span class="keywordflow">
      if
     </span>
     (abs(b_H[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 1]) &lt; abs(b_H[(p - 3) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 2]))
    </div>
    <div class="line">
     <a name="l01250">
     </a>
     <span class="lineno">
      1250
     </span>
     forced = 1;
    </div>
    <div class="line">
     <a name="l01251">
     </a>
     <span class="lineno">
      1251
     </span>
     <span class="keywordflow">
      else
     </span>
    </div>
    <div class="line">
     <a name="l01252">
     </a>
     <span class="lineno">
      1252
     </span>
     forced = 2;
    </div>
    <div class="line">
     <a name="l01253">
     </a>
     <span class="lineno">
      1253
     </span>
     }
    </div>
    <div class="line">
     <a name="l01254">
     </a>
     <span class="lineno">
      1254
     </span>
    </div>
    <div class="line">
     <a name="l01255">
     </a>
     <span class="lineno">
      1255
     </span>
     <span class="comment">
      // Decrease p if possible
     </span>
    </div>
    <div class="line">
     <a name="l01256">
     </a>
     <span class="lineno">
      1256
     </span>
     <span class="keywordflow">
      if
     </span>
     (forced == 1 || b_H[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 1] == 0) {
    </div>
    <div class="line">
     <a name="l01257">
     </a>
     <span class="lineno">
      1257
     </span>
     p--;
    </div>
    <div class="line">
     <a name="l01258">
     </a>
     <span class="lineno">
      1258
     </span>
     step_iter = 0;
    </div>
    <div class="line">
     <a name="l01259">
     </a>
     <span class="lineno">
      1259
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     <span class="keywordflow">
      if
     </span>
     (forced == 2 || b_H[(p - 3) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 2] == 0) {
    </div>
    <div class="line">
     <a name="l01260">
     </a>
     <span class="lineno">
      1260
     </span>
     p -= 2;
    </div>
    <div class="line">
     <a name="l01261">
     </a>
     <span class="lineno">
      1261
     </span>
     step_iter = 0;
    </div>
    <div class="line">
     <a name="l01262">
     </a>
     <span class="lineno">
      1262
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     {
    </div>
    <div class="line">
     <a name="l01263">
     </a>
     <span class="lineno">
      1263
     </span>
     step_iter++;
    </div>
    <div class="line">
     <a name="l01264">
     </a>
     <span class="lineno">
      1264
     </span>
     }
    </div>
    <div class="line">
     <a name="l01265">
     </a>
     <span class="lineno">
      1265
     </span>
     }
    </div>
    <div class="line">
     <a name="l01266">
     </a>
     <span class="lineno">
      1266
     </span>
    </div>
    <div class="line">
     <a name="l01267">
     </a>
     <span class="lineno">
      1267
     </span>
     <span class="keywordflow">
      if
     </span>
     (p &lt;= 2)
     <span class="keywordflow">
      break
     </span>
     ;
    </div>
    <div class="line">
     <a name="l01268">
     </a>
     <span class="lineno">
      1268
     </span>
    </div>
    <div class="line">
     <a name="l01269">
     </a>
     <span class="lineno">
      1269
     </span>
     <span class="comment">
      // Francis QR step
     </span>
    </div>
    <div class="line">
     <a name="l01270">
     </a>
     <span class="lineno">
      1270
     </span>
     {
    </div>
    <div class="line">
     <a name="l01271">
     </a>
     <span class="lineno">
      1271
     </span>
     <span class="comment">
      // Find q
     </span>
    </div>
    <div class="line">
     <a name="l01272">
     </a>
     <span class="lineno">
      1272
     </span>
     <span class="keywordtype">
      int
     </span>
     q = 0;
    </div>
    <div class="line">
     <a name="l01273">
     </a>
     <span class="lineno">
      1273
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     = p - 2;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &gt; 0;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     --) {
    </div>
    <div class="line">
     <a name="l01274">
     </a>
     <span class="lineno">
      1274
     </span>
     <span class="keywordflow">
      if
     </span>
     (b_H[(
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] == 0) q =
     <a class="code" href="group__Max.html#ga965c72198e8e95ce122e1ecf6b5ebe98">
      maxPrim
     </a>
     (q,
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     );
    </div>
    <div class="line">
     <a name="l01275">
     </a>
     <span class="lineno">
      1275
     </span>
     }
    </div>
    <div class="line">
     <a name="l01276">
     </a>
     <span class="lineno">
      1276
     </span>
    </div>
    <div class="line">
     <a name="l01277">
     </a>
     <span class="lineno">
      1277
     </span>
     <span class="comment">
      // Compute first column of (H-aI)(H-bI), where a and b are the eigenvalues
     </span>
    </div>
    <div class="line">
     <a name="l01278">
     </a>
     <span class="lineno">
      1278
     </span>
     <span class="comment">
      // of the trailing matrix of H22
     </span>
    </div>
    <div class="line">
     <a name="l01279">
     </a>
     <span class="lineno">
      1279
     </span>
     T v[3];
    </div>
    <div class="line">
     <a name="l01280">
     </a>
     <span class="lineno">
      1280
     </span>
     {
    </div>
    <div class="line">
     <a name="l01281">
     </a>
     <span class="lineno">
      1281
     </span>
     T x00 = b_H[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 2];
    </div>
    <div class="line">
     <a name="l01282">
     </a>
     <span class="lineno">
      1282
     </span>
     T x10 = b_H[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 1];
    </div>
    <div class="line">
     <a name="l01283">
     </a>
     <span class="lineno">
      1283
     </span>
     T x01 = b_H[(p - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 2];
    </div>
    <div class="line">
     <a name="l01284">
     </a>
     <span class="lineno">
      1284
     </span>
     T x11 = b_H[(p - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 1];
    </div>
    <div class="line">
     <a name="l01285">
     </a>
     <span class="lineno">
      1285
     </span>
     T s = x00 + x11;
    </div>
    <div class="line">
     <a name="l01286">
     </a>
     <span class="lineno">
      1286
     </span>
     T t = x00 * x11 - x10 * x01;
    </div>
    <div class="line">
     <a name="l01287">
     </a>
     <span class="lineno">
      1287
     </span>
     T h00 = b_H[q *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + q];
    </div>
    <div class="line">
     <a name="l01288">
     </a>
     <span class="lineno">
      1288
     </span>
     T h10 = b_H[q *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + q + 1];
    </div>
    <div class="line">
     <a name="l01289">
     </a>
     <span class="lineno">
      1289
     </span>
     T h01 = b_H[(q + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + q];
    </div>
    <div class="line">
     <a name="l01290">
     </a>
     <span class="lineno">
      1290
     </span>
     T h11 = b_H[(q + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + q + 1];
    </div>
    <div class="line">
     <a name="l01291">
     </a>
     <span class="lineno">
      1291
     </span>
     T h21 = b_H[(q + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + q + 2];
    </div>
    <div class="line">
     <a name="l01292">
     </a>
     <span class="lineno">
      1292
     </span>
    </div>
    <div class="line">
     <a name="l01293">
     </a>
     <span class="lineno">
      1293
     </span>
     v[0] = (h00 - s) * h00 + h01 * h10 + t;
    </div>
    <div class="line">
     <a name="l01294">
     </a>
     <span class="lineno">
      1294
     </span>
     v[1] = h10 * (h00 + h11 - s);
    </div>
    <div class="line">
     <a name="l01295">
     </a>
     <span class="lineno">
      1295
     </span>
     v[2] = h10 * h21;
    </div>
    <div class="line">
     <a name="l01296">
     </a>
     <span class="lineno">
      1296
     </span>
     }
    </div>
    <div class="line">
     <a name="l01297">
     </a>
     <span class="lineno">
      1297
     </span>
    </div>
    <div class="line">
     <a name="l01298">
     </a>
     <span class="lineno">
      1298
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     = q;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &lt; p - 2;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01299">
     </a>
     <span class="lineno">
      1299
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01300">
     </a>
     <span class="lineno">
      1300
     </span>
    </div>
    <div class="line">
     <a name="l01301">
     </a>
     <span class="lineno">
      1301
     </span>
     <span class="comment">
      // Generate a reflector P such that Pv' = a e1
     </span>
    </div>
    <div class="line">
     <a name="l01302">
     </a>
     <span class="lineno">
      1302
     </span>
     T u[3];
    </div>
    <div class="line">
     <a name="l01303">
     </a>
     <span class="lineno">
      1303
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#afb30eaabc37e040cd6d45d3bf39cddbf">
      generate_householder_vector
     </a>
     (u, v, 3);
    </div>
    <div class="line">
     <a name="l01304">
     </a>
     <span class="lineno">
      1304
     </span>
     T P[6];
     <span class="comment">
      // P symmetric; P00 P01 P02 P11 P12 P22
     </span>
    </div>
    <div class="line">
     <a name="l01305">
     </a>
     <span class="lineno">
      1305
     </span>
     P[0] = (T)1 - (T)2 * u[0] * u[0];
    </div>
    <div class="line">
     <a name="l01306">
     </a>
     <span class="lineno">
      1306
     </span>
     P[1] = (T)-2 * u[0] * u[1];
    </div>
    <div class="line">
     <a name="l01307">
     </a>
     <span class="lineno">
      1307
     </span>
     P[2] = (T)-2 * u[0] * u[2];
    </div>
    <div class="line">
     <a name="l01308">
     </a>
     <span class="lineno">
      1308
     </span>
     P[3] = (T)1 - (T)2 * u[1] * u[1];
    </div>
    <div class="line">
     <a name="l01309">
     </a>
     <span class="lineno">
      1309
     </span>
     P[4] = (T)-2 * u[1] * u[2];
    </div>
    <div class="line">
     <a name="l01310">
     </a>
     <span class="lineno">
      1310
     </span>
     P[5] = (T)1 - (T)2 * u[2] * u[2];
    </div>
    <div class="line">
     <a name="l01311">
     </a>
     <span class="lineno">
      1311
     </span>
    </div>
    <div class="line">
     <a name="l01312">
     </a>
     <span class="lineno">
      1312
     </span>
     <span class="comment">
      // H[k:k+3, r:] = P * H[k:k+3, r:], r = max(q, k - 1) (non-coalesced)
     </span>
    </div>
    <div class="line">
     <a name="l01313">
     </a>
     <span class="lineno">
      1313
     </span>
     {
    </div>
    <div class="line">
     <a name="l01314">
     </a>
     <span class="lineno">
      1314
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="group__Max.html#ga965c72198e8e95ce122e1ecf6b5ebe98">
      maxPrim
     </a>
     (q,
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) + threadIdx.x;
    </div>
    <div class="line">
     <a name="l01315">
     </a>
     <span class="lineno">
      1315
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01316">
     </a>
     <span class="lineno">
      1316
     </span>
     T h0 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01317">
     </a>
     <span class="lineno">
      1317
     </span>
     T h1 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1];
    </div>
    <div class="line">
     <a name="l01318">
     </a>
     <span class="lineno">
      1318
     </span>
     T h2 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 2];
    </div>
    <div class="line">
     <a name="l01319">
     </a>
     <span class="lineno">
      1319
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] = h0 * P[0] + h1 * P[1] + h2 * P[2];
    </div>
    <div class="line">
     <a name="l01320">
     </a>
     <span class="lineno">
      1320
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1] = h0 * P[1] + h1 * P[3] + h2 * P[4];
    </div>
    <div class="line">
     <a name="l01321">
     </a>
     <span class="lineno">
      1321
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 2] = h0 * P[2] + h1 * P[4] + h2 * P[5];
    </div>
    <div class="line">
     <a name="l01322">
     </a>
     <span class="lineno">
      1322
     </span>
     }
    </div>
    <div class="line">
     <a name="l01323">
     </a>
     <span class="lineno">
      1323
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01324">
     </a>
     <span class="lineno">
      1324
     </span>
     }
    </div>
    <div class="line">
     <a name="l01325">
     </a>
     <span class="lineno">
      1325
     </span>
    </div>
    <div class="line">
     <a name="l01326">
     </a>
     <span class="lineno">
      1326
     </span>
     <span class="comment">
      // H[:r, k:k+3] = H[:r, k:k+3] * P, r = min(k + 4, p) (coalesced)
     </span>
    </div>
    <div class="line">
     <a name="l01327">
     </a>
     <span class="lineno">
      1327
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     &amp;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
    </div>
    <div class="line">
     <a name="l01328">
     </a>
     <span class="lineno">
      1328
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt; min(
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 4, p)) {
    </div>
    <div class="line">
     <a name="l01329">
     </a>
     <span class="lineno">
      1329
     </span>
     T h0 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01330">
     </a>
     <span class="lineno">
      1330
     </span>
     T h1 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01331">
     </a>
     <span class="lineno">
      1331
     </span>
     T h2 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01332">
     </a>
     <span class="lineno">
      1332
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ] = h0 * P[0] + h1 * P[1] + h2 * P[2];
    </div>
    <div class="line">
     <a name="l01333">
     </a>
     <span class="lineno">
      1333
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ] = h0 * P[1] + h1 * P[3] + h2 * P[4];
    </div>
    <div class="line">
     <a name="l01334">
     </a>
     <span class="lineno">
      1334
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ] = h0 * P[2] + h1 * P[4] + h2 * P[5];
    </div>
    <div class="line">
     <a name="l01335">
     </a>
     <span class="lineno">
      1335
     </span>
     }
    </div>
    <div class="line">
     <a name="l01336">
     </a>
     <span class="lineno">
      1336
     </span>
    </div>
    <div class="line">
     <a name="l01337">
     </a>
     <span class="lineno">
      1337
     </span>
     <span class="comment">
      // U[:, k:k+3] = U[:, k:k+3] * P (coalesced)
     </span>
    </div>
    <div class="line">
     <a name="l01338">
     </a>
     <span class="lineno">
      1338
     </span>
     {
    </div>
    <div class="line">
     <a name="l01339">
     </a>
     <span class="lineno">
      1339
     </span>
     T u0 = b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01340">
     </a>
     <span class="lineno">
      1340
     </span>
     T u1 = b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01341">
     </a>
     <span class="lineno">
      1341
     </span>
     T u2 = b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01342">
     </a>
     <span class="lineno">
      1342
     </span>
     b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ] = u0 * P[0] + u1 * P[1] + u2 * P[2];
    </div>
    <div class="line">
     <a name="l01343">
     </a>
     <span class="lineno">
      1343
     </span>
     b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ] = u0 * P[1] + u1 * P[3] + u2 * P[4];
    </div>
    <div class="line">
     <a name="l01344">
     </a>
     <span class="lineno">
      1344
     </span>
     b_U[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     + (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ] = u0 * P[2] + u1 * P[4] + u2 * P[5];
    </div>
    <div class="line">
     <a name="l01345">
     </a>
     <span class="lineno">
      1345
     </span>
     }
    </div>
    <div class="line">
     <a name="l01346">
     </a>
     <span class="lineno">
      1346
     </span>
    </div>
    <div class="line">
     <a name="l01347">
     </a>
     <span class="lineno">
      1347
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01348">
     </a>
     <span class="lineno">
      1348
     </span>
     v[0] = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1];
    </div>
    <div class="line">
     <a name="l01349">
     </a>
     <span class="lineno">
      1349
     </span>
     v[1] = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 2];
    </div>
    <div class="line">
     <a name="l01350">
     </a>
     <span class="lineno">
      1350
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &lt; p - 3) v[2] = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 3];
    </div>
    <div class="line">
     <a name="l01351">
     </a>
     <span class="lineno">
      1351
     </span>
     }
    </div>
    <div class="line">
     <a name="l01352">
     </a>
     <span class="lineno">
      1352
     </span>
    </div>
    <div class="line">
     <a name="l01353">
     </a>
     <span class="lineno">
      1353
     </span>
     {
    </div>
    <div class="line">
     <a name="l01354">
     </a>
     <span class="lineno">
      1354
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01355">
     </a>
     <span class="lineno">
      1355
     </span>
    </div>
    <div class="line">
     <a name="l01356">
     </a>
     <span class="lineno">
      1356
     </span>
     <span class="comment">
      // Generate a Givens rotation such that P * v[0:2] = a e1
     </span>
    </div>
    <div class="line">
     <a name="l01357">
     </a>
     <span class="lineno">
      1357
     </span>
     T c, s;
    </div>
    <div class="line">
     <a name="l01358">
     </a>
     <span class="lineno">
      1358
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a6e3278fec6e37f36229277c91db26c4a">
      generate_givens
     </a>
     (v[0], v[1], c, s);
    </div>
    <div class="line">
     <a name="l01359">
     </a>
     <span class="lineno">
      1359
     </span>
     <span class="comment">
      // H[p-2:p, p-3:] = P * H[p-2:p, p-3:]
     </span>
    </div>
    <div class="line">
     <a name="l01360">
     </a>
     <span class="lineno">
      1360
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     = p - 3 + threadIdx.x;
    </div>
    <div class="line">
     <a name="l01361">
     </a>
     <span class="lineno">
      1361
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01362">
     </a>
     <span class="lineno">
      1362
     </span>
     T h0 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 2];
    </div>
    <div class="line">
     <a name="l01363">
     </a>
     <span class="lineno">
      1363
     </span>
     T h1 = b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 1];
    </div>
    <div class="line">
     <a name="l01364">
     </a>
     <span class="lineno">
      1364
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 2] = h0 * c - h1 * s;
    </div>
    <div class="line">
     <a name="l01365">
     </a>
     <span class="lineno">
      1365
     </span>
     b_H[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p - 1] = h0 * s + h1 * c;
    </div>
    <div class="line">
     <a name="l01366">
     </a>
     <span class="lineno">
      1366
     </span>
     }
    </div>
    <div class="line">
     <a name="l01367">
     </a>
     <span class="lineno">
      1367
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01368">
     </a>
     <span class="lineno">
      1368
     </span>
     <span class="comment">
      // H[:p, p-2:p] = H[:p, p-2:p] * P'
     </span>
    </div>
    <div class="line">
     <a name="l01369">
     </a>
     <span class="lineno">
      1369
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     &amp;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
    </div>
    <div class="line">
     <a name="l01370">
     </a>
     <span class="lineno">
      1370
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt; p) {
    </div>
    <div class="line">
     <a name="l01371">
     </a>
     <span class="lineno">
      1371
     </span>
     T h0 = b_H[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01372">
     </a>
     <span class="lineno">
      1372
     </span>
     T h1 = b_H[(p - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01373">
     </a>
     <span class="lineno">
      1373
     </span>
     b_H[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = h0 * c - h1 * s;
    </div>
    <div class="line">
     <a name="l01374">
     </a>
     <span class="lineno">
      1374
     </span>
     b_H[(p - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = h0 * s + h1 * c;
    </div>
    <div class="line">
     <a name="l01375">
     </a>
     <span class="lineno">
      1375
     </span>
     }
    </div>
    <div class="line">
     <a name="l01376">
     </a>
     <span class="lineno">
      1376
     </span>
     <span class="comment">
      // U[:, p-2:p] = U[:, p-2:p] * P'
     </span>
    </div>
    <div class="line">
     <a name="l01377">
     </a>
     <span class="lineno">
      1377
     </span>
     {
    </div>
    <div class="line">
     <a name="l01378">
     </a>
     <span class="lineno">
      1378
     </span>
     T u0 = b_U[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01379">
     </a>
     <span class="lineno">
      1379
     </span>
     T u1 = b_U[(p - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01380">
     </a>
     <span class="lineno">
      1380
     </span>
     b_U[(p - 2) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = u0 * c - u1 * s;
    </div>
    <div class="line">
     <a name="l01381">
     </a>
     <span class="lineno">
      1381
     </span>
     b_U[(p - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = u0 * s + u1 * c;
    </div>
    <div class="line">
     <a name="l01382">
     </a>
     <span class="lineno">
      1382
     </span>
     }
    </div>
    <div class="line">
     <a name="l01383">
     </a>
     <span class="lineno">
      1383
     </span>
     }
    </div>
    <div class="line">
     <a name="l01384">
     </a>
     <span class="lineno">
      1384
     </span>
     }
    </div>
    <div class="line">
     <a name="l01385">
     </a>
     <span class="lineno">
      1385
     </span>
     }
    </div>
    <div class="line">
     <a name="l01386">
     </a>
     <span class="lineno">
      1386
     </span>
     }
    </div>
    <div class="line">
     <a name="l01387">
     </a>
     <span class="lineno">
      1387
     </span>
    </div>
    <div class="line">
     <a name="l01397">
     </a>
     <span class="lineno">
      1397
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01398">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42e39921da00184c1012556e48a14469">
       1398
      </a>
     </span>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42e39921da00184c1012556e48a14469">
      b_schur
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; U,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; S,
    </div>
    <div class="line">
     <a name="l01399">
     </a>
     <span class="lineno">
      1399
     </span>
     <span class="keywordtype">
      int
     </span>
     max_iter_per_step = 20) {
    </div>
    <div class="line">
     <a name="l01400">
     </a>
     <span class="lineno">
      1400
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l01401">
     </a>
     <span class="lineno">
      1401
     </span>
     <span class="keywordtype">
      int
     </span>
     batch_size = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01402">
     </a>
     <span class="lineno">
      1402
     </span>
     <span class="keyword">
      auto
     </span>
     stream = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01403">
     </a>
     <span class="lineno">
      1403
     </span>
    </div>
    <div class="line">
     <a name="l01404">
     </a>
     <span class="lineno">
      1404
     </span>
     <span class="comment">
      // Start with a Hessenberg decomposition
     </span>
    </div>
    <div class="line">
     <a name="l01405">
     </a>
     <span class="lineno">
      1405
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a9c7ba116918e57a952e2ff9069a975ac">
      b_hessenberg
     </a>
     (A, U, S);
    </div>
    <div class="line">
     <a name="l01406">
     </a>
     <span class="lineno">
      1406
     </span>
    </div>
    <div class="line">
     <a name="l01407">
     </a>
     <span class="lineno">
      1407
     </span>
     <span class="comment">
      // Use the Francis QR algorithm to complete to a real Schur decomposition
     </span>
    </div>
    <div class="line">
     <a name="l01408">
     </a>
     <span class="lineno">
      1408
     </span>
     francis_qr_algorithm_kernel&lt;&lt;&lt;batch_size, n, 0, stream&gt;&gt;&gt;(U.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
    </div>
    <div class="line">
     <a name="l01409">
     </a>
     <span class="lineno">
      1409
     </span>
     S.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     );
    </div>
    <div class="line">
     <a name="l01410">
     </a>
     <span class="lineno">
      1410
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l01411">
     </a>
     <span class="lineno">
      1411
     </span>
     }
    </div>
    <div class="line">
     <a name="l01412">
     </a>
     <span class="lineno">
      1412
     </span>
    </div>
    <div class="line">
     <a name="l01426">
     </a>
     <span class="lineno">
      1426
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keywordtype">
      int
     </span>
     p,
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01427">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a98196da0c61d18aa74e58928d9262a1d">
       1427
      </a>
     </span>
     <a class="code" href="cuda__utils_8h.html#acabe1ee3d11be6214c678bf4dabda3c9">
      DI
     </a>
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a98196da0c61d18aa74e58928d9262a1d">
      quasi_triangular_solver
     </a>
     (T* d_scratch, T* d_x,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , T* shared_mem) {
    </div>
    <div class="line">
     <a name="l01428">
     </a>
     <span class="lineno">
      1428
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01429">
     </a>
     <span class="lineno">
      1429
     </span>
     <span class="comment">
      // Reduce the system to upper triangular with Givens rotations
     </span>
    </div>
    <div class="line">
     <a name="l01430">
     </a>
     <span class="lineno">
      1430
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01431">
     </a>
     <span class="lineno">
      1431
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01432">
     </a>
     <span class="lineno">
      1432
     </span>
     T c, s;
    </div>
    <div class="line">
     <a name="l01433">
     </a>
     <span class="lineno">
      1433
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a6e3278fec6e37f36229277c91db26c4a">
      generate_givens
     </a>
     (d_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ], d_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1], c, s);
    </div>
    <div class="line">
     <a name="l01434">
     </a>
     <span class="lineno">
      1434
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01435">
     </a>
     <span class="lineno">
      1435
     </span>
    </div>
    <div class="line">
     <a name="l01436">
     </a>
     <span class="lineno">
      1436
     </span>
     <span class="comment">
      // scratch[k:k+2, k:] = P * scratch[k:k+2, k:]
     </span>
    </div>
    <div class="line">
     <a name="l01437">
     </a>
     <span class="lineno">
      1437
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + threadIdx.x;
    </div>
    <div class="line">
     <a name="l01438">
     </a>
     <span class="lineno">
      1438
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + p) {
    </div>
    <div class="line">
     <a name="l01439">
     </a>
     <span class="lineno">
      1439
     </span>
     T h0 = d_scratch[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01440">
     </a>
     <span class="lineno">
      1440
     </span>
     T h1 = d_scratch[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1];
    </div>
    <div class="line">
     <a name="l01441">
     </a>
     <span class="lineno">
      1441
     </span>
     d_scratch[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] = h0 * c - h1 * s;
    </div>
    <div class="line">
     <a name="l01442">
     </a>
     <span class="lineno">
      1442
     </span>
     d_scratch[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1] = h0 * s + h1 * c;
    </div>
    <div class="line">
     <a name="l01443">
     </a>
     <span class="lineno">
      1443
     </span>
     }
    </div>
    <div class="line">
     <a name="l01444">
     </a>
     <span class="lineno">
      1444
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01445">
     </a>
     <span class="lineno">
      1445
     </span>
     }
    </div>
    <div class="line">
     <a name="l01446">
     </a>
     <span class="lineno">
      1446
     </span>
    </div>
    <div class="line">
     <a name="l01447">
     </a>
     <span class="lineno">
      1447
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01448">
     </a>
     <span class="lineno">
      1448
     </span>
     <span class="comment">
      // Solve the upper triangular system with back substitution
     </span>
    </div>
    <div class="line">
     <a name="l01449">
     </a>
     <span class="lineno">
      1449
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01450">
     </a>
     <span class="lineno">
      1450
     </span>
    </div>
    <div class="line">
     <a name="l01451">
     </a>
     <span class="lineno">
      1451
     </span>
     <span class="comment">
      // The shared mem is used to reduce: sum W[k,i]*x[i,:], i from k+1 to n-1
     </span>
    </div>
    <div class="line">
     <a name="l01452">
     </a>
     <span class="lineno">
      1452
     </span>
     <span class="comment">
      // at each step k from n-1 to 0.
     </span>
    </div>
    <div class="line">
     <a name="l01453">
     </a>
     <span class="lineno">
      1453
     </span>
     <span class="comment">
      // Layout:
     </span>
    </div>
    <div class="line">
     <a name="l01454">
     </a>
     <span class="lineno">
      1454
     </span>
     <span class="comment">
      //  ___
     </span>
    </div>
    <div class="line">
     <a name="l01455">
     </a>
     <span class="lineno">
      1455
     </span>
     <span class="comment">
      // |   | n-k-1   (for the reduction)
     </span>
    </div>
    <div class="line">
     <a name="l01456">
     </a>
     <span class="lineno">
      1456
     </span>
     <span class="comment">
      // |___|
     </span>
    </div>
    <div class="line">
     <a name="l01457">
     </a>
     <span class="lineno">
      1457
     </span>
     <span class="comment">
      // |   |   k     (unused)
     </span>
    </div>
    <div class="line">
     <a name="l01458">
     </a>
     <span class="lineno">
      1458
     </span>
     <span class="comment">
      // |___|
     </span>
    </div>
    <div class="line">
     <a name="l01459">
     </a>
     <span class="lineno">
      1459
     </span>
     <span class="comment">
      //   p
     </span>
    </div>
    <div class="line">
     <a name="l01460">
     </a>
     <span class="lineno">
      1460
     </span>
    </div>
    <div class="line">
     <a name="l01461">
     </a>
     <span class="lineno">
      1461
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &gt;= 0;
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     --) {
    </div>
    <div class="line">
     <a name="l01462">
     </a>
     <span class="lineno">
      1462
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1 + threadIdx.x;
    </div>
    <div class="line">
     <a name="l01463">
     </a>
     <span class="lineno">
      1463
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01464">
     </a>
     <span class="lineno">
      1464
     </span>
     T s_ki = d_scratch[
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01465">
     </a>
     <span class="lineno">
      1465
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt; p;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01466">
     </a>
     <span class="lineno">
      1466
     </span>
     shared_mem[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1) + threadIdx.x] = s_ki * d_x[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01467">
     </a>
     <span class="lineno">
      1467
     </span>
     }
    </div>
    <div class="line">
     <a name="l01468">
     </a>
     <span class="lineno">
      1468
     </span>
     }
    </div>
    <div class="line">
     <a name="l01469">
     </a>
     <span class="lineno">
      1469
     </span>
     <span class="comment">
      // Tree reduction
     </span>
    </div>
    <div class="line">
     <a name="l01470">
     </a>
     <span class="lineno">
      1470
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     red_size =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     -
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1; red_size &gt; 1;
    </div>
    <div class="line">
     <a name="l01471">
     </a>
     <span class="lineno">
      1471
     </span>
     red_size = (red_size + 1) / 2) {
    </div>
    <div class="line">
     <a name="l01472">
     </a>
     <span class="lineno">
      1472
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01473">
     </a>
     <span class="lineno">
      1473
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt; red_size / 2) {
    </div>
    <div class="line">
     <a name="l01474">
     </a>
     <span class="lineno">
      1474
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt; p;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01475">
     </a>
     <span class="lineno">
      1475
     </span>
     shared_mem[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1) + threadIdx.x] +=
    </div>
    <div class="line">
     <a name="l01476">
     </a>
     <span class="lineno">
      1476
     </span>
     shared_mem[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1) + threadIdx.x + (red_size + 1) / 2];
    </div>
    <div class="line">
     <a name="l01477">
     </a>
     <span class="lineno">
      1477
     </span>
     }
    </div>
    <div class="line">
     <a name="l01478">
     </a>
     <span class="lineno">
      1478
     </span>
     }
    </div>
    <div class="line">
     <a name="l01479">
     </a>
     <span class="lineno">
      1479
     </span>
     }
    </div>
    <div class="line">
     <a name="l01480">
     </a>
     <span class="lineno">
      1480
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01481">
     </a>
     <span class="lineno">
      1481
     </span>
    </div>
    <div class="line">
     <a name="l01482">
     </a>
     <span class="lineno">
      1482
     </span>
     <span class="comment">
      // Finalize
     </span>
    </div>
    <div class="line">
     <a name="l01483">
     </a>
     <span class="lineno">
      1483
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt; p) {
    </div>
    <div class="line">
     <a name="l01484">
     </a>
     <span class="lineno">
      1484
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     &amp;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     = threadIdx.x;
    </div>
    <div class="line">
     <a name="l01485">
     </a>
     <span class="lineno">
      1485
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ==
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1) {
    </div>
    <div class="line">
     <a name="l01486">
     </a>
     <span class="lineno">
      1486
     </span>
     d_x[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] = d_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] / d_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01487">
     </a>
     <span class="lineno">
      1487
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     {
    </div>
    <div class="line">
     <a name="l01488">
     </a>
     <span class="lineno">
      1488
     </span>
     d_x[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] =
    </div>
    <div class="line">
     <a name="l01489">
     </a>
     <span class="lineno">
      1489
     </span>
     (d_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ] - shared_mem[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1)]) /
    </div>
    <div class="line">
     <a name="l01490">
     </a>
     <span class="lineno">
      1490
     </span>
     d_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01491">
     </a>
     <span class="lineno">
      1491
     </span>
     }
    </div>
    <div class="line">
     <a name="l01492">
     </a>
     <span class="lineno">
      1492
     </span>
     }
    </div>
    <div class="line">
     <a name="l01493">
     </a>
     <span class="lineno">
      1493
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01494">
     </a>
     <span class="lineno">
      1494
     </span>
     }
    </div>
    <div class="line">
     <a name="l01495">
     </a>
     <span class="lineno">
      1495
     </span>
     }
    </div>
    <div class="line">
     <a name="l01496">
     </a>
     <span class="lineno">
      1496
     </span>
    </div>
    <div class="line">
     <a name="l01511">
     </a>
     <span class="lineno">
      1511
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01512">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#af703894eff918b820989f4e1c12f5e93">
       1512
      </a>
     </span>
     __global__
     <span class="keywordtype">
      void
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#af703894eff918b820989f4e1c12f5e93">
      trsyl_kernel
     </a>
     (
     <span class="keyword">
      const
     </span>
     T* d_R,
     <span class="keyword">
      const
     </span>
     T* d_R2,
     <span class="keyword">
      const
     </span>
     T* d_S,
    </div>
    <div class="line">
     <a name="l01513">
     </a>
     <span class="lineno">
      1513
     </span>
     <span class="keyword">
      const
     </span>
     T* d_F, T* d_Y, T* d_scratch,
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01514">
     </a>
     <span class="lineno">
      1514
     </span>
     <span class="keywordtype">
      int
     </span>
     ib = blockIdx.x;
    </div>
    <div class="line">
     <a name="l01515">
     </a>
     <span class="lineno">
      1515
     </span>
     <span class="keywordtype">
      int
     </span>
     n2 =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01516">
     </a>
     <span class="lineno">
      1516
     </span>
     constexpr T near_zero = std::is_same&lt;T, double&gt;::value ? 1e-14 : 1e-8
     <a class="code" href="namespaceUMAPAlgo_1_1Optimize.html#ad1d8470650aa6ea82693fdf61479e708">
      f
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01517">
     </a>
     <span class="lineno">
      1517
     </span>
    </div>
    <div class="line">
     <a name="l01518">
     </a>
     <span class="lineno">
      1518
     </span>
     <span class="comment">
      // The algorithm iteratively solves for the columns of Y with a kind of
     </span>
    </div>
    <div class="line">
     <a name="l01519">
     </a>
     <span class="lineno">
      1519
     </span>
     <span class="comment">
      // back substitution (as the matrices R and S are in real Schur form).
     </span>
    </div>
    <div class="line">
     <a name="l01520">
     </a>
     <span class="lineno">
      1520
     </span>
     <span class="comment">
      // Depending whether the values of the superdiagonal of S are zero or not,
     </span>
    </div>
    <div class="line">
     <a name="l01521">
     </a>
     <span class="lineno">
      1521
     </span>
     <span class="comment">
      // it solves one or two columns at a time. In both cases, it writes a
     </span>
    </div>
    <div class="line">
     <a name="l01522">
     </a>
     <span class="lineno">
      1522
     </span>
     <span class="comment">
      // a system in the scratch buffer and solves it with quasi_triangular_solver
     </span>
    </div>
    <div class="line">
     <a name="l01523">
     </a>
     <span class="lineno">
      1523
     </span>
    </div>
    <div class="line">
     <a name="l01524">
     </a>
     <span class="lineno">
      1524
     </span>
     <span class="comment">
      // The scratch buffer is organized as follows:
     </span>
    </div>
    <div class="line">
     <a name="l01525">
     </a>
     <span class="lineno">
      1525
     </span>
     <span class="comment">
      //    __________
     </span>
    </div>
    <div class="line">
     <a name="l01526">
     </a>
     <span class="lineno">
      1526
     </span>
     <span class="comment">
      //   |      |   |
     </span>
    </div>
    <div class="line">
     <a name="l01527">
     </a>
     <span class="lineno">
      1527
     </span>
     <span class="comment">
      //   |  A   | b |
     </span>
    </div>
    <div class="line">
     <a name="l01528">
     </a>
     <span class="lineno">
      1528
     </span>
     <span class="comment">
      //   |______|___|
     </span>
    </div>
    <div class="line">
     <a name="l01529">
     </a>
     <span class="lineno">
      1529
     </span>
     <span class="comment">
      //      n    1|2
     </span>
    </div>
    <div class="line">
     <a name="l01530">
     </a>
     <span class="lineno">
      1530
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01531">
     </a>
     <span class="lineno">
      1531
     </span>
     <span class="comment">
      // Where A and b are the matrices of the system to solve (one column for
     </span>
    </div>
    <div class="line">
     <a name="l01532">
     </a>
     <span class="lineno">
      1532
     </span>
     <span class="comment">
      // a single step, two columns for a double step)
     </span>
    </div>
    <div class="line">
     <a name="l01533">
     </a>
     <span class="lineno">
      1533
     </span>
     <span class="comment">
      // The quasi-triangular solver works in-place (overwrites A and b)
     </span>
    </div>
    <div class="line">
     <a name="l01534">
     </a>
     <span class="lineno">
      1534
     </span>
    </div>
    <div class="line">
     <a name="l01535">
     </a>
     <span class="lineno">
      1535
     </span>
     <span class="comment">
      // Shared memory (note: neutral type to prevent incompatible definition
     </span>
    </div>
    <div class="line">
     <a name="l01536">
     </a>
     <span class="lineno">
      1536
     </span>
     <span class="comment">
      //                      if using template argument T)
     </span>
    </div>
    <div class="line">
     <a name="l01537">
     </a>
     <span class="lineno">
      1537
     </span>
     <span class="keyword">
      extern
     </span>
     __shared__ int8_t shared_mem_trsyl[];
    </div>
    <div class="line">
     <a name="l01538">
     </a>
     <span class="lineno">
      1538
     </span>
     T* shared_mem = (T*)shared_mem_trsyl;
    </div>
    <div class="line">
     <a name="l01539">
     </a>
     <span class="lineno">
      1539
     </span>
    </div>
    <div class="line">
     <a name="l01540">
     </a>
     <span class="lineno">
      1540
     </span>
     <span class="keyword">
      const
     </span>
     T* b_R = d_R + n2 * ib;
    </div>
    <div class="line">
     <a name="l01541">
     </a>
     <span class="lineno">
      1541
     </span>
     <span class="keyword">
      const
     </span>
     T* b_R2 = d_R2 + n2 * ib;
    </div>
    <div class="line">
     <a name="l01542">
     </a>
     <span class="lineno">
      1542
     </span>
     <span class="keyword">
      const
     </span>
     T* b_S = d_S + n2 * ib;
    </div>
    <div class="line">
     <a name="l01543">
     </a>
     <span class="lineno">
      1543
     </span>
     <span class="keyword">
      const
     </span>
     T* b_F = d_F + n2 * ib;
    </div>
    <div class="line">
     <a name="l01544">
     </a>
     <span class="lineno">
      1544
     </span>
     T* b_Y = d_Y + n2 * ib;
    </div>
    <div class="line">
     <a name="l01545">
     </a>
     <span class="lineno">
      1545
     </span>
     T* b_scratch = d_scratch +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 2) * ib;
    </div>
    <div class="line">
     <a name="l01546">
     </a>
     <span class="lineno">
      1546
     </span>
    </div>
    <div class="line">
     <a name="l01547">
     </a>
     <span class="lineno">
      1547
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1;
    </div>
    <div class="line">
     <a name="l01548">
     </a>
     <span class="lineno">
      1548
     </span>
    </div>
    <div class="line">
     <a name="l01549">
     </a>
     <span class="lineno">
      1549
     </span>
     <span class="keywordflow">
      while
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     &gt;= 0) {
    </div>
    <div class="line">
     <a name="l01550">
     </a>
     <span class="lineno">
      1550
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     == 0 ||
    </div>
    <div class="line">
     <a name="l01551">
     </a>
     <span class="lineno">
      1551
     </span>
     abs(d_S[n2 * ib +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1]) &lt; near_zero) {
     <span class="comment">
      // single step
     </span>
    </div>
    <div class="line">
     <a name="l01552">
     </a>
     <span class="lineno">
      1552
     </span>
     <span class="comment">
      // Write A = R + S[k, k] * In on the left side of the scratch
     </span>
    </div>
    <div class="line">
     <a name="l01553">
     </a>
     <span class="lineno">
      1553
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     idx = threadIdx.x; idx &lt; n2; idx += blockDim.x) {
    </div>
    <div class="line">
     <a name="l01554">
     </a>
     <span class="lineno">
      1554
     </span>
     b_scratch[idx] = b_R[idx];
    </div>
    <div class="line">
     <a name="l01555">
     </a>
     <span class="lineno">
      1555
     </span>
     }
    </div>
    <div class="line">
     <a name="l01556">
     </a>
     <span class="lineno">
      1556
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01557">
     </a>
     <span class="lineno">
      1557
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01558">
     </a>
     <span class="lineno">
      1558
     </span>
     b_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) * threadIdx.x] += b_S[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01559">
     </a>
     <span class="lineno">
      1559
     </span>
     }
    </div>
    <div class="line">
     <a name="l01560">
     </a>
     <span class="lineno">
      1560
     </span>
    </div>
    <div class="line">
     <a name="l01561">
     </a>
     <span class="lineno">
      1561
     </span>
     <span class="comment">
      // Write b = F[:, k] - Y[:, k+1:] * S[k+1:, k] on the right side
     </span>
    </div>
    <div class="line">
     <a name="l01562">
     </a>
     <span class="lineno">
      1562
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01563">
     </a>
     <span class="lineno">
      1563
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     &amp;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
    </div>
    <div class="line">
     <a name="l01564">
     </a>
     <span class="lineno">
      1564
     </span>
     T acc = (T)0;
    </div>
    <div class="line">
     <a name="l01565">
     </a>
     <span class="lineno">
      1565
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01566">
     </a>
     <span class="lineno">
      1566
     </span>
     acc += b_Y[
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] * b_S[
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01567">
     </a>
     <span class="lineno">
      1567
     </span>
     }
    </div>
    <div class="line">
     <a name="l01568">
     </a>
     <span class="lineno">
      1568
     </span>
     b_scratch[n2 +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = b_F[
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] - acc;
    </div>
    <div class="line">
     <a name="l01569">
     </a>
     <span class="lineno">
      1569
     </span>
     }
    </div>
    <div class="line">
     <a name="l01570">
     </a>
     <span class="lineno">
      1570
     </span>
    </div>
    <div class="line">
     <a name="l01571">
     </a>
     <span class="lineno">
      1571
     </span>
     <span class="comment">
      // Solve on the k-th column of Y
     </span>
    </div>
    <div class="line">
     <a name="l01572">
     </a>
     <span class="lineno">
      1572
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01573">
     </a>
     <span class="lineno">
      1573
     </span>
     quasi_triangular_solver&lt;1&gt;(b_scratch, b_Y +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , shared_mem);
    </div>
    <div class="line">
     <a name="l01574">
     </a>
     <span class="lineno">
      1574
     </span>
    </div>
    <div class="line">
     <a name="l01575">
     </a>
     <span class="lineno">
      1575
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     --;
    </div>
    <div class="line">
     <a name="l01576">
     </a>
     <span class="lineno">
      1576
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     {
     <span class="comment">
      // double step
     </span>
    </div>
    <div class="line">
     <a name="l01577">
     </a>
     <span class="lineno">
      1577
     </span>
     T s00 = b_S[(
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1];
    </div>
    <div class="line">
     <a name="l01578">
     </a>
     <span class="lineno">
      1578
     </span>
     T s10 = b_S[(
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01579">
     </a>
     <span class="lineno">
      1579
     </span>
     T s01 = b_S[
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1];
    </div>
    <div class="line">
     <a name="l01580">
     </a>
     <span class="lineno">
      1580
     </span>
     T s11 = b_S[
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01581">
     </a>
     <span class="lineno">
      1581
     </span>
    </div>
    <div class="line">
     <a name="l01582">
     </a>
     <span class="lineno">
      1582
     </span>
     <span class="comment">
      // Write R2 + (s00+s11)*R + (s00*s11-s01*s10)*In on the left side of the
     </span>
    </div>
    <div class="line">
     <a name="l01583">
     </a>
     <span class="lineno">
      1583
     </span>
     <span class="comment">
      // scratch
     </span>
    </div>
    <div class="line">
     <a name="l01584">
     </a>
     <span class="lineno">
      1584
     </span>
     {
    </div>
    <div class="line">
     <a name="l01585">
     </a>
     <span class="lineno">
      1585
     </span>
     T a = s00 + s11;
    </div>
    <div class="line">
     <a name="l01586">
     </a>
     <span class="lineno">
      1586
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     idx = threadIdx.x; idx &lt; n2; idx += blockDim.x) {
    </div>
    <div class="line">
     <a name="l01587">
     </a>
     <span class="lineno">
      1587
     </span>
     b_scratch[idx] = b_R2[idx] + a * b_R[idx];
    </div>
    <div class="line">
     <a name="l01588">
     </a>
     <span class="lineno">
      1588
     </span>
     }
    </div>
    <div class="line">
     <a name="l01589">
     </a>
     <span class="lineno">
      1589
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01590">
     </a>
     <span class="lineno">
      1590
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01591">
     </a>
     <span class="lineno">
      1591
     </span>
     b_scratch[(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1) * threadIdx.x] += s00 * s11 - s01 * s10;
    </div>
    <div class="line">
     <a name="l01592">
     </a>
     <span class="lineno">
      1592
     </span>
     }
    </div>
    <div class="line">
     <a name="l01593">
     </a>
     <span class="lineno">
      1593
     </span>
     }
    </div>
    <div class="line">
     <a name="l01594">
     </a>
     <span class="lineno">
      1594
     </span>
    </div>
    <div class="line">
     <a name="l01595">
     </a>
     <span class="lineno">
      1595
     </span>
     <span class="comment">
      // Temporary write b = F[:, k-1:k+1] - Y[:, k+1:] * S[k+1:, k-1:k+1] in the
     </span>
    </div>
    <div class="line">
     <a name="l01596">
     </a>
     <span class="lineno">
      1596
     </span>
     <span class="comment">
      // right part of the scratch
     </span>
    </div>
    <div class="line">
     <a name="l01597">
     </a>
     <span class="lineno">
      1597
     </span>
     {
    </div>
    <div class="line">
     <a name="l01598">
     </a>
     <span class="lineno">
      1598
     </span>
     <span class="keyword">
      const
     </span>
     <span class="keywordtype">
      int
     </span>
     &amp;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = threadIdx.x;
    </div>
    <div class="line">
     <a name="l01599">
     </a>
     <span class="lineno">
      1599
     </span>
     T b0, b1;
    </div>
    <div class="line">
     <a name="l01600">
     </a>
     <span class="lineno">
      1600
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01601">
     </a>
     <span class="lineno">
      1601
     </span>
     b0 = b_F[(
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01602">
     </a>
     <span class="lineno">
      1602
     </span>
     b1 = b_F[
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01603">
     </a>
     <span class="lineno">
      1603
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     =
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     + 1;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01604">
     </a>
     <span class="lineno">
      1604
     </span>
     T y_ij = b_Y[
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01605">
     </a>
     <span class="lineno">
      1605
     </span>
     b0 -= y_ij * b_S[
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1) +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01606">
     </a>
     <span class="lineno">
      1606
     </span>
     b1 -= y_ij * b_S[
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01607">
     </a>
     <span class="lineno">
      1607
     </span>
     }
    </div>
    <div class="line">
     <a name="l01608">
     </a>
     <span class="lineno">
      1608
     </span>
     b_scratch[n2 +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = b0;
    </div>
    <div class="line">
     <a name="l01609">
     </a>
     <span class="lineno">
      1609
     </span>
     b_scratch[n2 +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = b1;
    </div>
    <div class="line">
     <a name="l01610">
     </a>
     <span class="lineno">
      1610
     </span>
     }
    </div>
    <div class="line">
     <a name="l01611">
     </a>
     <span class="lineno">
      1611
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01612">
     </a>
     <span class="lineno">
      1612
     </span>
     <span class="comment">
      // Compute c = R*b in registers
     </span>
    </div>
    <div class="line">
     <a name="l01613">
     </a>
     <span class="lineno">
      1613
     </span>
     T c0 = 0;
    </div>
    <div class="line">
     <a name="l01614">
     </a>
     <span class="lineno">
      1614
     </span>
     T c1 = 0;
    </div>
    <div class="line">
     <a name="l01615">
     </a>
     <span class="lineno">
      1615
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01616">
     </a>
     <span class="lineno">
      1616
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01617">
     </a>
     <span class="lineno">
      1617
     </span>
     T r_ij = b_R[
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01618">
     </a>
     <span class="lineno">
      1618
     </span>
     c0 += r_ij * b_scratch[n2 +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01619">
     </a>
     <span class="lineno">
      1619
     </span>
     c1 += r_ij * b_scratch[n2 +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
      j
     </a>
     ];
    </div>
    <div class="line">
     <a name="l01620">
     </a>
     <span class="lineno">
      1620
     </span>
     }
    </div>
    <div class="line">
     <a name="l01621">
     </a>
     <span class="lineno">
      1621
     </span>
     }
    </div>
    <div class="line">
     <a name="l01622">
     </a>
     <span class="lineno">
      1622
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01623">
     </a>
     <span class="lineno">
      1623
     </span>
     <span class="comment">
      // Overwrite the right side of the scratch with the following two columns:
     </span>
    </div>
    <div class="line">
     <a name="l01624">
     </a>
     <span class="lineno">
      1624
     </span>
     <span class="comment">
      // b = c[:,0] + s11*b[:,0] - s10*b[:,1] | c[:,1] + s00*b[:,1] - s01*b[:,0]
     </span>
    </div>
    <div class="line">
     <a name="l01625">
     </a>
     <span class="lineno">
      1625
     </span>
     <span class="keywordflow">
      if
     </span>
     (threadIdx.x &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ) {
    </div>
    <div class="line">
     <a name="l01626">
     </a>
     <span class="lineno">
      1626
     </span>
     b_scratch[n2 +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = c0 + s11 * b0 - s10 * b1;
    </div>
    <div class="line">
     <a name="l01627">
     </a>
     <span class="lineno">
      1627
     </span>
     b_scratch[n2 +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     +
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] = c1 + s00 * b1 - s01 * b0;
    </div>
    <div class="line">
     <a name="l01628">
     </a>
     <span class="lineno">
      1628
     </span>
     }
    </div>
    <div class="line">
     <a name="l01629">
     </a>
     <span class="lineno">
      1629
     </span>
     }
    </div>
    <div class="line">
     <a name="l01630">
     </a>
     <span class="lineno">
      1630
     </span>
    </div>
    <div class="line">
     <a name="l01631">
     </a>
     <span class="lineno">
      1631
     </span>
     <span class="comment">
      // Solve on the (k-1)-th and k-th columns of Y
     </span>
    </div>
    <div class="line">
     <a name="l01632">
     </a>
     <span class="lineno">
      1632
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
      __syncthreads
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01633">
     </a>
     <span class="lineno">
      1633
     </span>
     quasi_triangular_solver&lt;2&gt;(b_scratch, b_Y +
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     - 1),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , shared_mem);
    </div>
    <div class="line">
     <a name="l01634">
     </a>
     <span class="lineno">
      1634
     </span>
    </div>
    <div class="line">
     <a name="l01635">
     </a>
     <span class="lineno">
      1635
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
      k
     </a>
     -= 2;
    </div>
    <div class="line">
     <a name="l01636">
     </a>
     <span class="lineno">
      1636
     </span>
     }
    </div>
    <div class="line">
     <a name="l01637">
     </a>
     <span class="lineno">
      1637
     </span>
     }
    </div>
    <div class="line">
     <a name="l01638">
     </a>
     <span class="lineno">
      1638
     </span>
     }
    </div>
    <div class="line">
     <a name="l01639">
     </a>
     <span class="lineno">
      1639
     </span>
    </div>
    <div class="line">
     <a name="l01652">
     </a>
     <span class="lineno">
      1652
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01653">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4d5322b33c1018ff6928c2a119e1b79f">
       1653
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4d5322b33c1018ff6928c2a119e1b79f">
      b_trsyl_uplo
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; R,
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; S,
    </div>
    <div class="line">
     <a name="l01654">
     </a>
     <span class="lineno">
      1654
     </span>
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; F) {
    </div>
    <div class="line">
     <a name="l01655">
     </a>
     <span class="lineno">
      1655
     </span>
     <span class="keywordtype">
      int
     </span>
     batch_size = R.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01656">
     </a>
     <span class="lineno">
      1656
     </span>
     <span class="keyword">
      auto
     </span>
     stream = R.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01657">
     </a>
     <span class="lineno">
      1657
     </span>
     <span class="keyword">
      auto
     </span>
     allocator = R.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01658">
     </a>
     <span class="lineno">
      1658
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = R.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l01659">
     </a>
     <span class="lineno">
      1659
     </span>
    </div>
    <div class="line">
     <a name="l01660">
     </a>
     <span class="lineno">
      1660
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     R2 =
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (R, R);
    </div>
    <div class="line">
     <a name="l01661">
     </a>
     <span class="lineno">
      1661
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     Y(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, R.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), allocator, stream,
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l01662">
     </a>
     <span class="lineno">
      1662
     </span>
    </div>
    <div class="line">
     <a name="l01663">
     </a>
     <span class="lineno">
      1663
     </span>
     <span class="comment">
      // Scratch buffer for the solver
     </span>
    </div>
    <div class="line">
     <a name="l01664">
     </a>
     <span class="lineno">
      1664
     </span>
     <a class="code" href="classMLCommon_1_1buffer__base.html">
      device_buffer&lt;T&gt;
     </a>
     scratch_buffer(allocator, stream, batch_size *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 2));
    </div>
    <div class="line">
     <a name="l01665">
     </a>
     <span class="lineno">
      1665
     </span>
     <span class="keywordtype">
      int
     </span>
     shared_mem_size = 2 * (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     - 1) *
     <span class="keyword">
      sizeof
     </span>
     (T);
    </div>
    <div class="line">
     <a name="l01666">
     </a>
     <span class="lineno">
      1666
     </span>
     trsyl_kernel&lt;&lt;&lt;batch_size, n + 2, shared_mem_size, stream&gt;&gt;&gt;(
    </div>
    <div class="line">
     <a name="l01667">
     </a>
     <span class="lineno">
      1667
     </span>
     R.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), R2.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), S.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), F.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (), Y.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     (),
    </div>
    <div class="line">
     <a name="l01668">
     </a>
     <span class="lineno">
      1668
     </span>
     scratch_buffer.
     <a class="code" href="classMLCommon_1_1buffer__base.html#a6cfb419e0cdf871abec33416711ae8ec">
      data
     </a>
     (),
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     );
    </div>
    <div class="line">
     <a name="l01669">
     </a>
     <span class="lineno">
      1669
     </span>
     <a class="code" href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
      CUDA_CHECK
     </a>
     (cudaPeekAtLastError());
    </div>
    <div class="line">
     <a name="l01670">
     </a>
     <span class="lineno">
      1670
     </span>
    </div>
    <div class="line">
     <a name="l01671">
     </a>
     <span class="lineno">
      1671
     </span>
     <span class="keywordflow">
      return
     </span>
     Y;
    </div>
    <div class="line">
     <a name="l01672">
     </a>
     <span class="lineno">
      1672
     </span>
     }
    </div>
    <div class="line">
     <a name="l01673">
     </a>
     <span class="lineno">
      1673
     </span>
    </div>
    <div class="line">
     <a name="l01686">
     </a>
     <span class="lineno">
      1686
     </span>
     <span class="keyword">
      template
     </span>
     &lt;
     <span class="keyword">
      typename
     </span>
     T&gt;
    </div>
    <div class="line">
     <a name="l01687">
     </a>
     <span class="lineno">
      <a class="line" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a25098f9c97b6a0d98d3a2d73f20765a9">
       1687
      </a>
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a25098f9c97b6a0d98d3a2d73f20765a9">
      b_lyapunov
     </a>
     (
     <span class="keyword">
      const
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; A,
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     &amp; Q) {
    </div>
    <div class="line">
     <a name="l01688">
     </a>
     <span class="lineno">
      1688
     </span>
     <span class="keywordtype">
      int
     </span>
     batch_size = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
      batches
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01689">
     </a>
     <span class="lineno">
      1689
     </span>
     <span class="keyword">
      auto
     </span>
     stream = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
      stream
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01690">
     </a>
     <span class="lineno">
      1690
     </span>
     <span class="keyword">
      auto
     </span>
     allocator = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
      allocator
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01691">
     </a>
     <span class="lineno">
      1691
     </span>
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     = A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
      shape
     </a>
     ().first;
    </div>
    <div class="line">
     <a name="l01692">
     </a>
     <span class="lineno">
      1692
     </span>
     <span class="keywordtype">
      int
     </span>
     n2 =
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
    </div>
    <div class="line">
     <a name="l01693">
     </a>
     <span class="lineno">
      1693
     </span>
     <span class="keyword">
      auto
     </span>
     counting = thrust::make_counting_iterator(0);
    </div>
    <div class="line">
     <a name="l01694">
     </a>
     <span class="lineno">
      1694
     </span>
    </div>
    <div class="line">
     <a name="l01695">
     </a>
     <span class="lineno">
      1695
     </span>
     <span class="keywordflow">
      if
     </span>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     &lt;= 4 || (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     &lt;= 6 &amp;&amp; batch_size &lt;= 96)) {
    </div>
    <div class="line">
     <a name="l01696">
     </a>
     <span class="lineno">
      1696
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01697">
     </a>
     <span class="lineno">
      1697
     </span>
     <span class="comment">
      // Use direct solution with Kronecker product
     </span>
    </div>
    <div class="line">
     <a name="l01698">
     </a>
     <span class="lineno">
      1698
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01699">
     </a>
     <span class="lineno">
      1699
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     I_m_AxA =
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aee40b648abdfa60ed92266a566072089">
      b_kron
     </a>
     (-A, A);
    </div>
    <div class="line">
     <a name="l01700">
     </a>
     <span class="lineno">
      1700
     </span>
     T* d_I_m_AxA = I_m_AxA.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01701">
     </a>
     <span class="lineno">
      1701
     </span>
     thrust::for_each(thrust::cuda::par.on(stream), counting,
    </div>
    <div class="line">
     <a name="l01702">
     </a>
     <span class="lineno">
      1702
     </span>
     counting + batch_size, [=] __device__(
     <span class="keywordtype">
      int
     </span>
     ib) {
    </div>
    <div class="line">
     <a name="l01703">
     </a>
     <span class="lineno">
      1703
     </span>
     T* b_I_m_AxA = d_I_m_AxA + ib * n2 * n2;
    </div>
    <div class="line">
     <a name="l01704">
     </a>
     <span class="lineno">
      1704
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     *
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01705">
     </a>
     <span class="lineno">
      1705
     </span>
     b_I_m_AxA[(n2 + 1) *
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ] += (T)1;
    </div>
    <div class="line">
     <a name="l01706">
     </a>
     <span class="lineno">
      1706
     </span>
     }
    </div>
    <div class="line">
     <a name="l01707">
     </a>
     <span class="lineno">
      1707
     </span>
     });
    </div>
    <div class="line">
     <a name="l01708">
     </a>
     <span class="lineno">
      1708
     </span>
     Q.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a09958e0aa47e3c004bea0cebda6a7544">
      reshape
     </a>
     (n2, 1);
    </div>
    <div class="line">
     <a name="l01709">
     </a>
     <span class="lineno">
      1709
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     X =
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aac0d49c5aa65007e6a1bf25016a652f7">
      b_solve
     </a>
     (I_m_AxA, Q);
    </div>
    <div class="line">
     <a name="l01710">
     </a>
     <span class="lineno">
      1710
     </span>
     Q.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a09958e0aa47e3c004bea0cebda6a7544">
      reshape
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     );
    </div>
    <div class="line">
     <a name="l01711">
     </a>
     <span class="lineno">
      1711
     </span>
     X.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a09958e0aa47e3c004bea0cebda6a7544">
      reshape
     </a>
     (
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     );
    </div>
    <div class="line">
     <a name="l01712">
     </a>
     <span class="lineno">
      1712
     </span>
     <span class="keywordflow">
      return
     </span>
     X;
    </div>
    <div class="line">
     <a name="l01713">
     </a>
     <span class="lineno">
      1713
     </span>
     }
     <span class="keywordflow">
      else
     </span>
     {
    </div>
    <div class="line">
     <a name="l01714">
     </a>
     <span class="lineno">
      1714
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01715">
     </a>
     <span class="lineno">
      1715
     </span>
     <span class="comment">
      // Transform to Sylvester equation (Popov, 1964)
     </span>
    </div>
    <div class="line">
     <a name="l01716">
     </a>
     <span class="lineno">
      1716
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01717">
     </a>
     <span class="lineno">
      1717
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     Bt(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), allocator, stream,
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l01718">
     </a>
     <span class="lineno">
      1718
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     C(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), allocator, stream,
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l01719">
     </a>
     <span class="lineno">
      1719
     </span>
     {
    </div>
    <div class="line">
     <a name="l01720">
     </a>
     <span class="lineno">
      1720
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     ApI(A);
    </div>
    <div class="line">
     <a name="l01721">
     </a>
     <span class="lineno">
      1721
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     AmI(A);
    </div>
    <div class="line">
     <a name="l01722">
     </a>
     <span class="lineno">
      1722
     </span>
     T* d_ApI = ApI.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01723">
     </a>
     <span class="lineno">
      1723
     </span>
     T* d_AmI = AmI.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
      raw_data
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01724">
     </a>
     <span class="lineno">
      1724
     </span>
     thrust::for_each(thrust::cuda::par.on(stream), counting,
    </div>
    <div class="line">
     <a name="l01725">
     </a>
     <span class="lineno">
      1725
     </span>
     counting + batch_size, [=] __device__(
     <span class="keywordtype">
      int
     </span>
     ib) {
    </div>
    <div class="line">
     <a name="l01726">
     </a>
     <span class="lineno">
      1726
     </span>
     <span class="keywordtype">
      int
     </span>
     idx = ib * n2;
    </div>
    <div class="line">
     <a name="l01727">
     </a>
     <span class="lineno">
      1727
     </span>
     <span class="keywordflow">
      for
     </span>
     (
     <span class="keywordtype">
      int
     </span>
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     = 0;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     &lt;
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ;
     <a class="code" href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
      i
     </a>
     ++) {
    </div>
    <div class="line">
     <a name="l01728">
     </a>
     <span class="lineno">
      1728
     </span>
     d_ApI[idx] += (T)1;
    </div>
    <div class="line">
     <a name="l01729">
     </a>
     <span class="lineno">
      1729
     </span>
     d_AmI[idx] -= (T)1;
    </div>
    <div class="line">
     <a name="l01730">
     </a>
     <span class="lineno">
      1730
     </span>
     idx +=
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     + 1;
    </div>
    <div class="line">
     <a name="l01731">
     </a>
     <span class="lineno">
      1731
     </span>
     }
    </div>
    <div class="line">
     <a name="l01732">
     </a>
     <span class="lineno">
      1732
     </span>
     });
    </div>
    <div class="line">
     <a name="l01733">
     </a>
     <span class="lineno">
      1733
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     ApI_inv = ApI.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abf26a21f1f2741436187952902044ea7">
      inv
     </a>
     ();
    </div>
    <div class="line">
     <a name="l01734">
     </a>
     <span class="lineno">
      1734
     </span>
    </div>
    <div class="line">
     <a name="l01735">
     </a>
     <span class="lineno">
      1735
     </span>
     <span class="comment">
      // Bt = (A+I)^{-1}*(A-I)
     </span>
    </div>
    <div class="line">
     <a name="l01736">
     </a>
     <span class="lineno">
      1736
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (
     <span class="keyword">
      false
     </span>
     ,
     <span class="keyword">
      false
     </span>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , (T)1, ApI_inv, AmI, (T)0, Bt);
    </div>
    <div class="line">
     <a name="l01737">
     </a>
     <span class="lineno">
      1737
     </span>
     <span class="comment">
      // C = 2*(A+I)^{-1}*Q*(A+I)^{-1}'
     </span>
    </div>
    <div class="line">
     <a name="l01738">
     </a>
     <span class="lineno">
      1738
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (
     <span class="keyword">
      false
     </span>
     ,
     <span class="keyword">
      false
     </span>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , (T)2, ApI_inv,
    </div>
    <div class="line">
     <a name="l01739">
     </a>
     <span class="lineno">
      1739
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (Q, ApI_inv,
     <span class="keyword">
      false
     </span>
     ,
     <span class="keyword">
      true
     </span>
     ), (T)0, C);
    </div>
    <div class="line">
     <a name="l01740">
     </a>
     <span class="lineno">
      1740
     </span>
     }
    </div>
    <div class="line">
     <a name="l01741">
     </a>
     <span class="lineno">
      1741
     </span>
    </div>
    <div class="line">
     <a name="l01742">
     </a>
     <span class="lineno">
      1742
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01743">
     </a>
     <span class="lineno">
      1743
     </span>
     <span class="comment">
      // Solve Sylvester equation B'X + XB = -C with Bartels-Stewart algorithm
     </span>
    </div>
    <div class="line">
     <a name="l01744">
     </a>
     <span class="lineno">
      1744
     </span>
     <span class="comment">
      //
     </span>
    </div>
    <div class="line">
     <a name="l01745">
     </a>
     <span class="lineno">
      1745
     </span>
    </div>
    <div class="line">
     <a name="l01746">
     </a>
     <span class="lineno">
      1746
     </span>
     <span class="comment">
      // 1. Shur decomposition of B'
     </span>
    </div>
    <div class="line">
     <a name="l01747">
     </a>
     <span class="lineno">
      1747
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     R(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), allocator, stream,
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l01748">
     </a>
     <span class="lineno">
      1748
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     U(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), allocator, stream,
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l01749">
     </a>
     <span class="lineno">
      1749
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42e39921da00184c1012556e48a14469">
      b_schur
     </a>
     (Bt, U, R);
    </div>
    <div class="line">
     <a name="l01750">
     </a>
     <span class="lineno">
      1750
     </span>
    </div>
    <div class="line">
     <a name="l01751">
     </a>
     <span class="lineno">
      1751
     </span>
     <span class="comment">
      // 2. F = -U'CU
     </span>
    </div>
    <div class="line">
     <a name="l01752">
     </a>
     <span class="lineno">
      1752
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     F(
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , batch_size, A.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
      cublasHandle
     </a>
     (), allocator, stream,
     <span class="keyword">
      false
     </span>
     );
    </div>
    <div class="line">
     <a name="l01753">
     </a>
     <span class="lineno">
      1753
     </span>
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (
     <span class="keyword">
      true
     </span>
     ,
     <span class="keyword">
      false
     </span>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     ,
     <a class="code" href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
      n
     </a>
     , (T)-1, U, C * U, (T)0, F);
    </div>
    <div class="line">
     <a name="l01754">
     </a>
     <span class="lineno">
      1754
     </span>
    </div>
    <div class="line">
     <a name="l01755">
     </a>
     <span class="lineno">
      1755
     </span>
     <span class="comment">
      // 3. Solve RY+YR'=F (where Y=U'XU)
     </span>
    </div>
    <div class="line">
     <a name="l01756">
     </a>
     <span class="lineno">
      1756
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     Y =
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4d5322b33c1018ff6928c2a119e1b79f">
      b_trsyl_uplo
     </a>
     (R, R.
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a491988110d24c48b953d899dd0509c37">
      transpose
     </a>
     (), F);
    </div>
    <div class="line">
     <a name="l01757">
     </a>
     <span class="lineno">
      1757
     </span>
    </div>
    <div class="line">
     <a name="l01758">
     </a>
     <span class="lineno">
      1758
     </span>
     <span class="comment">
      // 4. X = UYU'
     </span>
    </div>
    <div class="line">
     <a name="l01759">
     </a>
     <span class="lineno">
      1759
     </span>
     <a class="code" href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
      Matrix&lt;T&gt;
     </a>
     X =
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (U,
     <a class="code" href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
      b_gemm
     </a>
     (Y, U,
     <span class="keyword">
      false
     </span>
     ,
     <span class="keyword">
      true
     </span>
     ));
    </div>
    <div class="line">
     <a name="l01760">
     </a>
     <span class="lineno">
      1760
     </span>
    </div>
    <div class="line">
     <a name="l01761">
     </a>
     <span class="lineno">
      1761
     </span>
     <span class="keywordflow">
      return
     </span>
     X;
    </div>
    <div class="line">
     <a name="l01762">
     </a>
     <span class="lineno">
      1762
     </span>
     }
    </div>
    <div class="line">
     <a name="l01763">
     </a>
     <span class="lineno">
      1763
     </span>
     }
    </div>
    <div class="line">
     <a name="l01764">
     </a>
     <span class="lineno">
      1764
     </span>
    </div>
    <div class="line">
     <a name="l01765">
     </a>
     <span class="lineno">
      1765
     </span>
     }
     <span class="comment">
      // namespace Batched
     </span>
    </div>
    <div class="line">
     <a name="l01766">
     </a>
     <span class="lineno">
      1766
     </span>
     }
     <span class="comment">
      // namespace LinAlg
     </span>
    </div>
    <div class="line">
     <a name="l01767">
     </a>
     <span class="lineno">
      1767
     </span>
     }
     <span class="comment">
      // namespace MLCommon
     </span>
    </div>
   </div>
   <!-- fragment -->
  </div>
  <!-- contents -->
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_html_a1816f8bceb2b52d79599d2a30c9f8f11">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg.html#a1816f8bceb2b52d79599d2a30c9f8f11">
     MLCommon::LinAlg::for
    </a>
   </div>
   <div class="ttdeci">
    for(int idim=blockIdx.y;idim&lt; ncols;idim+=gridDim.y)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    reduce_rows_by_key.h:96
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1buffer__base_html">
   <div class="ttname">
    <a href="classMLCommon_1_1buffer__base.html">
     MLCommon::buffer_base
    </a>
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    buffer_base.hpp:30
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_ae0c8f266eb680e0b26d8461e1f037099">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ae0c8f266eb680e0b26d8461e1f037099">
     MLCommon::LinAlg::Batched::ahues_tisseur
    </a>
   </div>
   <div class="ttdeci">
    DI bool ahues_tisseur(const T *d_M, int i, int n)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1186
   </div>
  </div>
  <div class="ttc" id="agroup__Sign_html_gab8883fa9c349ad60903ceeb420ca8149">
   <div class="ttname">
    <a href="group__Sign.html#gab8883fa9c349ad60903ceeb420ca8149">
     MLCommon::signPrim
    </a>
   </div>
   <div class="ttdeci">
    DI T signPrim(T x)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    cuda_utils.h:467
   </div>
  </div>
  <div class="ttc" id="adevice__buffer_8hpp_html">
   <div class="ttname">
    <a href="device__buffer_8hpp.html">
     device_buffer.hpp
    </a>
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a6dae643aaeab41db01297b2cf42fae7d">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6dae643aaeab41db01297b2cf42fae7d">
     MLCommon::LinAlg::Batched::Matrix::m_allocator
    </a>
   </div>
   <div class="ttdeci">
    std::shared_ptr&lt; deviceAllocator &gt; m_allocator
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:435
   </div>
  </div>
  <div class="ttc" id="anamespaceML_1_1TSNE_html_a5c7478abb28859ec13dec63fa777a04e">
   <div class="ttname">
    <a href="namespaceML_1_1TSNE.html#a5c7478abb28859ec13dec63fa777a04e">
     ML::TSNE::x
    </a>
   </div>
   <div class="ttdeci">
    float x
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    bh_kernels.h:186
   </div>
  </div>
  <div class="ttc" id="acuml_8hpp_html">
   <div class="ttname">
    <a href="cuml_8hpp.html">
     cuml.hpp
    </a>
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a6806d61120ee747115ab221549a99e89">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6806d61120ee747115ab221549a99e89">
     MLCommon::LinAlg::Batched::Matrix::allocator
    </a>
   </div>
   <div class="ttdeci">
    std::shared_ptr&lt; deviceAllocator &gt; allocator() const
   </div>
   <div class="ttdoc">
    Return allocator.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:227
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_aac0d49c5aa65007e6a1bf25016a652f7">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aac0d49c5aa65007e6a1bf25016a652f7">
     MLCommon::LinAlg::Batched::b_solve
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; b_solve(const Matrix&lt; T &gt; &amp;A, const Matrix&lt; T &gt; &amp;b)
   </div>
   <div class="ttdoc">
    Solve Ax = b for given batched matrix A and batched vector b.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:694
   </div>
  </div>
  <div class="ttc" id="autils_8hpp_html">
   <div class="ttname">
    <a href="utils_8hpp.html">
     utils.hpp
    </a>
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_ab18b52e2d6f8109caacf01b64d79dbc2">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab18b52e2d6f8109caacf01b64d79dbc2">
     MLCommon::LinAlg::Batched::Matrix::batches
    </a>
   </div>
   <div class="ttdeci">
    int batches() const
   </div>
   <div class="ttdoc">
    Return batches.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:221
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a9c7ba116918e57a952e2ff9069a975ac">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a9c7ba116918e57a952e2ff9069a975ac">
     MLCommon::LinAlg::Batched::b_hessenberg
    </a>
   </div>
   <div class="ttdeci">
    void b_hessenberg(const Matrix&lt; T &gt; &amp;A, Matrix&lt; T &gt; &amp;U, Matrix&lt; T &gt; &amp;H)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1119
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_afb1f4c85b2968212a2aa5014ce87bae8">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#afb1f4c85b2968212a2aa5014ce87bae8">
     MLCommon::LinAlg::Batched::Matrix::operator=
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; &amp; operator=(const Matrix&lt; T &gt; &amp;other)
   </div>
   <div class="ttdoc">
    Copy assignment operator.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:205
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_ab3b4267c5f02efd0d6cdbc4c7c3ec2c1">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab3b4267c5f02efd0d6cdbc4c7c3ec2c1">
     MLCommon::LinAlg::Batched::Matrix::Identity
    </a>
   </div>
   <div class="ttdeci">
    static Matrix&lt; T &gt; Identity(int m, int batch_size, cublasHandle_t cublasHandle, std::shared_ptr&lt; ML::deviceAllocator &gt; allocator, cudaStream_t stream)
   </div>
   <div class="ttdoc">
    Initialize a batched identity matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:411
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a52caf848e1ea942d0907e7e3b37e8747">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a52caf848e1ea942d0907e7e3b37e8747">
     MLCommon::LinAlg::Batched::Matrix::data
    </a>
   </div>
   <div class="ttdeci">
    const T ** data() const
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:237
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_ae1521e0f7d318803e45968eb7b54ce85">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ae1521e0f7d318803e45968eb7b54ce85">
     MLCommon::LinAlg::Batched::Matrix::m_dense
    </a>
   </div>
   <div class="ttdeci">
    device_buffer&lt; T &gt; m_dense
   </div>
   <div class="ttdoc">
    Data pointer to first element of dense matrix data.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:430
   </div>
  </div>
  <div class="ttc" id="anamespaceML_1_1TSNE_html_affcebed822e95c0573529aa4d3cd1609">
   <div class="ttname">
    <a href="namespaceML_1_1TSNE.html#affcebed822e95c0573529aa4d3cd1609">
     ML::TSNE::r
    </a>
   </div>
   <div class="ttdeci">
    float r
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    bh_kernels.h:186
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_ab012618bd50366e13783399b3dc008f7">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ab012618bd50366e13783399b3dc008f7">
     MLCommon::LinAlg::Batched::Matrix::Matrix
    </a>
   </div>
   <div class="ttdeci">
    Matrix(int m, int n, int batch_size, cublasHandle_t cublasHandle, std::shared_ptr&lt; ML::deviceAllocator &gt; allocator, cudaStream_t stream, bool setZero=true)
   </div>
   <div class="ttdoc">
    Constructor that allocates memory using the memory pool.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:171
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a54e1a7ffa2aa36372e5f687e9dce706f">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a54e1a7ffa2aa36372e5f687e9dce706f">
     MLCommon::LinAlg::Batched::Matrix::print
    </a>
   </div>
   <div class="ttdeci">
    void print(std::string name) const
   </div>
   <div class="ttdoc">
    Visualize the first matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:297
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a6733febb03ad5c05088d9f2717bd8361">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6733febb03ad5c05088d9f2717bd8361">
     MLCommon::LinAlg::Batched::Matrix::raw_data
    </a>
   </div>
   <div class="ttdeci">
    T * raw_data()
   </div>
   <div class="ttdoc">
    Return pointer to the underlying memory.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:240
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_aa4808ddcca00a5b526ba40675ba48205">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#aa4808ddcca00a5b526ba40675ba48205">
     MLCommon::LinAlg::Batched::Matrix::mat
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; mat(int m, int n) const
   </div>
   <div class="ttdoc">
    Create a matrix from a long vector.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:285
   </div>
  </div>
  <div class="ttc" id="anamespaceML_1_1TSNE_html_a1cd86a623f64db84ca537da23b68223c">
   <div class="ttname">
    <a href="namespaceML_1_1TSNE.html#a1cd86a623f64db84ca537da23b68223c">
     ML::TSNE::n
    </a>
   </div>
   <div class="ttdeci">
    int n
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    bh_kernels.h:188
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a47338481df6c27580786b2b9e5e98090">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a47338481df6c27580786b2b9e5e98090">
     MLCommon::LinAlg::Batched::b_lagged_mat
    </a>
   </div>
   <div class="ttdeci">
    void b_lagged_mat(const Matrix&lt; T &gt; &amp;vec, Matrix&lt; T &gt; &amp;lagged_mat, int lags, int lagged_height, int vec_offset, int mat_offset, int s=1)
   </div>
   <div class="ttdoc">
    Create a batched lagged matrix from a given batched vector.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:776
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a0752666954befc04fbe6a9d3fedaf14d">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a0752666954befc04fbe6a9d3fedaf14d">
     MLCommon::LinAlg::Batched::operator*
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; operator*(const Matrix&lt; T &gt; &amp;A, const Matrix&lt; T &gt; &amp;B)
   </div>
   <div class="ttdoc">
    Multiplies each matrix in a batch-A with it's batch-B counterpart. A = [A1,A2,A3],...
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:647
   </div>
  </div>
  <div class="ttc" id="aunary__op_8h_html">
   <div class="ttname">
    <a href="unary__op_8h.html">
     unary_op.h
    </a>
   </div>
  </div>
  <div class="ttc" id="anamespaceML_1_1TSNE_html_a795c41c3f064d2e2b9a449d805cd4161">
   <div class="ttname">
    <a href="namespaceML_1_1TSNE.html#a795c41c3f064d2e2b9a449d805cd4161">
     ML::TSNE::i
    </a>
   </div>
   <div class="ttdeci">
    const int i
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    bh_kernels.h:94
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a788136379b795ac7ee712e35b34a2107">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a788136379b795ac7ee712e35b34a2107">
     MLCommon::LinAlg::Batched::operator+
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; operator+(const Matrix&lt; T &gt; &amp;A, const Matrix&lt; T &gt; &amp;B)
   </div>
   <div class="ttdoc">
    Adds two batched matrices together element-wise.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:659
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a7362ae3057b97ea8925904bfaac9168b">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a7362ae3057b97ea8925904bfaac9168b">
     MLCommon::LinAlg::Batched::Matrix::data
    </a>
   </div>
   <div class="ttdeci">
    T ** data()
   </div>
   <div class="ttdoc">
    Return pointer array.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:236
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a405acfefad72ccf67e2d036628f4920f">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a405acfefad72ccf67e2d036628f4920f">
     MLCommon::LinAlg::Batched::Matrix::m_stream
    </a>
   </div>
   <div class="ttdeci">
    cudaStream_t m_stream
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:437
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a98196da0c61d18aa74e58928d9262a1d">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a98196da0c61d18aa74e58928d9262a1d">
     MLCommon::LinAlg::Batched::quasi_triangular_solver
    </a>
   </div>
   <div class="ttdeci">
    DI void quasi_triangular_solver(T *d_scratch, T *d_x, int n, T *shared_mem)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1427
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a6306a4c53935c6026c469bacfb76d4d8">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a6306a4c53935c6026c469bacfb76d4d8">
     MLCommon::LinAlg::Batched::Matrix::stream
    </a>
   </div>
   <div class="ttdeci">
    cudaStream_t stream() const
   </div>
   <div class="ttdoc">
    Return stream.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:230
   </div>
  </div>
  <div class="ttc" id="agroup__Copy_html_ga9c1498ebc5825f9e63a9de94ced042d5">
   <div class="ttname">
    <a href="group__Copy.html#ga9c1498ebc5825f9e63a9de94ced042d5">
     MLCommon::updateHost
    </a>
   </div>
   <div class="ttdeci">
    void updateHost(Type *hPtr, const Type *dPtr, size_t len, cudaStream_t stream)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    cudart_utils.h:74
   </div>
  </div>
  <div class="ttc" id="agroup__Max_html_ga965c72198e8e95ce122e1ecf6b5ebe98">
   <div class="ttname">
    <a href="group__Max.html#ga965c72198e8e95ce122e1ecf6b5ebe98">
     MLCommon::maxPrim
    </a>
   </div>
   <div class="ttdeci">
    DI T maxPrim(T x, T y)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    cuda_utils.h:489
   </div>
  </div>
  <div class="ttc" id="agroup__solverbatched_html_gafd3e0592287bd860ba90f1a8d88ef1b3">
   <div class="ttname">
    <a href="group__solverbatched.html#gafd3e0592287bd860ba90f1a8d88ef1b3">
     MLCommon::LinAlg::cublasgetriBatched
    </a>
   </div>
   <div class="ttdeci">
    cublasStatus_t cublasgetriBatched(cublasHandle_t handle, int n, const T *const A[], int lda, const int *P, T *const C[], int ldc, int *info, int batchSize, cudaStream_t stream)
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a3be0f92cde027422394bd7370a4fe09b">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a3be0f92cde027422394bd7370a4fe09b">
     MLCommon::LinAlg::Batched::fill_strided_pointers_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void fill_strided_pointers_kernel(T *A_dense, T **A_array, int batch_size, int m, int n)
   </div>
   <div class="ttdoc">
    Helper kernel for the allocation: computes the array of pointers to each matrix in the strided batch.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:123
   </div>
  </div>
  <div class="ttc" id="abinary__op_8h_html">
   <div class="ttname">
    <a href="binary__op_8h.html">
     binary_op.h
    </a>
   </div>
  </div>
  <div class="ttc" id="acudart__utils_8h_html">
   <div class="ttname">
    <a href="cudart__utils_8h.html">
     cudart_utils.h
    </a>
   </div>
  </div>
  <div class="ttc" id="agroup__gelsbatched_html_ga44aa2633112d8fb44994b4a863cad582">
   <div class="ttname">
    <a href="group__gelsbatched.html#ga44aa2633112d8fb44994b4a863cad582">
     MLCommon::LinAlg::cublasgelsBatched
    </a>
   </div>
   <div class="ttdeci">
    cublasStatus_t cublasgelsBatched(cublasHandle_t handle, cublasOperation_t trans, int m, int n, int nrhs, T *Aarray[], int lda, T *Carray[], int ldc, int *info, int *devInfoArray, int batchSize, cudaStream_t stream=0)
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a9d97b9c77ae8d505c70560331e859870">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a9d97b9c77ae8d505c70560331e859870">
     MLCommon::LinAlg::Batched::b_gels
    </a>
   </div>
   <div class="ttdeci">
    void b_gels(const Matrix&lt; T &gt; &amp;A, Matrix&lt; T &gt; &amp;C)
   </div>
   <div class="ttdoc">
    Wrapper around cuBLAS batched gels (least-square solver of Ax=C)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:571
   </div>
  </div>
  <div class="ttc" id="agroup__ScalarOps_html_gaa2f75a68cd7b273b2d761b99250a894d">
   <div class="ttname">
    <a href="group__ScalarOps.html#gaa2f75a68cd7b273b2d761b99250a894d">
     MLCommon::LinAlg::sqrt
    </a>
   </div>
   <div class="ttdeci">
    void sqrt(math_t *out, const math_t *in, IdxType len, cudaStream_t stream)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    sqrt.h:36
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a4d5322b33c1018ff6928c2a119e1b79f">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4d5322b33c1018ff6928c2a119e1b79f">
     MLCommon::LinAlg::Batched::b_trsyl_uplo
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; b_trsyl_uplo(const Matrix&lt; T &gt; &amp;R, const Matrix&lt; T &gt; &amp;S, const Matrix&lt; T &gt; &amp;F)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1653
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_ad86c937c8a176a6d6a1447b54cd02225">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ad86c937c8a176a6d6a1447b54cd02225">
     MLCommon::LinAlg::Batched::batched_diff_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void batched_diff_kernel(const T *in, T *out, int n_elem, int period=1)
   </div>
   <div class="ttdoc">
    Kernel to compute the difference of batched vectors with a given period (1 for simple difference,...
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:77
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a98ed75acecac9cf0261c7fe486846c6d">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a98ed75acecac9cf0261c7fe486846c6d">
     MLCommon::LinAlg::Batched::Matrix::shape
    </a>
   </div>
   <div class="ttdeci">
    const std::pair&lt; int, int &gt; &amp; shape() const
   </div>
   <div class="ttdoc">
    Return shape.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:233
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a42a67d0964e2a0f46aedd5da95a641ef">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42a67d0964e2a0f46aedd5da95a641ef">
     MLCommon::LinAlg::Batched::b_gemm
    </a>
   </div>
   <div class="ttdeci">
    void b_gemm(bool aT, bool bT, int m, int n, int k, T alpha, const Matrix&lt; T &gt; &amp;A, const Matrix&lt; T &gt; &amp;B, T beta, Matrix&lt; T &gt; &amp;C)
   </div>
   <div class="ttdoc">
    Batched GEMM operation (exhaustive version) [C1, C2, ...] = [alpha*A1*B1+beta*C1, alpha*A2*B2+beta*C2...
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:495
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_afb30eaabc37e040cd6d45d3bf39cddbf">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#afb30eaabc37e040cd6d45d3bf39cddbf">
     MLCommon::LinAlg::Batched::generate_householder_vector
    </a>
   </div>
   <div class="ttdeci">
    DI void generate_householder_vector(T *d_uk, const T *d_xk, int m)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:922
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a647f742a2ac2a1701f38f80bdf06a59c">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a647f742a2ac2a1701f38f80bdf06a59c">
     MLCommon::LinAlg::Batched::Matrix::~Matrix
    </a>
   </div>
   <div class="ttdeci">
    ~Matrix()
   </div>
   <div class="ttdoc">
    Destructor: nothing to destroy explicitely.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:185
   </div>
  </div>
  <div class="ttc" id="anamespaceUMAPAlgo_1_1Optimize_html_ad1d8470650aa6ea82693fdf61479e708">
   <div class="ttname">
    <a href="namespaceUMAPAlgo_1_1Optimize.html#ad1d8470650aa6ea82693fdf61479e708">
     UMAPAlgo::Optimize::f
    </a>
   </div>
   <div class="ttdeci">
    void f(T *input, int n_rows, T *coef, T *preds)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    optimize.h:60
   </div>
  </div>
  <div class="ttc" id="autils_8hpp_html_a210a06563e52304b8df6f984e9d32d49">
   <div class="ttname">
    <a href="utils_8hpp.html#a210a06563e52304b8df6f984e9d32d49">
     ASSERT
    </a>
   </div>
   <div class="ttdeci">
    #define ASSERT(check, fmt,...)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    utils.hpp:93
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a604f4154324d336395e4890ee52cf939">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a604f4154324d336395e4890ee52cf939">
     MLCommon::LinAlg::Batched::batched_second_diff_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void batched_second_diff_kernel(const T *in, T *out, int n_elem, int period1=1, int period2=1)
   </div>
   <div class="ttdoc">
    Kernel to compute the second difference of batched vectors with given periods (1 for simple differenc...
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:101
   </div>
  </div>
  <div class="ttc" id="acuda__utils_8h_html_acabe1ee3d11be6214c678bf4dabda3c9">
   <div class="ttname">
    <a href="cuda__utils_8h.html#acabe1ee3d11be6214c678bf4dabda3c9">
     DI
    </a>
   </div>
   <div class="ttdeci">
    #define DI
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    cuda_utils.h:26
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_ab44edd8ee38ab93ab2959192d1f2df34">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ab44edd8ee38ab93ab2959192d1f2df34">
     MLCommon::LinAlg::Batched::b_aA_op_B
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; b_aA_op_B(const Matrix&lt; T &gt; &amp;A, const Matrix&lt; T &gt; &amp;B, F binary_op)
   </div>
   <div class="ttdoc">
    A utility method to implement pointwise operations between elements of two batched matrices.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:619
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a4415384bb08980d7b4e495795c3bc159">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a4415384bb08980d7b4e495795c3bc159">
     MLCommon::LinAlg::Batched::b_op_A
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; b_op_A(const Matrix&lt; T &gt; &amp;A, F unary_op)
   </div>
   <div class="ttdoc">
    A utility method to implement a unary operation on a batched matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:596
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_html_afd611e92a01811c35ec733fd18112064">
   <div class="ttname">
    <a href="namespaceMLCommon.html#afd611e92a01811c35ec733fd18112064">
     MLCommon::copy
    </a>
   </div>
   <div class="ttdeci">
    void copy(Type *dst, const Type *src, size_t len, cudaStream_t stream)
   </div>
   <div class="ttdoc">
    Generic copy method for all kinds of transfers.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    cudart_utils.h:54
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_html_a5fc5df15f7e1441d7fa32031fd0a95d4">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg.html#a5fc5df15f7e1441d7fa32031fd0a95d4">
     MLCommon::LinAlg::binaryOp
    </a>
   </div>
   <div class="ttdeci">
    void binaryOp(OutType *out, const InType *in1, const InType *in2, IdxType len, Lambda op, cudaStream_t stream)
   </div>
   <div class="ttdoc">
    perform element-wise binary operation on the input arrays
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    binary_op.h:73
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a974feffd7829497b86979e50f8468ede">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a974feffd7829497b86979e50f8468ede">
     MLCommon::LinAlg::Batched::Matrix::difference
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; difference(int period=1) const
   </div>
   <div class="ttdoc">
    Compute the difference of the batched vector with a given period (1 for simple difference,...
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:320
   </div>
  </div>
  <div class="ttc" id="autils_8hpp_html_aeaf2b8792be9f99ad11147059ef5079d">
   <div class="ttname">
    <a href="utils_8hpp.html#aeaf2b8792be9f99ad11147059ef5079d">
     CUDA_CHECK
    </a>
   </div>
   <div class="ttdeci">
    #define CUDA_CHECK(call)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    utils.hpp:99
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_abb84d37f0a8b444c1e611f4bc14f8870">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abb84d37f0a8b444c1e611f4bc14f8870">
     MLCommon::LinAlg::Batched::Matrix::Matrix
    </a>
   </div>
   <div class="ttdeci">
    Matrix(const Matrix&lt; T &gt; &amp;other)
   </div>
   <div class="ttdoc">
    Copy constructor.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:188
   </div>
  </div>
  <div class="ttc" id="anamespaceML_1_1TSNE_html_afb851e919e0cd78a7c66faf65d407452">
   <div class="ttname">
    <a href="namespaceML_1_1TSNE.html#afb851e919e0cd78a7c66faf65d407452">
     ML::TSNE::k
    </a>
   </div>
   <div class="ttdeci">
    int k
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    bh_kernels.h:165
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a72171a6271280ff7d6f7ca4827048b41">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a72171a6271280ff7d6f7ca4827048b41">
     MLCommon::LinAlg::Batched::Matrix::m_shape
    </a>
   </div>
   <div class="ttdeci">
    std::pair&lt; int, int &gt; m_shape
   </div>
   <div class="ttdoc">
    Shape (rows, cols) of matrices. We assume all matrices in batch have same shape.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:424
   </div>
  </div>
  <div class="ttc" id="agroup__gemmbatched_html_ga684f3c7d4ac973358203734b1cbf4dfa">
   <div class="ttname">
    <a href="group__gemmbatched.html#ga684f3c7d4ac973358203734b1cbf4dfa">
     MLCommon::LinAlg::cublasgemmStridedBatched
    </a>
   </div>
   <div class="ttdeci">
    cublasStatus_t cublasgemmStridedBatched(cublasHandle_t handle, cublasOperation_t transa, cublasOperation_t transb, int m, int n, int k, const T *alpha, const T *const Aarray, int lda, long long int strideA, const T *const Barray, int ldb, long long int strideB, const T *beta, T *Carray, int ldc, long long int strideC, int batchCount, cudaStream_t stream)
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_ac946d5044edfad2bc6255adf7acdab7b">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#ac946d5044edfad2bc6255adf7acdab7b">
     MLCommon::LinAlg::Batched::b_2dcopy
    </a>
   </div>
   <div class="ttdeci">
    void b_2dcopy(const Matrix&lt; T &gt; &amp;in, Matrix&lt; T &gt; &amp;out, int starting_row, int starting_col, int rows, int cols)
   </div>
   <div class="ttdoc">
    Compute a 2D copy of a window in a batched matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:871
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a236656db7c4257dd43b1fc1ad0fbae6f">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a236656db7c4257dd43b1fc1ad0fbae6f">
     MLCommon::LinAlg::Batched::hessenberg_reduction_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void hessenberg_reduction_kernel(T *d_U, T *d_H, T *d_hh, int n)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:995
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_af8a4873373cc2ed96524512aa7518a0c">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af8a4873373cc2ed96524512aa7518a0c">
     MLCommon::LinAlg::Batched::Matrix::m_cublasHandle
    </a>
   </div>
   <div class="ttdeci">
    cublasHandle_t m_cublasHandle
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:436
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a474c2ae418b15d139a5941986c0a74ac">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a474c2ae418b15d139a5941986c0a74ac">
     MLCommon::LinAlg::Batched::Matrix::vec
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; vec() const
   </div>
   <div class="ttdoc">
    Stack the matrix by columns creating a long vector.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:268
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_abeaf703e7f97387df59b277c5483c0c0">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#abeaf703e7f97387df59b277c5483c0c0">
     MLCommon::LinAlg::Batched::operator-
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; operator-(const Matrix&lt; T &gt; &amp;A, const Matrix&lt; T &gt; &amp;B)
   </div>
   <div class="ttdoc">
    Subtract two batched matrices together element-wise.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:671
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a408553a4512ccfb143f36888409daeb2">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a408553a4512ccfb143f36888409daeb2">
     MLCommon::LinAlg::Batched::Matrix::raw_data
    </a>
   </div>
   <div class="ttdeci">
    const T * raw_data() const
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:241
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a42e39921da00184c1012556e48a14469">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a42e39921da00184c1012556e48a14469">
     MLCommon::LinAlg::Batched::b_schur
    </a>
   </div>
   <div class="ttdeci">
    void b_schur(const Matrix&lt; T &gt; &amp;A, Matrix&lt; T &gt; &amp;U, Matrix&lt; T &gt; &amp;S, int max_iter_per_step=20)
   </div>
   <div class="ttdoc">
    Schur decomposition A = USU' of a square matrix A, where U is unitary and S is an upper quasi-triangu...
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1398
   </div>
  </div>
  <div class="ttc" id="acublas__wrappers_8h_html">
   <div class="ttname">
    <a href="cublas__wrappers_8h.html">
     cublas_wrappers.h
    </a>
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a6e3278fec6e37f36229277c91db26c4a">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a6e3278fec6e37f36229277c91db26c4a">
     MLCommon::LinAlg::Batched::generate_givens
    </a>
   </div>
   <div class="ttdeci">
    DI void generate_givens(T a, T b, T &amp;c, T &amp;s)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1156
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a888a53f82abc92c59ebb6f0109c27ae2">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a888a53f82abc92c59ebb6f0109c27ae2">
     MLCommon::LinAlg::Batched::kronecker_product_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void kronecker_product_kernel(const T *A, int m, int n, const T *B, int p, int q, T *AkB, int k_m, int k_n)
   </div>
   <div class="ttdoc">
    Computes batched kronecker product between AkB &lt;- A (x) B.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:457
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_ade4bfaedec55791a067907e7074c51da">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#ade4bfaedec55791a067907e7074c51da">
     MLCommon::LinAlg::Batched::Matrix::m_batch_size
    </a>
   </div>
   <div class="ttdeci">
    int m_batch_size
   </div>
   <div class="ttdoc">
    Number of matrices in batch.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:433
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_abf26a21f1f2741436187952902044ea7">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#abf26a21f1f2741436187952902044ea7">
     MLCommon::LinAlg::Batched::Matrix::inv
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; inv() const
   </div>
   <div class="ttdoc">
    Compute the inverse of the batched matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:345
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a3ade2fb038790850c9a19ae7c4a25f2e">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a3ade2fb038790850c9a19ae7c4a25f2e">
     MLCommon::LinAlg::Batched::Matrix::initialize
    </a>
   </div>
   <div class="ttdeci">
    void initialize(bool setZero=false)
   </div>
   <div class="ttdoc">
    Initialization method.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:143
   </div>
  </div>
  <div class="ttc" id="anamespaceML_1_1TSNE_html_aa7af7a282a727812d02249e36b56d7cb">
   <div class="ttname">
    <a href="namespaceML_1_1TSNE.html#aa7af7a282a727812d02249e36b56d7cb">
     ML::TSNE::j
    </a>
   </div>
   <div class="ttdeci">
    int j
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    bh_kernels.h:380
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_af703894eff918b820989f4e1c12f5e93">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#af703894eff918b820989f4e1c12f5e93">
     MLCommon::LinAlg::Batched::trsyl_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void trsyl_kernel(const T *d_R, const T *d_R2, const T *d_S, const T *d_F, T *d_Y, T *d_scratch, int n)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1512
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_aee40b648abdfa60ed92266a566072089">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aee40b648abdfa60ed92266a566072089">
     MLCommon::LinAlg::Batched::b_kron
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; b_kron(const Matrix&lt; T &gt; &amp;A, const Matrix&lt; T &gt; &amp;B)
   </div>
   <div class="ttdoc">
    The batched kroneker product A (x) B for given batched matrix A and batched matrix B.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:708
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_html">
   <div class="ttname">
    <a href="namespaceMLCommon.html">
     MLCommon
    </a>
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    cuml_allocator.hpp:22
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_acc884b32f8986a74fc61205db4bb6405">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acc884b32f8986a74fc61205db4bb6405">
     MLCommon::LinAlg::Batched::Matrix::m_batches
    </a>
   </div>
   <div class="ttdeci">
    device_buffer&lt; T * &gt; m_batches
   </div>
   <div class="ttdoc">
    Array(pointer) to each matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:427
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_html_a582f862f0f386a0f5bee65bcac37382a">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg.html#a582f862f0f386a0f5bee65bcac37382a">
     MLCommon::LinAlg::unaryOp
    </a>
   </div>
   <div class="ttdeci">
    void unaryOp(OutType *out, const InType *in, IdxType len, Lambda op, cudaStream_t stream)
   </div>
   <div class="ttdoc">
    perform element-wise unary operation in the input array
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    unary_op.h:71
   </div>
  </div>
  <div class="ttc" id="anamespaceML_1_1TSNE_html_a98168b1bb13bc28991297eef583f11fe">
   <div class="ttname">
    <a href="namespaceML_1_1TSNE.html#a98168b1bb13bc28991297eef583f11fe">
     ML::TSNE::__syncthreads
    </a>
   </div>
   <div class="ttdeci">
    __syncthreads()
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a491988110d24c48b953d899dd0509c37">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a491988110d24c48b953d899dd0509c37">
     MLCommon::LinAlg::Batched::Matrix::transpose
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; transpose() const
   </div>
   <div class="ttdoc">
    Compute A' for a batched matrix A.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:376
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1buffer__base_html_a6cfb419e0cdf871abec33416711ae8ec">
   <div class="ttname">
    <a href="classMLCommon_1_1buffer__base.html#a6cfb419e0cdf871abec33416711ae8ec">
     MLCommon::buffer_base::data
    </a>
   </div>
   <div class="ttdeci">
    value_type * data()
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    buffer_base.hpp:65
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_af45cde893b29d7ca2ede4ed3d4f49dd1">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#af45cde893b29d7ca2ede4ed3d4f49dd1">
     MLCommon::LinAlg::Batched::Matrix::cublasHandle
    </a>
   </div>
   <div class="ttdeci">
    cublasHandle_t cublasHandle() const
   </div>
   <div class="ttdoc">
    Return cublas handle.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:224
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_a09958e0aa47e3c004bea0cebda6a7544">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#a09958e0aa47e3c004bea0cebda6a7544">
     MLCommon::LinAlg::Batched::Matrix::reshape
    </a>
   </div>
   <div class="ttdeci">
    void reshape(int m, int n)
   </div>
   <div class="ttdoc">
    Reshape the matrix (the new shape must have the same size) The column-major data is left unchanged.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:260
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html">
     MLCommon::LinAlg::Batched::Matrix
    </a>
   </div>
   <div class="ttdoc">
    The Batched::Matrix class provides storage and a number of linear operations on collections (batches)...
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:136
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1Distance_html_a2424d27a67d0483530b531f6ac12d07f">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1Distance.html#a2424d27a67d0483530b531f6ac12d07f">
     MLCommon::Distance::m
    </a>
   </div>
   <div class="ttdeci">
    __global__ const DataT const DataT const DataT const DataT IdxT m
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    fused_l2_nn.h:263
   </div>
  </div>
  <div class="ttc" id="acuda__utils_8h_html">
   <div class="ttname">
    <a href="cuda__utils_8h.html">
     cuda_utils.h
    </a>
   </div>
  </div>
  <div class="ttc" id="aclassMLCommon_1_1LinAlg_1_1Batched_1_1Matrix_html_acfac0b521f255bd17e735ec004a0b8fd">
   <div class="ttname">
    <a href="classMLCommon_1_1LinAlg_1_1Batched_1_1Matrix.html#acfac0b521f255bd17e735ec004a0b8fd">
     MLCommon::LinAlg::Batched::Matrix::operator[]
    </a>
   </div>
   <div class="ttdeci">
    T * operator[](int id) const
   </div>
   <div class="ttdoc">
    Return pointer to the data of a specific matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:249
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_aed4cf783f47734ac6722ac1f49cc6f94">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#aed4cf783f47734ac6722ac1f49cc6f94">
     MLCommon::LinAlg::Batched::lagged_mat_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void lagged_mat_kernel(const T *vec, T *mat, int lags, int lagged_height, int vec_offset, int ld, int mat_offset, int ls_batch_stride, int s=1)
   </div>
   <div class="ttdoc">
    Kernel to create a batched lagged matrix from a given batched vector.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:746
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a061a8fe688e5980e4f3a1b9ad10bf3d0">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a061a8fe688e5980e4f3a1b9ad10bf3d0">
     MLCommon::LinAlg::Batched::francis_qr_algorithm_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void francis_qr_algorithm_kernel(T *d_U, T *d_H, int n)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1211
   </div>
  </div>
  <div class="ttc" id="agroup__solverbatched_html_ga44ce99d17460e10db4e8d6e8ba8562c8">
   <div class="ttname">
    <a href="group__solverbatched.html#ga44ce99d17460e10db4e8d6e8ba8562c8">
     MLCommon::LinAlg::cublasgetrfBatched
    </a>
   </div>
   <div class="ttdeci">
    cublasStatus_t cublasgetrfBatched(cublasHandle_t handle, int n, T *const A[], int lda, int *P, int *info, int batchSize, cudaStream_t stream)
   </div>
  </div>
  <div class="ttc" id="acublas__wrappers_8h_html_aa2a304d9732f1f382fac9abaf77526a7">
   <div class="ttname">
    <a href="cublas__wrappers_8h.html#aa2a304d9732f1f382fac9abaf77526a7">
     CUBLAS_CHECK
    </a>
   </div>
   <div class="ttdeci">
    #define CUBLAS_CHECK(call)
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    cublas_wrappers.h:48
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a64c202bf9c116c020e4ee6752a359bbb">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a64c202bf9c116c020e4ee6752a359bbb">
     MLCommon::LinAlg::Batched::identity_matrix_kernel
    </a>
   </div>
   <div class="ttdeci">
    __global__ void identity_matrix_kernel(T *I, int m)
   </div>
   <div class="ttdoc">
    Kernel to create an identity matrix.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:56
   </div>
  </div>
  <div class="ttc" id="anamespaceMLCommon_1_1LinAlg_1_1Batched_html_a25098f9c97b6a0d98d3a2d73f20765a9">
   <div class="ttname">
    <a href="namespaceMLCommon_1_1LinAlg_1_1Batched.html#a25098f9c97b6a0d98d3a2d73f20765a9">
     MLCommon::LinAlg::Batched::b_lyapunov
    </a>
   </div>
   <div class="ttdeci">
    Matrix&lt; T &gt; b_lyapunov(const Matrix&lt; T &gt; &amp;A, Matrix&lt; T &gt; &amp;Q)
   </div>
   <div class="ttdoc">
    Solve discrete Lyapunov equation A*X*A' - X + Q = 0.
   </div>
   <div class="ttdef">
    <b>
     Definition:
    </b>
    matrix.h:1687
   </div>
  </div>
  <!-- start footer part -->
  <hr class="footer"/>
  <address class="footer">
   <small>
    Generated by
    <a href="http://www.doxygen.org/index.html">
     <img alt="doxygen" class="footer" src="doxygen.png"/>
    </a>
    1.8.18
   </small>
  </address>
  <script defer id="rapids-selector-js" src="/assets/js/custom.js">
  </script>
 </body>
</html>
